// Last build : 18.3.2014_9:29:25 / git revision : 2ec7198
function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value))}i[b+s.name]=v}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser)try{var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}catch(d){return null}else if(0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a),0!=b.parseError.errorCode)return null;return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;len>i;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}if(function(a){Q=a()}(function(){"use strict";function a(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function b(a){return"[object StopIteration]"===hb(a)||a instanceof _}function c(a,b){b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ib)&&(a.stack=d(a.stack)+"\n"+ib+"\n"+d(b.stack))}function d(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var g=b[d];f(g)||e(g)||c.push(g)}return c.join("\n")}function e(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function f(a){var b=/at .+ \((.*):(\d+):\d+\)/.exec(a);if(!b)return!1;var c=b[1],d=b[2];return c===X&&d>=Z&&nb>=d}function g(){if(Error.captureStackTrace){var a,b,c=Error.prepareStackTrace;return Error.prepareStackTrace=function(c,d){a=d[1].getFileName(),b=d[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=c,X=a,b}}function h(a){return u(a)}function i(){function a(a){c&&(b=u(a),bb(c,function(a,c){Y(function(){b.promiseDispatch.apply(b,c)})},void 0),c=void 0,d=void 0)}var b,c=[],d=[],e=eb(i.prototype),f=eb(k.prototype);return f.promiseDispatch=function(a,e,f){var g=ab(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):Y(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){return c?f:b=l(b)},Error.captureStackTrace&&h.longStackJumpLimit>0&&(Error.captureStackTrace(f,i),f.stack=f.stack.substring(f.stack.indexOf("\n")+1)),e.promise=f,e.resolve=a,e.fulfill=function(b){a(t(b))},e.reject=function(b){a(s(b))},e.notify=function(a){c&&bb(d,function(b,c){Y(function(){c(a)})},void 0)},e}function j(a){var b=i();return G(a,b.resolve,b.reject,b.notify).fail(b.reject),b.promise}function k(a,b,c,d,e){void 0===b&&(b=function(a){return s(new Error("Promise does not support operation: "+a))});var f=eb(k.prototype);return f.promiseDispatch=function(c,d,e){var g;try{g=a[d]?a[d].apply(f,e):b.call(f,d,e)}catch(h){g=s(h)}c&&c(g)},c&&(f.valueOf=c),e&&(f.exception=d),f}function l(a){return m(a)?a.valueOf():a}function m(a){return a&&"function"==typeof a.promiseDispatch}function n(a){return a&&"function"==typeof a.then}function o(a){return!p(a)&&!q(a)}function p(a){return!n(l(a))}function q(a){return a=l(a),m(a)&&"exception"in a}function r(){!jb&&"undefined"!=typeof window&&window.console}function s(a){var b=k({when:function(b){if(b){var c=cb(kb,this);-1!==c&&(lb.splice(c,1),kb.splice(c,1))}return b?b(a):this}},function(){return s(a)},function(){return this},a,!0);return kb.push(b),lb.push(a),r(),b}function t(a){return k({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null==b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return gb(a)}},void 0,function(){return a})}function u(a){return m(a)?a:(a=l(a),n(a)?v(a):t(a))}function v(a){var b=i();return Y(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function w(a){return k({isDef:function(){}},function(b,c){return C(a,b,c)},function(){return l(a)})}function x(a,b,d,e){function f(a){try{return"function"==typeof b?b(a):a}catch(c){return s(c)}}function g(a){if("function"==typeof d){c(a,m);try{return d(a)}catch(b){return s(b)}}return s(a)}function j(a){return"function"==typeof e?e(a):a}var k=i(),l=!1,m=u(a);return Y(function(){m.promiseDispatch(function(a){l||(l=!0,k.resolve(f(a)))},"when",[function(a){l||(l=!0,k.resolve(g(a)))}])}),m.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=j(a)}catch(d){if(c=!0,!h.onerror)throw d;h.onerror(d)}c||k.notify(b)}]),k.promise}function y(a,b,c){return x(a,function(a){return I(a).then(function(a){return b.apply(void 0,a)},c)},c)}function z(a){return function(){function c(a,c){var g;try{g=d[a](c)}catch(h){return b(h)?h.value:s(h)}return x(g,e,f)}var d=a.apply(this,arguments),e=c.bind(c,"send"),f=c.bind(c,"throw");return e()}}function A(a){throw new _(a)}function B(a){return function(){return y([this,I(arguments)],function(b,c){return a.apply(b,c)})}}function C(a,b,c){var d=i();return Y(function(){u(a).promiseDispatch(d.resolve,b,c)}),d.promise}function D(a){return function(b){var c=ab(arguments,1);return C(b,a,c)}}function E(a,b){var c=ab(arguments,2);return mb(a,b,c)}function F(a,b){return C(a,"apply",[void 0,b])}function G(a){var b=ab(arguments,1);return F(a,b)}function H(a){var b=ab(arguments,1);return function(){var c=b.concat(ab(arguments));return C(a,"apply",[this,c])}}function I(a){return x(a,function(a){var b=a.length;if(0===b)return u(a);var c=i();return bb(a,function(d,e,f){p(e)?(a[f]=l(e),0===--b&&c.resolve(a)):x(e,function(d){a[f]=d,0===--b&&c.resolve(a)}).fail(c.reject)},void 0),c.promise})}function J(a){return x(a,function(a){return a=db(a,u),x(I(db(a,function(a){return x(a,$,$)})),function(){return a})})}function K(a,b){return x(a,void 0,b)}function L(a,b){return x(a,void 0,void 0,b)}function M(a,b){return x(a,function(a){return x(b(),function(){return a})},function(a){return x(b(),function(){return s(a)})})}function N(a,b,d,e){var f=function(b){Y(function(){if(c(b,a),!h.onerror)throw b;h.onerror(b)})},g=b||d||e?x(a,b,d,e):a;"object"==typeof process&&process&&process.domain&&(f=process.domain.bind(f)),K(g,f)}function O(a,b){var c=i(),d=setTimeout(function(){c.reject(new Error("Timed out after "+b+" ms"))},b);return x(a,function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)}),c.promise}function P(a,b){void 0===b&&(b=a,a=void 0);var c=i();return setTimeout(function(){c.resolve(a)},b),c.promise}function Q(a,b){var c=ab(b),d=i();return c.push(d.makeNodeResolver()),F(a,c).fail(d.reject),d.promise}function R(a){var b=ab(arguments,1),c=i();return b.push(c.makeNodeResolver()),F(a,b).fail(c.reject),c.promise}function S(a){var b=ab(arguments,1);return function(){var c=b.concat(ab(arguments)),d=i();return c.push(d.makeNodeResolver()),F(a,c).fail(d.reject),d.promise}}function T(a){var b=ab(arguments,1);return function(){function c(){return a.apply(f,arguments)}var d=b.concat(ab(arguments)),e=i();d.push(e.makeNodeResolver());var f=this;return F(c,d).fail(e.reject),e.promise}}function U(a,b,c){var d=ab(c||[]),e=i();return d.push(e.makeNodeResolver()),mb(a,b,d).fail(e.reject),e.promise}function V(a,b){var c=ab(arguments,2),d=i();return c.push(d.makeNodeResolver()),mb(a,b,c).fail(d.reject),d.promise}function W(a,b){return b?void a.then(function(a){Y(function(){b(null,a)})},function(a){Y(function(){b(a)})}):a}var X,Y,Z=g(),$=function(){};"undefined"!=typeof process?Y=process.nextTick:"function"==typeof setImmediate?Y="undefined"!=typeof window?setImmediate.bind(window):setImmediate:!function(){function a(){if(--f,++h>=e){h=0,e*=4;for(var a=g&&Math.min(g-1,e);a>f;)++f,b()}for(;g;){--g,c=c.next;var d=c.task;c.task=void 0,d()}h=0}var b,c={task:void 0,next:null},d=c,e=2,f=0,g=0,h=0;if(Y=function(a){d=d.next={task:a,next:null},f<++g&&e>f&&(++f,b())},"undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=a,b=function(){i.port2.postMessage(0)}}else b=function(){setTimeout(a,0)}}();var _,ab=a(Array.prototype.slice),bb=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),cb=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),db=a(Array.prototype.map||function(a,b){var c=this,d=[];return bb(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),eb=Object.create||function(a){function b(){}return b.prototype=a,new b},fb=a(Object.prototype.hasOwnProperty),gb=Object.keys||function(a){var b=[];for(var c in a)fb(a,c)&&b.push(c);return b},hb=a(Object.prototype.toString);_="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a},h.longStackJumpLimit=1;var ib="From previous event:";h.nextTick=Y,h.defer=i,i.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?ab(arguments,1):c)}},h.promise=j,h.makePromise=k,k.prototype.then=function(a,b,c){return x(this,a,b,c)},k.prototype.thenResolve=function(a){return x(this,function(){return a})},bb(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(a,b){k.prototype[b]=function(){return h[b].apply(h,[this].concat(ab(arguments)))}},void 0),k.prototype.toSource=function(){return this.toString()},k.prototype.toString=function(){return"[object Promise]"},h.nearer=l,h.isPromise=m,h.isPromiseAlike=n,h.isPending=o,h.isFulfilled=p,h.isRejected=q;var jb,kb=[],lb=[];"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var a=0;a<lb.length;a++){var b=lb[a];b&&"undefined"!=typeof b.stack}}),h.reject=s,h.fulfill=t,h.resolve=u,h.master=w,h.when=x,h.spread=y,h.async=z,h["return"]=A,h.promised=B,h.dispatch=C,h.dispatcher=D,h.get=D("get"),h.set=D("set"),h["delete"]=h.del=D("delete");var mb=h.post=D("post");h.send=E,h.invoke=E,h.fapply=F,h["try"]=G,h.fcall=G,h.fbind=H,h.keys=D("keys"),h.all=I,h.allResolved=J,h["catch"]=h.fail=K,h.progress=L,h["finally"]=h.fin=M,h.done=N,h.timeout=O,h.delay=P,h.nfapply=Q,h.nfcall=R,h.nfbind=S,h.denodeify=h.nfbind,h.nbind=T,h.npost=U,h.nsend=V,h.ninvoke=h.nsend,h.nodeify=W;var nb=g();return h}),function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){"undefined"==typeof b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if("undefined"==typeof a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if("undefined"==typeof a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if("undefined"==typeof a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if("undefined"==typeof a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if("undefined"==typeof a)throw new Error(1050);if("undefined"==typeof b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if("undefined"==typeof a)throw new Error(1060);if("undefined"==typeof b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if("undefined"==typeof a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if("undefined"==typeof a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),"undefined"!=typeof b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if("undefined"==typeof a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if("undefined"==typeof a)throw new Error(1100);if("undefined"==typeof b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if("undefined"==typeof a)throw new Error(1110);return b=b||"global",c=c||a,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if("undefined"==typeof a)throw new Error(1120);if(b=b||"global",c=c||a,this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if("undefined"==typeof a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"object"==typeof e?f=e:"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),"undefined"==typeof utils)var utils={};"undefined"==typeof utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(a,b){var c,d,e;return c=new goog.math.Long(0,b),d=new goog.math.Long(a,0),e=c.add(d),e.toNumber()},goog={},goog.math={},goog.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=goog.math.Long.IntCache_[a];if(b)return b}var c=new goog.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(goog.math.Long.IntCache_[a]=c),c},goog.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?goog.math.Long.ZERO:a<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:a+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>a?goog.math.Long.fromNumber(-a).negate():new goog.math.Long(a%goog.math.Long.TWO_PWR_32_DBL_|0,a/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(a,b){return new goog.math.Long(a,b)},goog.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return goog.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=goog.math.Long.fromNumber(Math.pow(c,8)),e=goog.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=goog.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(goog.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(goog.math.Long.fromNumber(h))}return e},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var c=goog.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=goog.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},goog.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},goog.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},goog.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},goog.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},goog.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},goog.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.subtract=function(a){return this.add(a.negate())},goog.math.Long.prototype.multiply=function(a){if(this.isZero())return goog.math.Long.ZERO;if(a.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return a.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(a.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&a.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e*i,l+=m>>>16,m&=65535,l+=d*i,k+=l>>>16,l&=65535,l+=e*h,k+=l>>>16,l&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(a.equals(goog.math.Long.ONE)||a.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(goog.math.Long.ZERO))return a.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c)),e=c.add(d.div(a));return e}if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var f=goog.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),g=Math.ceil(Math.log(c)/Math.LN2),h=48>=g?1:Math.pow(2,g-48),i=goog.math.Long.fromNumber(c),j=i.multiply(a);j.isNegative()||j.greaterThan(d);)c-=h,i=goog.math.Long.fromNumber(c),j=i.multiply(a);i.isZero()&&(i=goog.math.Long.ONE),f=f.add(i),d=d.subtract(j)}return f},goog.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(a){return goog.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},goog.math.Long.prototype.or=function(a){return goog.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},goog.math.Long.prototype.xor=function(a){return goog.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},goog.math.Long.prototype.shiftLeft=function(a){if(a&=63,0==a)return this;var b=this.low_;if(32>a){var c=this.high_;return goog.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return goog.math.Long.fromBits(0,b<<a-32)},goog.math.Long.prototype.shiftRight=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return goog.math.Long.fromBits(b>>a-32,b>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?goog.math.Long.fromBits(b,0):goog.math.Long.fromBits(b>>>a-32,0)};var UTF8={};UTF8.encode=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);128>d?b.push(d):2048>d?(b.push(192|d>>6),b.push(128|63&d)):65536>d?(b.push(224|d>>12),b.push(128|63&d>>6),b.push(128|63&d)):(b.push(240|d>>18),b.push(128|63&d>>12),b.push(128|63&d>>6),b.push(128|63&d))}return b},UTF8.decode=function(a){for(var b=[],c=0;c<a.length;){var d=a[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&a[c++]):240>d?(d=(15&d)<<12,d|=(63&a[c++])<<6,d|=63&a[c++]):(d=(7&d)<<18,d|=(63&a[c++])<<12,d|=(63&a[c++])<<6,d|=63&a[c++])),b.push(String.fromCharCode(d))}return b.join("")};var BASE64={};if(function(b){var c=function(a){for(var c=0,d=[],e=0|a.length/3;0<e--;){var f=(a[c]<<16)+(a[c+1]<<8)+a[c+2];c+=3,d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push(b.charAt(63&f))}if(2==a.length-c){var f=(a[c]<<16)+(a[c+1]<<8);d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push("=")}else if(1==a.length-c){var f=a[c]<<16;d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push("==")}return d.join("")},d=function(){for(var a=[],c=0;c<b.length;++c)a[b.charCodeAt(c)]=c;return a["=".charCodeAt(0)]=0,a}(),e=function(a){for(var b=0,c=[],e=0|a.length/4;0<e--;){var f=(d[a.charCodeAt(b)]<<18)+(d[a.charCodeAt(b+1)]<<12)+(d[a.charCodeAt(b+2)]<<6)+d[a.charCodeAt(b+3)];c.push(255&f>>16),c.push(255&f>>8),c.push(255&f),b+=4}return c&&("="==a.charAt(b-2)?(c.pop(),c.pop()):"="==a.charAt(b-1)&&c.pop()),c},f={};f.encode=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b},f.decode=function(){for(var b=0;b<s.length;++b)a[b]=String.fromCharCode(a[b]);return a.join("")},BASE64.decodeArray=function(a){var b=e(a);return new Uint8Array(b)},BASE64.encodeASCII=function(a){var b=f.encode(a);return c(b)},BASE64.decodeASCII=function(a){var b=e(a);return f.decode(b)},BASE64.encode=function(a){var b=UTF8.encode(a);return c(b)},BASE64.decode=function(a){var b=e(a);return UTF8.decode(b)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;var mp4lib=function(){var a={boxes:{},fieldProcessors:{},fields:{},debug:!1,warningHandler:function(){}},b={},c={},d={};return a.registerBoxType=function(a){if(b[a.prototype.boxtype]=a,a.prototype.uuid){var e=JSON.stringify(a.prototype.uuid);c[e]=a.prototype.boxtype,d[a.prototype.boxtype]=e}},a.createBox=function(c){var d;return c in b?d=new b[c]:(a.warningHandler("Unknown boxtype:"+c+", parsing as UnknownBox"),d=new a.boxes.UnknownBox),d},a.findBoxtypeByUUID=function(a){return c[a]},a.findUUIDByBoxtype=function(a){return d[a]},a.deserialize=function(b){var c=new a.boxes.File,d=new a.fieldProcessors.DeserializationBoxFieldsProcessor(c,b,0,b.length);return c._processFields(d),c},a.serialize=function(b){var c=new a.fieldProcessors.LengthCounterBoxFieldsProcessor(b);b._processFields(c);var d=new Uint8Array(c.res),e=new a.fieldProcessors.SerializationBoxFieldsProcessor(b,d,0);return b._processFields(e),d},a.getBoxByType=function(a,b){for(var c=0;c<a.boxes.length;c++)if(a.boxes[c].boxtype===b)return a.boxes[c];return null},a.getBoxPositionByType=function(a,b){for(var c=0,d=0;d<a.boxes.length;d++){if(a.boxes[d].boxtype===b)return c;c+=a.boxes[d].size}return null},a.removeBoxByType=function(a,b){for(var c=0;c<a.boxes.length;c++)a.boxes[c].boxtype===b&&a.boxes.splice(c,1)},a.ParseException=function(a){this.message=a,this.name="ParseException"},a.DataIntegrityException=function(a){this.message=a,this.name="DataIntegrityException"},a}();if("undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=mp4lib:window.mp4lib=mp4lib,"undefined"!=typeof require)var mp4lib=require("./mp4lib.js");if(mp4lib.boxes.File=function(){},mp4lib.boxes.File.prototype._processFields=function(a){a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.boxes.Box=function(){this.size=null,this.boxtype=null},mp4lib.boxes.Box.prototype._processFields=function(a){a.eat("size",mp4lib.fields.FIELD_UINT32),a.eat("boxtype",mp4lib.fields.FIELD_ID),1==this.size&&a.eat("largesize",mp4lib.fields.FIELD_INT64),("uuid"==this.boxtype||mp4lib.findUUIDByBoxtype(this.boxtype))&&a.eat("usertype",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16))},mp4lib.boxes.FullBox=function(){},mp4lib.boxes.FullBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("version",mp4lib.fields.FIELD_INT8),a.eat("flags",mp4lib.fields.FIELD_BIT24)},mp4lib.boxes.UnknownBox=function(){},mp4lib.boxes.UnknownBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("unrecognized_data",new mp4lib.fields.BoxFillingDataField)},mp4lib.boxes.FileTypeBox=function(){},mp4lib.boxes.FileTypeBox.prototype.boxtype="ftyp",mp4lib.boxes.FileTypeBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("major_brand",mp4lib.fields.FIELD_INT32),a.eat("minor_brand",mp4lib.fields.FIELD_INT32),a.eat("compatible_brands",new mp4lib.fields.BoxFillingArrayField(mp4lib.fields.FIELD_INT32))},mp4lib.registerBoxType(mp4lib.boxes.FileTypeBox),mp4lib.boxes.MovieBox=function(){},mp4lib.boxes.MovieBox.prototype.boxtype="moov",mp4lib.boxes.MovieBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)
},mp4lib.registerBoxType(mp4lib.boxes.MovieBox),mp4lib.boxes.MovieFragmentBox=function(){},mp4lib.boxes.MovieFragmentBox.prototype.boxtype="moof",mp4lib.boxes.MovieFragmentBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.MovieFragmentBox),mp4lib.boxes.MovieFragmentRandomAccessBox=function(){},mp4lib.boxes.MovieFragmentRandomAccessBox.prototype.boxtype="mfra",mp4lib.boxes.MovieFragmentRandomAccessBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.MovieFragmentRandomAccessBox),mp4lib.boxes.UserDataBox=function(){},mp4lib.boxes.UserDataBox.prototype.boxtype="udta",mp4lib.boxes.UserDataBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.UserDataBox),mp4lib.boxes.TrackBox=function(){},mp4lib.boxes.TrackBox.prototype.boxtype="trak",mp4lib.boxes.TrackBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.TrackBox),mp4lib.boxes.EditBox=function(){},mp4lib.boxes.EditBox.prototype.boxtype="edts",mp4lib.boxes.EditBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.EditBox),mp4lib.boxes.MediaBox=function(){},mp4lib.boxes.MediaBox.prototype.boxtype="mdia",mp4lib.boxes.MediaBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.MediaBox),mp4lib.boxes.MediaInformationBox=function(){},mp4lib.boxes.MediaInformationBox.prototype.boxtype="minf",mp4lib.boxes.MediaInformationBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.MediaInformationBox),mp4lib.boxes.DataInformationBox=function(){},mp4lib.boxes.DataInformationBox.prototype.boxtype="dinf",mp4lib.boxes.DataInformationBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.DataInformationBox),mp4lib.boxes.SampleTableBox=function(){},mp4lib.boxes.SampleTableBox.prototype.boxtype="stbl",mp4lib.boxes.SampleTableBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.SampleTableBox),mp4lib.boxes.MovieExtendsBox=function(){},mp4lib.boxes.MovieExtendsBox.prototype.boxtype="mvex",mp4lib.boxes.MovieExtendsBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.MovieExtendsBox),mp4lib.boxes.TrackFragmentBox=function(){},mp4lib.boxes.TrackFragmentBox.prototype.boxtype="traf",mp4lib.boxes.TrackFragmentBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.TrackFragmentBox),mp4lib.boxes.MetaBox=function(){},mp4lib.boxes.MetaBox.prototype.boxtype="meta",mp4lib.boxes.MetaBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.MetaBox),mp4lib.boxes.MovieHeaderBox=function(){},mp4lib.boxes.MovieHeaderBox.prototype.boxtype="mvhd",mp4lib.boxes.MovieHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1==this.version?(a.eat("creation_time",mp4lib.fields.FIELD_UINT64),a.eat("modification_time",mp4lib.fields.FIELD_UINT64),a.eat("timescale",mp4lib.fields.FIELD_UINT32),a.eat("duration",mp4lib.fields.FIELD_UINT64)):(a.eat("creation_time",mp4lib.fields.FIELD_UINT32),a.eat("modification_time",mp4lib.fields.FIELD_UINT32),a.eat("timescale",mp4lib.fields.FIELD_UINT32),a.eat("duration",mp4lib.fields.FIELD_UINT32)),a.eat("rate",mp4lib.fields.FIELD_INT32),a.eat("volume",mp4lib.fields.FIELD_INT16),a.eat("reserved",mp4lib.fields.FIELD_INT16),a.eat("reserved_2",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT32,2)),a.eat("matrix",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT32,9)),a.eat("pre_defined",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_BIT32,6)),a.eat("next_track_ID",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.MovieHeaderBox),mp4lib.boxes.MediaDataBox=function(){},mp4lib.boxes.MediaDataBox.prototype.boxtype="mdat",mp4lib.boxes.MediaDataBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("data",mp4lib.fields.FIELD_BOX_FILLING_DATA)},mp4lib.registerBoxType(mp4lib.boxes.MediaDataBox),mp4lib.boxes.FreeSpaceBox=function(){},mp4lib.boxes.FreeSpaceBox.prototype.boxtype="free",mp4lib.boxes.FreeSpaceBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("data",mp4lib.fields.FIELD_BOX_FILLING_DATA)},mp4lib.registerBoxType(mp4lib.boxes.FreeSpaceBox),mp4lib.boxes.SegmentIndexBox=function(){},mp4lib.boxes.SegmentIndexBox.prototype.boxtype="sidx",mp4lib.boxes.SegmentIndexBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("reference_ID",mp4lib.fields.FIELD_UINT32),a.eat("timescale",mp4lib.fields.FIELD_UINT32),1==this.version?(a.eat("earliest_presentation_time",mp4lib.fields.FIELD_UINT64),a.eat("first_offset",mp4lib.fields.FIELD_UINT64)):(a.eat("earliest_presentation_time",mp4lib.fields.FIELD_UINT32),a.eat("first_offset",mp4lib.fields.FIELD_UINT32)),a.eat("reserved",mp4lib.fields.FIELD_UINT16),a.isDeserializing||(this.reference_count=this.references.length),a.eat("reference_count",mp4lib.fields.FIELD_UINT16);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.SegmentIndexBox.prototype._processReference),c=new mp4lib.fields.ArrayField(b,this.reference_count);a.eat("references",c)},mp4lib.boxes.SegmentIndexBox.prototype._processReference=function(a,b){b.eat("reference_info",mp4lib.fields.FIELD_UINT64),b.eat("SAP",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.SegmentIndexBox),mp4lib.boxes.TrackHeaderBox=function(){},mp4lib.boxes.TrackHeaderBox.prototype.boxtype="tkhd",mp4lib.boxes.TrackHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1==this.version?(a.eat("creation_time",mp4lib.fields.FIELD_UINT64),a.eat("modification_time",mp4lib.fields.FIELD_UINT64),a.eat("track_id",mp4lib.fields.FIELD_UINT32),a.eat("reserved",mp4lib.fields.FIELD_UINT32),a.eat("duration",mp4lib.fields.FIELD_UINT64)):(a.eat("creation_time",mp4lib.fields.FIELD_UINT32),a.eat("modification_time",mp4lib.fields.FIELD_UINT32),a.eat("track_id",mp4lib.fields.FIELD_UINT32),a.eat("reserved",mp4lib.fields.FIELD_UINT32),a.eat("duration",mp4lib.fields.FIELD_UINT32)),a.eat("reserved_2",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,2)),a.eat("layer",mp4lib.fields.FIELD_INT16),a.eat("alternate_group",mp4lib.fields.FIELD_INT16),a.eat("volume",mp4lib.fields.FIELD_INT16),a.eat("reserved_3",mp4lib.fields.FIELD_INT16),a.eat("matrix",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT32,9)),a.eat("width",mp4lib.fields.FIELD_INT32),a.eat("height",mp4lib.fields.FIELD_INT32)},mp4lib.registerBoxType(mp4lib.boxes.TrackHeaderBox),mp4lib.boxes.MediaHeaderBox=function(){},mp4lib.boxes.MediaHeaderBox.prototype.boxtype="mdhd",mp4lib.boxes.MediaHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1==this.version?(a.eat("creation_time",mp4lib.fields.FIELD_UINT64),a.eat("modification_time",mp4lib.fields.FIELD_UINT64),a.eat("timescale",mp4lib.fields.FIELD_UINT32),a.eat("duration",mp4lib.fields.FIELD_UINT64)):(a.eat("creation_time",mp4lib.fields.FIELD_UINT32),a.eat("modification_time",mp4lib.fields.FIELD_UINT32),a.eat("timescale",mp4lib.fields.FIELD_UINT32),a.eat("duration",mp4lib.fields.FIELD_UINT32)),a.eat("language",mp4lib.fields.FIELD_UINT16),a.eat("reserved",mp4lib.fields.FIELD_UINT16)},mp4lib.registerBoxType(mp4lib.boxes.MediaHeaderBox),mp4lib.boxes.MovieExtendsHeaderBox=function(){},mp4lib.boxes.MovieExtendsHeaderBox.prototype.boxtype="mehd",mp4lib.boxes.MovieExtendsHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1==this.version?a.eat("fragment_duration",mp4lib.fields.FIELD_UINT64):a.eat("fragment_duration",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.MovieExtendsHeaderBox),mp4lib.boxes.HandlerBox=function(){},mp4lib.boxes.HandlerBox.prototype.boxtype="hdlr",mp4lib.boxes.HandlerBox.prototype.HANDLERTYPEVIDEO="vide",mp4lib.boxes.HandlerBox.prototype.HANDLERTYPEAUDIO="soun",mp4lib.boxes.HandlerBox.prototype.HANDLERTYPETEXT="meta",mp4lib.boxes.HandlerBox.prototype.HANDLERVIDEONAME="Video Track",mp4lib.boxes.HandlerBox.prototype.HANDLERAUDIONAME="Audio Track",mp4lib.boxes.HandlerBox.prototype.HANDLERTEXTNAME="Text Track",mp4lib.boxes.HandlerBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("pre_defined",mp4lib.fields.FIELD_UINT32),a.eat("handler_type",mp4lib.fields.FIELD_UINT32),a.eat("reserved",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,3)),a.eat("name",mp4lib.fields.FIELD_STRING)},mp4lib.registerBoxType(mp4lib.boxes.HandlerBox),mp4lib.boxes.TimeToSampleBox=function(){},mp4lib.boxes.TimeToSampleBox.prototype.boxtype="stts",mp4lib.boxes.TimeToSampleBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.entry_count=this.entry.length),a.eat("entry_count",mp4lib.fields.FIELD_UINT_32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.TimeToSampleBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.entry_count);a.eat("entry",c)},mp4lib.boxes.TimeToSampleBox.prototype._processEntry=function(a,b){b.eat("sample_count",mp4lib.fields.FIELD_UINT32),b.eat("sample_delta",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.TimeToSampleBox),mp4lib.boxes.SampleToChunkBox=function(){},mp4lib.boxes.SampleToChunkBox.prototype.boxtype="stsc",mp4lib.boxes.SampleToChunkBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.entry_count=this.entry.length),a.eat("entry_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.SampleToChunkBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.entry_count);a.eat("entry",c)},mp4lib.boxes.SampleToChunkBox.prototype._processEntry=function(a,b){b.eat("first_chunk",mp4lib.fields.FIELD_UINT32),b.eat("samples_per_chunk",mp4lib.fields.FIELD_UINT32),b.eat("samples_description_index",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.SampleToChunkBox),mp4lib.boxes.ChunkOffsetBox=function(){},mp4lib.boxes.ChunkOffsetBox.prototype.boxtype="stco",mp4lib.boxes.ChunkOffsetBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.entry_count=this.chunk_offset.length),a.eat("entry_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,this.entry_count);a.eat("chunk_offset",b)},mp4lib.registerBoxType(mp4lib.boxes.ChunkOffsetBox),mp4lib.boxes.TrackExtendsBox=function(){},mp4lib.boxes.TrackExtendsBox.prototype.boxtype="trex",mp4lib.boxes.TrackExtendsBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("track_ID",mp4lib.fields.FIELD_UINT32),a.eat("default_sample_description_index",mp4lib.fields.FIELD_UINT32),a.eat("default_sample_duration",mp4lib.fields.FIELD_UINT32),a.eat("default_sample_size",mp4lib.fields.FIELD_UINT32),a.eat("default_sample_flags",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.TrackExtendsBox),mp4lib.boxes.VideoMediaHeaderBox=function(){},mp4lib.boxes.VideoMediaHeaderBox.prototype.boxtype="vmhd",mp4lib.boxes.VideoMediaHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("graphicsmode",mp4lib.fields.FIELD_INT16),a.eat("opcolor",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT16,3))},mp4lib.registerBoxType(mp4lib.boxes.VideoMediaHeaderBox),mp4lib.boxes.SoundMediaHeaderBox=function(){},mp4lib.boxes.SoundMediaHeaderBox.prototype.boxtype="smhd",mp4lib.boxes.SoundMediaHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("balance",mp4lib.fields.FIELD_INT16),a.eat("reserved",mp4lib.fields.FIELD_UINT16)},mp4lib.registerBoxType(mp4lib.boxes.SoundMediaHeaderBox),mp4lib.boxes.DataReferenceBox=function(){},mp4lib.boxes.DataReferenceBox.prototype.boxtype="dref",mp4lib.boxes.DataReferenceBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.entry_count=this.boxes.length),a.eat("entry_count",mp4lib.fields.FIELD_UINT32),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.DataReferenceBox),mp4lib.boxes.DataEntryUrlBox=function(){},mp4lib.boxes.DataEntryUrlBox.prototype.boxtype="url ",mp4lib.boxes.DataEntryUrlBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing?this.flags&!1&&a.eat("location",mp4lib.fields.FIELD_STRING):"location"in this&&(this.flags=1|this.flags,a.eat("location",mp4lib.fields.FIELD_STRING))},mp4lib.registerBoxType(mp4lib.boxes.DataEntryUrlBox),mp4lib.boxes.DataEntryUrnBox=function(){},mp4lib.boxes.DataEntryUrnBox.prototype.boxtype="urn ",mp4lib.boxes.DataEntryUrnBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),this.flags&!1&&(a.eat("name",mp4lib.fields.FIELD_STRING),a.eat("location",mp4lib.fields.FIELD_STRING))},mp4lib.registerBoxType(mp4lib.boxes.DataEntryUrnBox),mp4lib.boxes.MovieFragmentHeaderBox=function(){},mp4lib.boxes.MovieFragmentHeaderBox.prototype.boxtype="mfhd",mp4lib.boxes.MovieFragmentHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("sequence_number",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.MovieFragmentHeaderBox),mp4lib.boxes.TrackFragmentHeaderBox=function(){},mp4lib.boxes.TrackFragmentHeaderBox.prototype.boxtype="tfhd",mp4lib.boxes.TrackFragmentHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("track_ID",mp4lib.fields.FIELD_UINT32),a.eat_flagged(this,"flags",1,"base_data_offset",mp4lib.fields.FIELD_UINT64),a.eat_flagged(this,"flags",2,"sample_description_index",mp4lib.fields.FIELD_UINT32),a.eat_flagged(this,"flags",8,"default_sample_duration",mp4lib.fields.FIELD_UINT32),a.eat_flagged(this,"flags",16,"default_sample_size",mp4lib.fields.FIELD_UINT32),a.eat_flagged(this,"flags",32,"default_sample_flags",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.TrackFragmentHeaderBox),mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox=function(){},mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.boxtype="tfdt",mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1==this.version?a.eat("baseMediaDecodeTime",mp4lib.fields.FIELD_UINT64):a.eat("baseMediaDecodeTime",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox),mp4lib.boxes.TrackFragmentRunBox=function(){},mp4lib.boxes.TrackFragmentRunBox.prototype.boxtype="trun",mp4lib.boxes.TrackFragmentRunBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.sample_count=this.samples_table.length),a.eat("sample_count",mp4lib.fields.FIELD_UINT32),a.eat_flagged(this,"flags",1,"data_offset",mp4lib.fields.FIELD_INT32),a.eat_flagged(this,"flags",4,"first_sample_flags",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.TrackFragmentRunBox.prototype._processEntry);a.eat("samples_table",new mp4lib.fields.ArrayField(b,this.sample_count))},mp4lib.boxes.TrackFragmentRunBox.prototype._processEntry=function(a,b){b.eat_flagged(a,"flags",256,"sample_duration",mp4lib.fields.FIELD_UINT32),b.eat_flagged(a,"flags",512,"sample_size",mp4lib.fields.FIELD_UINT32),b.eat_flagged(a,"flags",1024,"sample_flags",mp4lib.fields.FIELD_UINT32),1==a.version?b.eat_flagged(a,"flags",2048,"sample_composition_time_offset",mp4lib.fields.FIELD_INT32):b.eat_flagged(a,"flags",2048,"sample_composition_time_offset",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.TrackFragmentRunBox),mp4lib.boxes.TimeToSampleBox=function(){},mp4lib.boxes.TimeToSampleBox.prototype.boxtype="stts",mp4lib.boxes.TimeToSampleBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.entry_count=this.entry.length),a.eat("entry_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.TimeToSampleBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.entry_count);a.eat("entry",c)},mp4lib.boxes.TimeToSampleBox.prototype._processEntry=function(a,b){b.eat("sample_count",mp4lib.fields.FIELD_UINT32),b.eat("sample_delta",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.TimeToSampleBox),mp4lib.boxes.SampleDescriptionBox=function(){},mp4lib.boxes.SampleDescriptionBox.prototype.boxtype="stsd",mp4lib.boxes.SampleDescriptionBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.isDeserializing||(this.entry_count=this.boxes.length),a.eat("entry_count",mp4lib.fields.FIELD_UINT32),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.SampleDescriptionBox),mp4lib.boxes.SampleDependencyTableBox=function(){},mp4lib.boxes.SampleDependencyTableBox.prototype.boxtype="sdtp",mp4lib.boxes.SampleDependencyTableBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("sample_dependency_array",new mp4lib.fields.BoxFillingArrayField(mp4lib.fields.FIELD_UINT8))},mp4lib.registerBoxType(mp4lib.boxes.SampleDependencyTableBox),mp4lib.boxes.SampleEntryBox=function(){},mp4lib.boxes.SampleEntryBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("reserved",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT8,6)),a.eat("data_reference_index",mp4lib.fields.FIELD_UINT16)},mp4lib.boxes.VisualSampleEntryBox=function(){},mp4lib.boxes.VisualSampleEntryBox.prototype._processFields=function(a){mp4lib.boxes.SampleEntryBox.prototype._processFields.call(this,a),a.eat("pre_defined",mp4lib.fields.FIELD_UINT16),a.eat("reserved_2",mp4lib.fields.FIELD_UINT16),a.eat("pre_defined_2",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,3)),a.eat("width",mp4lib.fields.FIELD_UINT16),a.eat("height",mp4lib.fields.FIELD_UINT16),a.eat("horizresolution",mp4lib.fields.FIELD_UINT32),a.eat("vertresolution",mp4lib.fields.FIELD_UINT32),a.eat("reserved_3",mp4lib.fields.FIELD_UINT32),a.eat("frame_count",mp4lib.fields.FIELD_UINT16),a.eat("compressorname",new mp4lib.fields.FixedLenStringField(32)),a.eat("depth",mp4lib.fields.FIELD_UINT16),a.eat("pre_defined_3",mp4lib.fields.FIELD_INT16),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.boxes.AVC1VisualSampleEntryBox=function(){},mp4lib.boxes.AVC1VisualSampleEntryBox.prototype.boxtype="avc1",mp4lib.boxes.AVC1VisualSampleEntryBox.prototype._processFields=function(a){mp4lib.boxes.VisualSampleEntryBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.AVC1VisualSampleEntryBox),mp4lib.boxes.EncryptedVideoBox=function(){},mp4lib.boxes.EncryptedVideoBox.prototype.boxtype="encv",mp4lib.boxes.EncryptedVideoBox.prototype._processFields=function(a){mp4lib.boxes.VisualSampleEntryBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.EncryptedVideoBox),mp4lib.boxes.AVCConfigurationBox=function(){},mp4lib.boxes.AVCConfigurationBox.prototype.boxtype="avcC",mp4lib.boxes.AVCConfigurationBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("configurationVersion",mp4lib.fields.FIELD_UINT8),a.eat("AVCProfileIndication",mp4lib.fields.FIELD_UINT8),a.eat("profile_compatibility",mp4lib.fields.FIELD_UINT8),a.eat("AVCLevelIndication",mp4lib.fields.FIELD_UINT8),a.isDeserializing?(a.eat("temp",mp4lib.fields.FIELD_UINT8),this.lengthSizeMinusOne=3&this.temp,a.eat("numOfSequenceParameterSets_tmp",mp4lib.fields.FIELD_UINT8),this.numOfSequenceParameterSets=31&this.numOfSequenceParameterSets_tmp):(this.temp=252|this.lengthSizeMinusOne,a.eat("temp",mp4lib.fields.FIELD_UINT8),this.numOfSequenceParameterSets=this.SPS_NAL.length,this.numOfSequenceParameterSets_tmp=224|this.numOfSequenceParameterSets,a.eat("numOfSequenceParameterSets_tmp",mp4lib.fields.FIELD_UINT8)),a.eat("SPS_NAL",new mp4lib.fields.VariableElementSizeArrayField(new mp4lib.fields.StructureField(this,mp4lib.boxes.AVCConfigurationBox.prototype._processNAL),this.numOfSequenceParameterSets)),a.eat("numOfPictureParameterSets",mp4lib.fields.FIELD_UINT8),a.eat("PPS_NAL",new mp4lib.fields.VariableElementSizeArrayField(new mp4lib.fields.StructureField(this,mp4lib.boxes.AVCConfigurationBox.prototype._processNAL),this.numOfPictureParameterSets))},mp4lib.boxes.AVCConfigurationBox.prototype._processNAL=function(a,b){b.eat("NAL_length",mp4lib.fields.FIELD_UINT16),b.eat("NAL",new mp4lib.fields.DataField(this.NAL_length))},mp4lib.registerBoxType(mp4lib.boxes.AVCConfigurationBox),mp4lib.boxes.PixelAspectRatioBox=function(){},mp4lib.boxes.PixelAspectRatioBox.prototype.boxtype="pasp",mp4lib.boxes.PixelAspectRatioBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("hSpacing",mp4lib.fields.FIELD_INT32),a.eat("vSpacing",mp4lib.fields.FIELD_INT32)},mp4lib.registerBoxType(mp4lib.boxes.PixelAspectRatioBox),mp4lib.boxes.AudioSampleEntryBox=function(){},mp4lib.boxes.AudioSampleEntryBox.prototype._processFields=function(a){mp4lib.boxes.SampleEntryBox.prototype._processFields.call(this,a),a.eat("reserved_2",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,2)),a.eat("channelcount",mp4lib.fields.FIELD_UINT16),a.eat("samplesize",mp4lib.fields.FIELD_UINT16),a.eat("pre_defined",mp4lib.fields.FIELD_UINT16),a.eat("reserved_3",mp4lib.fields.FIELD_UINT16),a.eat("samplerate",mp4lib.fields.FIELD_UINT32),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.boxes.MP4AudioSampleEntryBox=function(){},mp4lib.boxes.MP4AudioSampleEntryBox.prototype.boxtype="mp4a",mp4lib.boxes.MP4AudioSampleEntryBox.prototype._processFields=function(a){mp4lib.boxes.AudioSampleEntryBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.MP4AudioSampleEntryBox),mp4lib.boxes.EncryptedAudioBox=function(){},mp4lib.boxes.EncryptedAudioBox.prototype.boxtype="enca",mp4lib.boxes.EncryptedAudioBox.prototype._processFields=function(a){mp4lib.boxes.AudioSampleEntryBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.EncryptedAudioBox),mp4lib.boxes.ESDBox=function(){},mp4lib.boxes.ESDBox.prototype.boxtype="esds",mp4lib.boxes.ESDBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("ES_tag",mp4lib.fields.FIELD_UINT8),a.eat("ES_length",mp4lib.fields.FIELD_UINT8),a.eat("ES_data",new mp4lib.fields.DataField(this.ES_length))},mp4lib.registerBoxType(mp4lib.boxes.ESDBox),mp4lib.boxes.SampleSizeBox=function(){},mp4lib.boxes.SampleSizeBox.prototype.boxtype="stsz",mp4lib.boxes.SampleSizeBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("sample_size",mp4lib.fields.FIELD_UINT32),a.eat("sample_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,this.sample_count);a.eat("entries",b)},mp4lib.registerBoxType(mp4lib.boxes.SampleSizeBox),mp4lib.boxes.ProtectionSystemSpecificHeaderBox=function(){},mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype.boxtype="pssh",mp4lib.boxes.ProtectionSystemSpecificHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("SystemID",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT8,16)),a.eat("DataSize",mp4lib.fields.FIELD_UINT32),a.eat("Data",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT8,this.DataSize))},mp4lib.registerBoxType(mp4lib.boxes.ProtectionSystemSpecificHeaderBox),mp4lib.boxes.SampleAuxiliaryInformationSizesBox=function(){},mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype.boxtype="saiz",mp4lib.boxes.SampleAuxiliaryInformationSizesBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1&this.flags&&(a.eat("aux_info_type",mp4lib.fields.FIELD_UINT32),a.eat("aux_info_type_parameter",mp4lib.fields.FIELD_UINT32)),a.eat("default_sample_info_size",mp4lib.fields.FIELD_UINT8),a.eat("sample_count",mp4lib.fields.FIELD_UINT32),0===this.default_sample_info_size&&a.eat("sample_info_size",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT8,this.sample_count))},mp4lib.registerBoxType(mp4lib.boxes.SampleAuxiliaryInformationSizesBox),mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox=function(){},mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.boxtype="saio",mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1&this.flags&&(a.eat("aux_info_type",mp4lib.fields.FIELD_UINT32),a.eat("aux_info_type_parameter",mp4lib.fields.FIELD_UINT32)),a.eat("entry_count",mp4lib.fields.FIELD_UINT32),0===this.version?a.eat("offset",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT32,this.entry_count)):a.eat("offset",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT64,this.entry_count))},mp4lib.registerBoxType(mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox),mp4lib.boxes.ProtectionSchemeInformationBox=function(){},mp4lib.boxes.ProtectionSchemeInformationBox.prototype.boxtype="sinf",mp4lib.boxes.ProtectionSchemeInformationBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.ProtectionSchemeInformationBox),mp4lib.boxes.SchemeInformationBox=function(){},mp4lib.boxes.SchemeInformationBox.prototype.boxtype="schi",mp4lib.boxes.SchemeInformationBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("boxes",mp4lib.fields.FIELD_CONTAINER_CHILDREN)},mp4lib.registerBoxType(mp4lib.boxes.SchemeInformationBox),mp4lib.boxes.TrackEncryptionBox=function(){},mp4lib.boxes.TrackEncryptionBox.prototype.boxtype="tenc",mp4lib.boxes.TrackEncryptionBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("default_IsEncrypted",mp4lib.fields.FIELD_BIT24),a.eat("default_IV_size",mp4lib.fields.FIELD_UINT8),a.eat("default_KID",new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_UINT8,16))},mp4lib.registerBoxType(mp4lib.boxes.TrackEncryptionBox),mp4lib.boxes.SchemeTypeBox=function(){},mp4lib.boxes.SchemeTypeBox.prototype.boxtype="schm",mp4lib.boxes.SchemeTypeBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("scheme_type",mp4lib.fields.FIELD_UINT32),a.eat("scheme_version",mp4lib.fields.FIELD_UINT32),1&this.flags&&a.eat("scheme_uri",mp4lib.fields.FIELD_STRING)},mp4lib.registerBoxType(mp4lib.boxes.SchemeTypeBox),mp4lib.boxes.EditListBox=function(){},mp4lib.boxes.EditListBox.prototype.boxtype="elst",mp4lib.boxes.EditListBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("entry_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.EditListBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.entry_count);a.eat("entries",c)},mp4lib.boxes.EditListBox.prototype._processEntry=function(a,b){1==a.version?(b.eat("segment_duration",mp4lib.fields.FIELD_UINT64),b.eat("media_time",mp4lib.fields.FIELD_UINT64)):(b.eat("segment_duration",mp4lib.fields.FIELD_UINT32),b.eat("media_time",mp4lib.fields.FIELD_UINT32)),b.eat("media_rate_integer",mp4lib.fields.FIELD_UINT16),b.eat("media_rate_fraction",mp4lib.fields.FIELD_UINT16)},mp4lib.registerBoxType(mp4lib.boxes.EditListBox),mp4lib.boxes.HintMediaHeaderBox=function(){},mp4lib.boxes.HintMediaHeaderBox.prototype.boxtype="hmhd",mp4lib.boxes.HintMediaHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("maxPDUsize",mp4lib.fields.FIELD_UINT16),a.eat("avgPDUsize",mp4lib.fields.FIELD_UINT16),a.eat("maxbitrate",mp4lib.fields.FIELD_UINT32),a.eat("avgbitrate",mp4lib.fields.FIELD_UINT32),a.eat("reserved",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.HintMediaHeaderBox),mp4lib.boxes.NullMediaHeaderBox=function(){},mp4lib.boxes.NullMediaHeaderBox.prototype.boxtype="nmhd",mp4lib.boxes.NullMediaHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.NullMediaHeaderBox),mp4lib.boxes.CompositionOffsetBox=function(){},mp4lib.boxes.CompositionOffsetBox.prototype.boxtype="ctts",mp4lib.boxes.CompositionOffsetBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("entry_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.CompositionOffsetBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.entry_count);a.eat("entries",c)},mp4lib.boxes.CompositionOffsetBox.prototype._processEntry=function(a,b){0===a.version?(b.eat("sample_count",mp4lib.fields.FIELD_UINT32),b.eat("sample_offset",mp4lib.fields.FIELD_UINT32)):(b.eat("sample_count",mp4lib.fields.FIELD_UINT32),b.eat("sample_offset",mp4lib.fields.FIELD_INT32))},mp4lib.registerBoxType(mp4lib.boxes.CompositionOffsetBox),mp4lib.boxes.CompositionToDecodeBox=function(){},mp4lib.boxes.CompositionToDecodeBox.prototype.boxtype="cslg",mp4lib.boxes.CompositionToDecodeBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("compositionToDTSShift",mp4lib.fields.FIELD_INT32),a.eat("leastDecodeToDisplayDelta",mp4lib.fields.FIELD_INT32),a.eat("greatestDecodeToDisplayDelta",mp4lib.fields.FIELD_INT32),a.eat("compositionStartTime",mp4lib.fields.FIELD_INT32),a.eat("compositionEndTime",mp4lib.fields.FIELD_INT32)},mp4lib.registerBoxType(mp4lib.boxes.CompositionToDecodeBox),mp4lib.boxes.SyncSampleBox=function(){},mp4lib.boxes.SyncSampleBox.prototype.boxtype="stss",mp4lib.boxes.SyncSampleBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("entry_count",mp4lib.fields.FIELD_UINT32);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.SyncSampleBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.entry_count);a.eat("entries",c)},mp4lib.boxes.SyncSampleBox.prototype._processEntry=function(a,b){b.eat("sample_number",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.SyncSampleBox),mp4lib.boxes.TrackReferenceBox=function(){},mp4lib.boxes.TrackReferenceBox.prototype.boxtype="tref",mp4lib.boxes.TrackReferenceBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("track_IDs",new mp4lib.fields.BoxFillingArrayField(mp4lib.fields.FIELD_UINT32))
},mp4lib.registerBoxType(mp4lib.boxes.TrackReferenceBox),mp4lib.boxes.OriginalFormatBox=function(){},mp4lib.boxes.OriginalFormatBox.prototype.boxtype="frma",mp4lib.boxes.OriginalFormatBox.prototype._processFields=function(a){mp4lib.boxes.Box.prototype._processFields.call(this,a),a.eat("data_format",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.OriginalFormatBox),mp4lib.boxes.PiffSampleEncryptionBox=function(){},mp4lib.boxes.PiffSampleEncryptionBox.prototype.boxtype="sepiff",mp4lib.boxes.PiffSampleEncryptionBox.prototype.uuid=[162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244],mp4lib.boxes.PiffSampleEncryptionBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("sample_count",mp4lib.fields.FIELD_UINT32),1&this.flags&&a.eat("IV_size",mp4lib.fields.FIELD_UINT8);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.PiffSampleEncryptionBox.prototype._processEntry),c=new mp4lib.fields.VariableElementSizeArrayField(b,this.sample_count);a.eat("entry",c)},mp4lib.boxes.PiffSampleEncryptionBox.prototype._processEntry=function(a,b){if(b.eat("InitializationVector",new mp4lib.fields.DataField(8)),2&a.flags){b.eat("NumberOfEntries",mp4lib.fields.FIELD_UINT16);var c=new mp4lib.fields.StructureField(this,mp4lib.boxes.PiffSampleEncryptionBox.prototype._processClearEntry),d=new mp4lib.fields.ArrayField(c,this.NumberOfEntries);b.eat("clearAndCryptedData",d)}},mp4lib.boxes.PiffSampleEncryptionBox.prototype._processClearEntry=function(a,b){b.eat("BytesOfClearData",mp4lib.fields.FIELD_UINT16),b.eat("BytesOfEncryptedData",mp4lib.fields.FIELD_UINT32)},mp4lib.registerBoxType(mp4lib.boxes.PiffSampleEncryptionBox),mp4lib.boxes.PiffTrackEncryptionBox=function(){},mp4lib.boxes.PiffTrackEncryptionBox.prototype.boxtype="tepiff",mp4lib.boxes.PiffTrackEncryptionBox.prototype.uuid=[137,116,219,206,123,231,76,81,132,249,113,72,249,136,37,84],mp4lib.boxes.PiffTrackEncryptionBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.PiffTrackEncryptionBox),mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox=function(){},mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox.prototype.boxtype="psshpiff",mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox.prototype.uuid=[208,138,79,24,16,243,74,130,182,200,50,216,171,161,131,211],mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a)},mp4lib.registerBoxType(mp4lib.boxes.PiffProtectionSystemSpecificHeaderBox),mp4lib.boxes.TfxdBox=function(){},mp4lib.boxes.TfxdBox.prototype.boxtype="tfxd",mp4lib.boxes.TfxdBox.prototype.uuid=[109,29,155,5,66,213,68,230,128,226,20,29,175,247,87,178],mp4lib.boxes.TfxdBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),1==this.version?(a.eat("fragment_absolute_time",mp4lib.fields.FIELD_UINT64),a.eat("fragment_duration",mp4lib.fields.FIELD_UINT64)):(a.eat("fragment_absolute_time",mp4lib.fields.FIELD_UINT32),a.eat("fragment_duration",mp4lib.fields.FIELD_UINT32))},mp4lib.registerBoxType(mp4lib.boxes.TfxdBox),mp4lib.boxes.TfrfBox=function(){},mp4lib.boxes.TfrfBox.prototype.boxtype="tfrf",mp4lib.boxes.TfrfBox.prototype.uuid=[212,128,126,242,202,57,70,149,142,84,38,203,158,70,167,159],mp4lib.boxes.TfrfBox.prototype._processFields=function(a){mp4lib.boxes.FullBox.prototype._processFields.call(this,a),a.eat("fragment_count",mp4lib.fields.FIELD_UINT8);var b=new mp4lib.fields.StructureField(this,mp4lib.boxes.TfrfBox.prototype._processEntry),c=new mp4lib.fields.ArrayField(b,this.fragment_count);a.eat("entry",c)},mp4lib.boxes.TfrfBox.prototype._processEntry=function(a,b){1==a.version?(b.eat("fragment_absolute_time",mp4lib.fields.FIELD_UINT64),b.eat("fragment_duration",mp4lib.fields.FIELD_UINT64)):(b.eat("fragment_absolute_time",mp4lib.fields.FIELD_UINT32),b.eat("fragment_duration",mp4lib.fields.FIELD_UINT32))},mp4lib.registerBoxType(mp4lib.boxes.TfrfBox),"undefined"!=typeof require)var mp4lib=require("./mp4lib.js");if(mp4lib.fieldProcessors.SerializationBoxFieldsProcessor=function(a,b,c){this.box=a,this.buf=b,this.pos=c,this.isDeserializing=!1},mp4lib.fieldProcessors.SerializationBoxFieldsProcessor.prototype.eat=function(a,b){b.write(this.buf,this.pos,this.box[a]),this.pos+=b.getLength(this.box[a])},mp4lib.fieldProcessors.SerializationBoxFieldsProcessor.prototype.eat_flagged=function(a,b,c,d,e){0!==(a[b]&c)&&this.eat(d,e)},mp4lib.fieldProcessors.DeserializationBoxFieldsProcessor=function(a,b,c,d){this.box=a,this.buf=b,this.pos=c,this.bufferStart=c,this.bufferEnd=d,this.end=d,this.isDeserializing=!0},mp4lib.fieldProcessors.DeserializationBoxFieldsProcessor.prototype.eat=function(a,b){if(void 0===b)throw new mp4lib.ParseException("Undefined fieldtype for field "+a);var c=b.read(this.buf,this.pos,this.end);if(this.box[a]=c,"size"==a&&(this.end=this.bufferStart+c,this.end>this.bufferEnd))throw new mp4lib.ParseException("Deserialization error: Box size exceeds buffer ("+this.box.boxtype+")");this.pos+=b.getLength(c)},mp4lib.fieldProcessors.DeserializationBoxFieldsProcessor.prototype.eat_flagged=function(a,b,c,d,e){0!==(a[b]&c)&&this.eat(d,e)},mp4lib.fieldProcessors.LengthCounterBoxFieldsProcessor=function(a){this.box=a,this.res=0,this.isDeserializing=!1},mp4lib.fieldProcessors.LengthCounterBoxFieldsProcessor.prototype.eat=function(a,b){var c=b.getLength(this.box[a]);if(isNaN(c))throw new mp4lib.DataIntegrityException("ERROR counting size of "+a+" in "+this.box.boxtype+" = "+c);this.res+=c},mp4lib.fieldProcessors.LengthCounterBoxFieldsProcessor.prototype.eat_flagged=function(a,b,c,d,e){d in this.box&&this.eat(d,e)},"undefined"!=typeof require)var mp4lib=require("./mp4lib.js"),goog={math:{Long:require("long")}};mp4lib.fields.readBytes=function(a,b,c){for(var d=0,e=0;c>e;e++)d<<=8,d+=a[b],b++;return d},mp4lib.fields.writeBytes=function(a,b,c,d){for(var e=0;c>e;e++)a[b+c-e-1]=255&d,d>>=8},mp4lib.fields.NumberField=function(a,b){this.bits=a,this.signed=b},mp4lib.fields.NumberField.prototype.read=function(a,b){return mp4lib.fields.readBytes(a,b,this.bits/8)},mp4lib.fields.NumberField.prototype.write=function(a,b,c){mp4lib.fields.writeBytes(a,b,this.bits/8,c)},mp4lib.fields.NumberField.prototype.getLength=function(){return this.bits/8},mp4lib.fields.LongNumberField=function(){},mp4lib.fields.LongNumberField.prototype.read=function(a,b){var c=mp4lib.fields.readBytes(a,b,4),d=mp4lib.fields.readBytes(a,b+4,4);return goog.math.Long.fromBits(d,c).toNumber()},mp4lib.fields.LongNumberField.prototype.write=function(a,b,c){var d=goog.math.Long.fromNumber(c),e=d.getLowBits(),f=d.getHighBits();mp4lib.fields.writeBytes(a,b,4,f),mp4lib.fields.writeBytes(a,b+4,4,e)},mp4lib.fields.LongNumberField.prototype.getLength=function(){return 8},mp4lib.fields.FixedLenStringField=function(a){this.size=a},mp4lib.fields.FixedLenStringField.prototype.read=function(a,b){for(var c="",d=0;d<this.size;d++)c+=String.fromCharCode(a[b+d]);return c},mp4lib.fields.FixedLenStringField.prototype.write=function(a,b,c){for(var d=0;d<this.size;d++)a[b+d]=c.charCodeAt(d)},mp4lib.fields.FixedLenStringField.prototype.getLength=function(){return this.size},mp4lib.fields.BoxTypeField=function(){},mp4lib.fields.BoxTypeField.prototype.read=function(a,b){for(var c="",d=0;4>d;d++)c+=String.fromCharCode(a[b+d]);return c},mp4lib.fields.BoxTypeField.prototype.write=function(a,b,c){mp4lib.findUUIDByBoxtype(c)&&(c="uuid");for(var d=0;4>d;d++)a[b+d]=c.charCodeAt(d)},mp4lib.fields.BoxTypeField.prototype.getLength=function(){return 4},mp4lib.fields.StringField=function(){},mp4lib.fields.StringField.prototype.read=function(a,b,c){for(var d="",e=b;c>e;e++)if(d+=String.fromCharCode(a[e]),0===a[e])return d;if(255>c-b&&a[0]==String.fromCharCode(c-b))return d=d.substr(1,c-b),mp4lib.warningHandler('null-terminated string expected, but found a string "'+d+'", which seems to be length-prefixed instead. Conversion done.'),d;throw new mp4lib.ParseException('expected null-terminated string, but end of field reached without termination. Read so far:"'+d+'"')},mp4lib.fields.StringField.prototype.write=function(a,b,c){for(var d=0;d<c.length;d++)a[b+d]=c.charCodeAt(d);a[b+c.length]=0},mp4lib.fields.StringField.prototype.getLength=function(a){return a.length},mp4lib.fields.BoxFillingDataField=function(){},mp4lib.fields.BoxFillingDataField.prototype.read=function(a,b,c){var d=a.subarray(b,c);return d},mp4lib.fields.BoxFillingDataField.prototype.write=function(a,b,c){a.set(c,b)},mp4lib.fields.BoxFillingDataField.prototype.getLength=function(a){return a.length},mp4lib.fields.DataField=function(a){this.len=a},mp4lib.fields.DataField.prototype.read=function(a,b){var c=a.subarray(b,b+this.len);return c},mp4lib.fields.DataField.prototype.write=function(a,b,c){a.set(c,b)},mp4lib.fields.DataField.prototype.getLength=function(){return this.len},mp4lib.fields.ArrayField=function(a,b){this.innerField=a,this.size=b},mp4lib.fields.ArrayField.prototype.read=function(a,b){for(var c=-1,d=[],e=0;e<this.size;e++)d.push(this.innerField.read(a,b)),-1==c&&(c=this.innerField.getLength(d[e])),b+=c;return d},mp4lib.fields.ArrayField.prototype.write=function(a,b,c){var d=0;this.size>0&&(d=this.innerField.getLength(c[0]));for(var e=0;e<this.size;e++)this.innerField.write(a,b,c[e]),b+=d},mp4lib.fields.ArrayField.prototype.getLength=function(a){var b=0;return this.size>0&&(b=this.innerField.getLength(a[0])),this.size*b},mp4lib.fields.VariableElementSizeArrayField=function(a,b){this.innerField=a,this.size=b},mp4lib.fields.VariableElementSizeArrayField.prototype.read=function(a,b){for(var c=[],d=0;d<this.size;d++)c.push(this.innerField.read(a,b)),b+=this.innerField.getLength(c[d]);return c},mp4lib.fields.VariableElementSizeArrayField.prototype.write=function(a,b,c){for(var d=0;d<this.size;d++)this.innerField.write(a,b,c[d]),b+=this.innerField.getLength(c[d])},mp4lib.fields.VariableElementSizeArrayField.prototype.getLength=function(a){for(var b=0,c=0;c<this.size;c++)b+=this.innerField.getLength(a[c]);return b},mp4lib.fields.BoxFillingArrayField=function(a){this.innerField=a,this.innerFieldLength=a.getLength()},mp4lib.fields.BoxFillingArrayField.prototype.read=function(a,b,c){for(var d=[],e=(c-b)/this.innerFieldLength,f=0;e>f;f++)d.push(this.innerField.read(a,b)),b+=this.innerFieldLength;return d},mp4lib.fields.BoxFillingArrayField.prototype.write=function(a,b,c){for(var d=0;d<c.length;d++)this.innerField.write(a,b,c[d]),b+=this.innerFieldLength},mp4lib.fields.BoxFillingArrayField.prototype.getLength=function(a){return a.length*this.innerFieldLength},mp4lib.fields.StructureField=function(a,b){this.box=a,this._processStructureFields=b},mp4lib.fields.StructureField.prototype.read=function(a,b,c){var d={},e=new mp4lib.fieldProcessors.DeserializationBoxFieldsProcessor(d,a,b,c);return this._processStructureFields.call(d,this.box,e),d},mp4lib.fields.StructureField.prototype.write=function(a,b,c){var d=new mp4lib.fieldProcessors.SerializationBoxFieldsProcessor(c,a,b);this._processStructureFields.call(c,this.box,d)},mp4lib.fields.StructureField.prototype.getLength=function(a){var b=new mp4lib.fieldProcessors.LengthCounterBoxFieldsProcessor(a);if(this._processStructureFields.call(a,this.box,b),isNaN(b.res)&&void 0===a)throw new mp4lib.DataIntegrityException("The structure contained in "+this.box.boxtype+" box has undefined size. Possible cause: you have put a variable sized structure into ArrayField (but ArrayField assumes all elements have the same size). If this is the case, use VariableElementsSizeArrayField instead.");return b.res},mp4lib.fields.BoxesListField=function(){},mp4lib.fields.readString=function(a,b,c){for(var d="",e=b;b+c>e;e++)d+=String.fromCharCode(a[e]);return d},mp4lib.fields.BoxesListField.prototype.read=function(a,b,c){for(var d=[];c>b;){var e=mp4lib.fields.FIELD_UINT32.read(a,b),f=mp4lib.fields.readString(a,b+4,4);if("uuid"==f){var g=1==e?16:8,h=new mp4lib.fields.ArrayField(mp4lib.fields.FIELD_INT8,16).read(a,b+g,b+g+16);f=mp4lib.findBoxtypeByUUID(JSON.stringify(h)),void 0===f&&(f="uuid",mp4lib.warningHandler("Unknown UUID:"+JSON.stringify(h)))}var i=mp4lib.createBox(f),j=new mp4lib.fieldProcessors.DeserializationBoxFieldsProcessor(i,a,b,c);if(i._processFields(j),mp4lib.debug&&(i.__sourceBuffer=a.subarray(b,b+i.size)),i.boxtype=f,d.push(i),b+=i.size,0===i.size)throw new mp4lib.ParseException("Zero size of box "+i.boxtype+", parsing stopped to avoid infinite loop")}return d},mp4lib.fields.BoxesListField.prototype.write=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d],f=new mp4lib.fieldProcessors.SerializationBoxFieldsProcessor(e,a,b);e._processFields(f),b+=e.size}},mp4lib.fields.BoxesListField.prototype.getLength=function(a){var b,c=0;for(b=0;b<a.length;b++){var d=a[b],e=new mp4lib.fieldProcessors.LengthCounterBoxFieldsProcessor(d);d._processFields(e),d.size=e.res,c+=e.res}return c},mp4lib.fields.FIELD_INT8=new mp4lib.fields.NumberField(8,!0),mp4lib.fields.FIELD_INT16=new mp4lib.fields.NumberField(16,!0),mp4lib.fields.FIELD_INT32=new mp4lib.fields.NumberField(32,!0),mp4lib.fields.FIELD_INT64=new mp4lib.fields.LongNumberField,mp4lib.fields.FIELD_UINT8=new mp4lib.fields.NumberField(8,!1),mp4lib.fields.FIELD_UINT16=new mp4lib.fields.NumberField(16,!1),mp4lib.fields.FIELD_UINT32=new mp4lib.fields.NumberField(32,!1),mp4lib.fields.FIELD_UINT64=new mp4lib.fields.LongNumberField,mp4lib.fields.FIELD_BIT8=new mp4lib.fields.NumberField(8,!1),mp4lib.fields.FIELD_BIT16=new mp4lib.fields.NumberField(16,!1),mp4lib.fields.FIELD_BIT24=new mp4lib.fields.NumberField(24,!1),mp4lib.fields.FIELD_BIT32=new mp4lib.fields.NumberField(32,!1),mp4lib.fields.FIELD_ID=new mp4lib.fields.BoxTypeField(4),mp4lib.fields.FIELD_CONTAINER_CHILDREN=new mp4lib.fields.BoxesListField,mp4lib.fields.FIELD_STRING=new mp4lib.fields.StringField,mp4lib.fields.FIELD_BOX_FILLING_DATA=new mp4lib.fields.BoxFillingDataField,MediaPlayer=function(a){"use strict";var b,c,d,e,f,g,h="1.1.0",i=a,j=!1,k=!1,l=!0,m=!1,n=MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED,o=function(){return!!c&&!!d},p=function(){if(!j)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!c||!d)throw"Missing view or source.";k=!0,f=b.getObject("streamController"),f.setVideoModel(g),f.setAutoPlay(l),f.load(d,e),b.mapValue("scheduleWhilePaused",m),b.mapOutlet("scheduleWhilePaused","stream"),b.mapValue("bufferMax",n),b.injectInto(this.bufferExt,"bufferMax")},q=function(){o()&&p.call(this)};return b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.injectInto(i),{debug:void 0,eventBus:void 0,capabilities:void 0,abrController:void 0,metricsModel:void 0,metricsExt:void 0,bufferExt:void 0,addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return h},startup:function(){j||(b.injectInto(this),j=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return g},setAutoPlay:function(a){l=a},getAutoPlay:function(){return l},setScheduleWhilePaused:function(a){m=a},getScheduleWhilePaused:function(){return m},setBufferMax:function(a){n=a},getBufferMax:function(){return n},getMetricsExt:function(){return this.metricsExt},getMetricsFor:function(a){var b=this.metricsModel.getReadOnlyMetricsFor(a);return b},getQualityFor:function(a){return this.abrController.getQualityFor(a)},setQualityFor:function(a,b){this.abrController.setPlaybackQuality(a,b)},getAutoSwitchQuality:function(){return this.abrController.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){this.abrController.setAutoSwitchBitrate(a)},setQualityBoundariesFor:function(a,b,c){this.metricsModel.addRepresentationBoundaries(a,new Date,b,c)},setAudioTrack:function(a){f.setAudioTrack(a)},getAudioTracks:function(){return f.getAudioTracks()},attachView:function(a){if(!j)throw"MediaPlayer not initialized!";c=a,g=null,c&&(g=b.getObject("videoModel"),g.setElement(c)),k&&f&&(f.reset(),f=null,k=!1),o.call(this)&&q.call(this)},attachSource:function(a,b){if(!j)throw"MediaPlayer not initialized!";d=a,e=b,this.setQualityFor("video",0),this.setQualityFor("audio",0),k&&f&&(f.reset(),f=null,k=!1),o.call(this)&&q.call(this)},reset:function(){this.attachSource(null),this.attachView(null)},play:p,isReady:o}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel),this.system.mapSingleton("textVTTSourceBuffer",MediaPlayer.dependencies.TextVTTSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("bufferExt",MediaPlayer.dependencies.BufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapClass("abrRulesCollection",MediaPlayer.rules.BaseRulesCollection),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapClass("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapClass("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("requestScheduler",MediaPlayer.dependencies.RequestScheduler),this.system.mapSingleton("schedulerExt",MediaPlayer.dependencies.SchedulerExtensions),this.system.mapClass("schedulerModel",MediaPlayer.dependencies.SchedulerModel)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapClass("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Mss=function(){"use strict";return{dependencies:{}}}(),Custom=function(){"use strict";return{dependencies:{},di:{},models:{},modules:{},utils:{},rules:{},vo:{metrics:{}}}}(),Custom.di.CustomContext=function(){"use strict";return{system:void 0,setup:function(){Custom.di.CustomContext.prototype.setup.call(this),this.system.mapClass("parser",Custom.dependencies.CustomParser),this.system.mapClass("dashParser",Dash.dependencies.DashParser),this.system.mapClass("mssParser",Mss.dependencies.MssParser),this.system.mapClass("hlsParser",Hls.dependencies.HlsParser),this.system.mapSingleton("contextManager",Custom.modules.ContextManager),this.system.mapClass("fragmentLoader",Custom.dependencies.CustomFragmentLoader),this.system.mapSingleton("metricsModel",Custom.models.CustomMetricsModel),this.system.mapSingleton("metricsExt",Custom.dependencies.CustomMetricsExtensions),this.system.mapSingleton("abrController",Custom.dependencies.CustomAbrController),this.system.mapClass("bufferController",Custom.dependencies.CustomBufferController),this.system.mapHandler("setContext","contextManager","setContext")}}},Custom.di.CustomContext.prototype=new Dash.di.DashContext,Custom.di.CustomContext.prototype.constructor=Custom.di.CustomContext,Custom.dependencies.CustomAbrController=function(){"use strict";var a=Custom.utils.copyMethods(MediaPlayer.dependencies.AbrController);return a.metricsExt=void 0,a.debug=void 0,a.getPlaybackQuality=function(a,b){var c=this,d=Q.defer();return c.parent.getMetricsFor.call(c,b).then(function(e){c.parent.getPlaybackQuality.call(c,a,b).then(function(b){var f=c.metricsExt.getCurrentRepresentationBoundaries(e),g=b.quality;null!==f&&(g<f.min&&(g=f.min,c.parent.setPlaybackQuality.call(c,a,g)),g>f.max&&(g=f.max,c.parent.setPlaybackQuality.call(c,a,g))),d.resolve({quality:g,confidence:b.confidence})})}),d.promise},a},Custom.dependencies.CustomAbrController.prototype={constructor:Custom.dependencies.CustomAbrController},Custom.dependencies.CustomBufferController=function(){"use strict";var a=Custom.utils.copyMethods(MediaPlayer.dependencies.BufferController);a.fragmentController=void 0,a.sourceBufferExt=void 0;var b;return a.initialize=function(a,c,d,e,f,g,h,i){b=i,this.parent.initialize.apply(this,arguments)},a.emptyBuffer=function(c){var d,e=Q.defer(),f=0,g=a.parent,h=g.getBuffer(),i=a.fragmentController.attachBufferController(a);if(h.buffered.length>0){var j=h.buffered.end(h.buffered.length-1);d=j}else d=c+5;return a.sourceBufferExt.remove(h,f,c-1,g.getPeriodInfo().duration,b).then(function(){a.sourceBufferExt.remove(h,c+3,d,g.getPeriodInfo().duration,b).then(function(){a.fragmentController.removeExecutedRequestsBeforeTime(i,d),e.resolve(),a.sourceBufferExt.getAllRanges(h).then(function(a){if(a&&a.length>0){var b,c;for(b=0,c=a.length;c>b;b+=1);}})})}),e.promise},a},Custom.dependencies.CustomBufferController.prototype={constructor:Custom.dependencies.CustomBufferController},Custom.dependencies.CustomFragmentLoader=function(){"use strict";var a=Custom.utils.copyMethods(MediaPlayer.dependencies.FragmentLoader);return a.load=function(a){var b=Q.defer();return"Initialization Segment"==a.type&&a.data?b.resolve(a,{data:a.data}):b.promise=this.parent.load.call(this,a),b.promise},a},Custom.dependencies.CustomFragmentLoader.prototype={constructor:Custom.dependencies.CustomFragmentLoader},Custom.dependencies.CustomMetricsExtensions=function(){"use strict";var a={42:"Baseline","4D":"Main",58:"Extended",64:"High"},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){var c=!1;return"video"===b?(this.manifestExt.getIsVideo(a),"video"===a.type&&(c=!0)):"audio"===b?(this.manifestExt.getIsAudio(a),"audio"===a.type&&(c=!0)):c=!1,c},d=Custom.utils.copyMethods(Dash.dependencies.DashMetricsExtensions);return d.getVideoWidthForRepresentation=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.width},d.getVideoHeightForRepresentation=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.height},d.getCodecsForRepresentation=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.codecs},d.getH264ProfileLevel=function(b){if(b.indexOf("avc1")<0)return"";var c=a[b.substr(5,2)],d=parseInt(b.substr(9,2),16)/10;return c+"@"+d.toString()},d.getBitratesForType=function(a){var b,d,e,f,g,h,i,j,k=this,l=k.manifestModel.getValue(),m=l.Period_asArray,n=new Array;for(d=0;d<m.length;d+=1)for(b=m[d],f=b.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],c.call(k,e,a)){for(h=e.Representation_asArray,j=0;j<h.length;j+=1)g=h[j],n.push(g.bandwidth);return n}return n},d.getCurrentRepresentationBoundaries=function(a){if(null===a)return null;var b=a.RepBoundariesList;return null===b||b.length<=0?null:b[b.length-1]},d.getCurrentDownloadSwitch=function(a){if(null===a)return null;var b=a.DwnldSwitchList;return null===b||b.length<=0?null:b[b.length-1]},d},Custom.dependencies.CustomMetricsExtensions.prototype={constructor:Custom.dependencies.CustomMetricsExtensions},Custom.dependencies.CustomParser=function(){"use strict";var a=function(a,b){var c=null;if(a.indexOf("SmoothStreamingMedia")>-1)this.system.notify("setContext","MSS"),c=this.mssParser;else if(a.indexOf("#EXTM3U")>-1)this.system.notify("setContext","HLS"),c=this.hlsParser;else{if(!(a.indexOf("MPD")>-1))return Q.when(null);this.system.notify("setContext","MPD"),c=this.dashParser}return c.parse(a,b)};return{debug:void 0,system:void 0,dashParser:void 0,mssParser:void 0,hlsParser:void 0,metricsModel:void 0,parse:a}},Custom.dependencies.CustomParser.prototype={constructor:Custom.dependencies.CustomParser},Custom.models.CustomMetricsModel=function(){"use strict";var a=Custom.utils.copyMethods(MediaPlayer.models.MetricsModel);return a.addRepresentationBoundaries=function(a,b,c,d){var e=new MediaPlayer.vo.metrics.RepresentationBoundaries;return e.t=b,e.min=c,e.max=d,this.parent.getMetricsFor(a).RepBoundariesList.push(e),e},a.addDownloadSwitch=function(a,b,c,d){var e=new Custom.vo.metrics.DownloadSwitch;return e.type=a,e.mediaStartTime=b,e.downloadStartTime=c,e.quality=d,this.parent.getMetricsFor(a).DwnldSwitchList=[e],e},a},Custom.models.CustomMetricsModel.prototype={constructor:Custom.models.CustomMetricsModel},Custom.modules.ContextManager=function(){"use strict";return{system:void 0,debug:void 0,setContext:function(a){"MSS"===a?(this.system.mapClass("mp4Processor",MediaPlayer.dependencies.Mp4Processor),this.system.mapClass("indexHandler",Mss.dependencies.MssHandler),this.system.mapClass("fragmentController",Mss.dependencies.MssFragmentController)):(this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler))}}},Custom.modules.ContextManager.prototype={constructor:Custom.modules.ContextManager},Custom.rules.CustomDownloadRatioRule=function(){"use strict";var a=function(a,b,c){var d=this,e=Q.defer();return d.manifestExt.getRepresentationFor(a,c).then(function(a){d.manifestExt.getBandwidth(a).then(function(a){e.resolve(a/b)})}),e.promise};return{debug:void 0,manifestExt:void 0,metricsExt:void 0,checkIndex:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=this,p=c.HttpList,q=this.metricsExt.getMinBitrateIdx(),r=this.metricsExt.getMaxBitrateIdx(),s=.75;return c?null===p||void 0===p||0===p.length?Q.when(new MediaPlayer.rules.SwitchRequest):(e=p[p.length-1],g=(e.tfinish.getTime()-e.trequest.getTime())/1e3,f=(e.tfinish.getTime()-e.tresponse.getTime())/1e3,0>=g?Q.when(new MediaPlayer.rules.SwitchRequest):null===e.mediaduration||void 0===e.mediaduration||e.mediaduration<=0?Q.when(new MediaPlayer.rules.SwitchRequest):(q=q?q:0,k=Q.defer(),i=e.mediaduration/g,h=e.mediaduration/f*s,isNaN(h)||isNaN(i)?Q.when(new MediaPlayer.rules.SwitchRequest):(o.manifestExt.getRepresentationCount(d).then(function(c){c-=1,q=q?q:0,r=r&&c>r?r:c,isNaN(h)?k.resolve(new MediaPlayer.rules.SwitchRequest):1>h||b>r?b>q?o.manifestExt.getRepresentationFor(b-1,d).then(function(a){o.manifestExt.getBandwidth(a).then(function(a){o.manifestExt.getRepresentationFor(b,d).then(function(c){o.manifestExt.getBandwidth(c).then(function(c){j=a/c,k.resolve(j>h?new MediaPlayer.rules.SwitchRequest(0):new MediaPlayer.rules.SwitchRequest(b-1))})})})}):k.resolve(new MediaPlayer.rules.SwitchRequest(b)):r>b?o.manifestExt.getRepresentationFor(b+1,d).then(function(e){o.manifestExt.getBandwidth(e).then(function(e){o.manifestExt.getRepresentationFor(b,d).then(function(f){o.manifestExt.getBandwidth(f).then(function(f){if(j=e/f,h>=j)if(h>1e3)k.resolve(new MediaPlayer.rules.SwitchRequest(c-1));else if(h>100)k.resolve(new MediaPlayer.rules.SwitchRequest(b+1));else{for(m=-1,l=[];(m+=1)<c;)l.push(a.call(o,m,f,d));Q.all(l).then(function(a){for(m=0,n=a.length;n>m&&!(h<a[m]);m+=1);k.resolve(new MediaPlayer.rules.SwitchRequest(m))})}else k.resolve(new MediaPlayer.rules.SwitchRequest)})})})}):k.resolve(new MediaPlayer.rules.SwitchRequest(c))}),k.promise))):Q.when(new MediaPlayer.rules.SwitchRequest)}}},Custom.rules.CustomDownloadRatioRule.prototype={constructor:Custom.rules.CustomDownloadRatioRule},Custom.utils.copyMethods=function(a){var b=new a;b.parent={};for(var c in b)b.parent[c]=b[c];return b.setup=function(){for(var a in this.parent)void 0===this.parent[a]&&(this.parent[a]=this[a])},b},Custom.utils.ObjectIron=function(a){var b;b=[];for(var c=0,d=a.length;d>c;c+=1)b.push(a[c].isRoot?"root":a[c].name);var e=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},f=function(a,b,c){var d,f,g,h,i;if(null!==a&&0!==a.length)for(d=0,f=a.length;f>d;d+=1)g=a[d],b.hasOwnProperty(g.name)&&(c.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=c[g.name],"object"==typeof h&&"object"==typeof i?e(h,i):c[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):c[g.name]=b[g.name])},g=function(a,b){var c,d,e,h,i,j,k,l=a;if(a.transformFunc&&(b=a.transformFunc(b)),null===l.children||0===l.children.length)return b;for(c=0,d=l.children.length;d>c;c+=1){j=l.children[c];var m=null;if(b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],e=0,h=i.length;h>e;e+=1)k=i[e],f(l.properties,b,k),m=g(j,k),b[j.name+"_asArray"][e]=m,b[j.name][e]=m;else k=b[j.name],f(l.properties,b,k),m=g(j,k),b[j.name]=m,b[j.name+"_asArray"]=[m]}return b},h=function(c){var d,e,f,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,e=b.length;e>d;d+=1)"root"===b[d]&&(j=a[d],k=c,c=g(j,k));for(i in c)if(c.hasOwnProperty(i)){if(f=b.indexOf(i),-1!==f)if(j=a[f],j.isArray)for(l=c[i+"_asArray"],d=0,e=l.length;e>d;d+=1)k=l[d],c[i][d]=g(j,k),c[i+"_asArray"][d]=g(j,k);else k=c[i],c[i]=g(j,k),c[i+"_asArray"]=[g(j,k)];c[i]=h(c[i])}return c};return{run:h}},Custom.utils.getXMLHttpRequest=function(){var a=null;if(!window.XMLHttpRequest&&!window.ActiveXObject)return alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest..."),null;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}return a},Custom.utils.doRequestWithPromise=function(a,b,c){var d=Q.defer(),e=Custom.utils.getXMLHttpRequest();return e.onreadystatechange=function(){4!=e.readyState||200!=e.status&&0!=e.status||b(d,e.response,c)},e.open("GET",a,!0),e.send(null),d.promise},Custom.vo.metrics.DownloadSwitch=function(){"use strict";this.type=null,this.mediaStartTime=null,this.downloadStartTime=null,this.quality=null},Custom.vo.metrics.DownloadSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch},Dash.dependencies.BaseURLExtensions=function(){"use strict";
var a=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m=new DataView(a),n={},o=0;"sidx"!==j&&o<m.byteLength;){for(k=m.getUint32(o),o+=4,j="",f=0;4>f;f+=1)l=m.getInt8(o),j+=String.fromCharCode(l),o+=1;"moof"!==j&&"traf"!==j&&"sidx"!==j?o+=k-8:"sidx"===j&&(o-=8)}if(e=m.getUint32(o,!1)+o,e>a.byteLength)throw"sidx terminates after array buffer";for(n.version=m.getUint8(o+8),o+=12,n.timescale=m.getUint32(o+4,!1),o+=8,0===n.version?(n.earliest_presentation_time=m.getUint32(o,!1),n.first_offset=m.getUint32(o+4,!1),o+=8):(n.earliest_presentation_time=utils.Math.to64BitNumber(m.getUint32(o+4,!1),m.getUint32(o,!1)),n.first_offset=(m.getUint32(o+8,!1)<<32)+m.getUint32(o+12,!1),o+=16),n.first_offset+=e+(b||0),n.reference_count=m.getUint16(o+2,!1),o+=4,n.references=[],c=n.first_offset,d=n.earliest_presentation_time,f=0;f<n.reference_count;f+=1)h=m.getUint32(o,!1),g=h>>>31,h=2147483647&h,i=m.getUint32(o+4,!1),o+=12,n.references.push({size:h,type:g,offset:c,duration:i,time:d,timescale:n.timescale}),c+=h,d+=i;if(o!==e)throw"Error: final pos "+o+" differs from SIDX end "+e;return n},b=function(b,c,d){var e,f,g,h,i,j,k,l;for(e=a.call(this,b,d),f=e.references,g=[],i=0,j=f.length;j>i;i+=1)h=new Dash.vo.Segment,h.duration=f[i].duration,h.media=c,h.startTime=f[i].time,h.timescale=f[i].timescale,k=f[i].offset,l=f[i].offset+f[i].size-1,h.mediaRange=k+"-"+l,g.push(h);return Q.when(g)},c=function(a,b){for(var d,e,f,g,h,i,j,k=Q.defer(),l=new DataView(a),m=0,n="",o=0,p=!1,q=this;"moov"!==n&&m<l.byteLength;){for(o=l.getUint32(m),m+=4,n="",g=0;4>g;g+=1)h=l.getInt8(m),n+=String.fromCharCode(h),m+=1;"moov"!==n&&(m+=o-8)}return f=l.byteLength-m,"moov"!==n?(b.range.start=0,b.range.end=b.bytesLoaded+b.bytesToLoad,i=new XMLHttpRequest,i.onloadend=function(){p||k.reject("Error loading initialization.")},i.onload=function(){p=!0,b.bytesLoaded=b.range.end,c.call(q,i.response).then(function(a){k.resolve(a)})},i.onerror=function(){k.reject("Error loading initialization.")},i.open("GET",b.url),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),i.send(null)):(d=m-8,e=d+o-1,j=d+"-"+e,k.resolve(j)),k.promise},d=function(a){var b=Q.defer(),d=new XMLHttpRequest,e=!0,f=this,g={url:a,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:d};return g.range.start=0,g.range.end=g.bytesToLoad,d.onload=function(){d.status<200||d.status>299||(e=!1,g.bytesLoaded=g.range.end,c.call(f,d.response,g).then(function(a){b.resolve(a)}))},d.onloadend=d.onerror=function(){e&&(e=!1,f.errHandler.downloadError("initialization",g.url,d),b.reject(d))},d.open("GET",g.url),d.responseType="arraybuffer",d.setRequestHeader("Range","bytes="+g.range.start+"-"+g.range.end),d.send(null),b.promise},e=function(a,c){for(var d,f,g,h,i,j,k,l,m=Q.defer(),n=new DataView(a),o=new XMLHttpRequest,p=0,q="",r=0,s=!0,t=!1,u=this;"sidx"!==q&&p<n.byteLength;){for(r=n.getUint32(p),p+=4,q="",i=0;4>i;i+=1)j=n.getInt8(p),q+=String.fromCharCode(j),p+=1;"sidx"!==q&&(p+=r-8)}if(d=n.byteLength-p,"sidx"!==q)m.reject();else if(r-8>d)c.range.start=0,c.range.end=c.bytesLoaded+(r-d),o.onload=function(){o.status<200||o.status>299||(s=!1,c.bytesLoaded=c.range.end,e.call(u,o.response,c).then(function(a){m.resolve(a)}))},o.onloadend=o.onerror=function(){s&&(s=!1,u.errHandler.downloadError("SIDX",c.url,o),m.reject(o))},o.open("GET",c.url),o.responseType="arraybuffer",o.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end),o.send(null);else if(c.range.start=p-8,c.range.end=c.range.start+r,f=new ArrayBuffer(c.range.end-c.range.start),h=new Uint8Array(f),g=new Uint8Array(a,c.range.start,c.range.end-c.range.start),h.set(g),k=this.parseSIDX.call(this,f,c.range.start),l=k.references,null!==l&&void 0!==l&&l.length>0&&(t=1===l[0].type),t){var v,w,x,y,z,A,B=[];for(v=0,w=l.length;w>v;v+=1)x=l[v].offset,y=l[v].offset+l[v].size-1,z=x+"-"+y,B.push(this.loadSegments.call(u,c.url,z));Q.all(B).then(function(a){for(A=[],v=0,w=a.length;w>v;v+=1)A=A.concat(a[v]);m.resolve(A)},function(a){m.reject(a)})}else b.call(u,f,c.url,c.range.start).then(function(a){m.resolve(a)});return m.promise},f=function(a,c){var d,f=Q.defer(),g=new XMLHttpRequest,h=!0,i=this,j={url:a,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:g};return null===c?(j.searching=!0,j.range.start=0,j.range.end=j.bytesToLoad):(d=c.split("-"),j.range.start=parseFloat(d[0]),j.range.end=parseFloat(d[1])),g.onload=function(){g.status<200||g.status>299||(h=!1,j.searching?(j.bytesLoaded=j.range.end,e.call(i,g.response,j).then(function(a){f.resolve(a)})):b.call(i,g.response,j.url,j.range.start).then(function(a){f.resolve(a)}))},g.onloadend=g.onerror=function(){h&&(h=!1,i.errHandler.downloadError("SIDX",j.url,g),f.reject(g))},g.open("GET",j.url),g.responseType="arraybuffer",g.setRequestHeader("Range","bytes="+j.range.start+"-"+j.range.end),g.send(null),f.promise};return{debug:void 0,errHandler:void 0,loadSegments:f,loadInitialization:d,parseSegments:b,parseSIDX:a,findSIDX:e}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c=-1,d=function(a,b){var c=b.toString();return a.split("$Number$").join(c)},e=function(a,b){var c=b.toString();return a.split("$Time$").join(c)},f=function(a,b){var c=b.toString();return a.split("$Bandwidth$").join(c)},g=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},h=function(a,b){return a.representation.startNumber+b},i=function(a,b){var c,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return c=a===d?a:-1!==a.indexOf("http://")?a:d+a},j=function(b,c){var d,e,f=new MediaPlayer.vo.SegmentRequest;return d=b.adaptation.period,f.streamType=c,f.type="Initialization Segment",f.url=i(b.initialization,b),f.range=b.range,e=d.start,f.availabilityStartTime=this.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,b.adaptation.period.mpd,a),f.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,a),f.quality=b.index,f},k=function(a){var c=Q.defer(),d=null,e=null,f=this;return a?(a.initialization?(d=j.call(f,a,b),c.resolve(d)):(e=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,f.baseURLExt.loadInitialization(e).then(function(g){a.range=g,a.initialization=e,d=j.call(f,a,b),c.resolve(d)},function(a){c.reject(a)})),c.promise):Q.reject("no represenation")},l=function(b){var d,e,f,g=b.adaptation.period,h=!1;return a?h=!1:0>c?h=!1:c<b.segments.length?(e=b.segments[c],f=e.presentationStartTime-g.start,d=b.adaptation.period.duration,h=f>=d):h=!0,Q.when(h)},m=function(b,c){var d,e,f,g;return e=b.segmentDuration,f=b.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=b,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=this.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,b),d.availabilityStartTime=this.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,b.adaptation.period.mpd,a),d.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,b.adaptation.period.mpd,a),d.wallStartTime=this.timelineConverter.calcWallTimeForSegment(d,a),d.replacementNumber=h(d,c),d},n=function(a){var b,c,d,e,f,g,h,i,j,k,l=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,m=l.SegmentTimeline,n=[],o=0,q=0;for(k=a.timescale,b=m.S_asArray,d=0,e=b.length;e>d;d+=1)for(c=b[d],g=0,c.hasOwnProperty("r")&&(g=c.r),c.hasOwnProperty("t")&&(o=c.t),0>g&&(i=b[d+1],h=i&&i.hasOwnProperty("t")?i.t/k:a.adaptation.period.duration,g=(h-o/k)/(c.d/k)-1),f=0;g>=f;f+=1)j=p.call(this,a,o,c.d,k,l.media,c.mediaRange,q),n.push(j),j=null,o+=c.d,q+=1;return Q.when(n)},o=function(b){var c,f,g,h,i,j=[],k=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,l=0,n=b.adaptation.period.duration/b.segmentDuration,o=null,p=null;for(i=b.startNumber,h=b.segmentAvailabilityRange||this.timelineConverter.calcSegmentAvailabilityRange(b,a),h&&(f=b.adaptation.period.start,g=b.segmentDuration,l=Math.floor((h.start-f)/g),n=Math.round((h.end-f)/g)),c=l;n>c;c+=1)o=m.call(this,b,c),o.replacementTime=(i+c-1)*b.segmentDuration,p=k.media,p=d(p,o.replacementNumber),p=e(p,o.replacementTime),o.media=p,j.push(o),o=null;return Q.when(j)},p=function(b,c,f,g,i,j,k){var l,m,n,o=c/g,p=Math.min(f/g,b.adaptation.period.mpd.maxSegmentDuration);return l=o,m=l+p,n=new Dash.vo.Segment,n.representation=b,n.duration=p,n.mediaStartTime=o,n.presentationStartTime=l,n.availabilityStartTime=b.adaptation.period.mpd.manifest.mpdLoadedTime,n.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(m,b.adaptation.period.mpd,a),n.wallStartTime=this.timelineConverter.calcWallTimeForSegment(n,a),n.replacementTime=c,n.replacementNumber=h(n,k),i=d(i,n.replacementNumber),i=e(i,n.replacementTime),n.media=i,n.mediaRange=j,n},q=function(a){var b,c,d,e,f,g=[],h=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList;for(f=a.startNumber,b=0,c=h.SegmentURL_asArray.length;c>b;b+=1)e=h.SegmentURL_asArray[b],d=m.call(this,a,b),d.replacementTime=(f+b-1)*a.segmentDuration,d.media=e.media,d.mediaRange=e.mediaRange,d.index=e.index,d.indexRange=e.indexRange,g.push(d),d=null;return Q.when(g)},r=function(a){var b,c,d,e,f=this,g=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,h=Q.defer(),i=[],j=0,k=null;return a.indexRange&&(k=a.indexRange),this.baseURLExt.loadSegments(g,k).then(function(g){for(c=0,d=g.length;d>c;c+=1)b=g[c],e=p.call(f,a,b.startTime,b.duration,b.timescale,b.media,b.mediaRange,j),i.push(e),e=null,j+=1;h.resolve(i)}),h.promise},s=function(b){var c,d,e=Q.defer();return b.segments?Q.when(b.segments):(c="SegmentTimeline"===b.segmentInfoType?n.call(this,b):"SegmentTemplate"===b.segmentInfoType?o.call(this,b):"SegmentList"===b.segmentInfoType?q.call(this,b):r.call(this,b),Q.when(c).then(function(c){b.segments=c,d=c.length-1,a&&isNaN(b.adaptation.period.liveEdge)&&(b.adaptation.period.liveEdge=c[d].presentationStartTime),b.segmentAvailabilityRange={start:c[0].presentationStartTime,end:c[d].presentationStartTime},e.resolve(c)}),e.promise)},t=function(a,b){var c,d,e,f,g=b.length-1,h=-1;if(b&&b.length>0)for(f=g;f>=0;f--){if(c=b[f],d=c.presentationStartTime,e=c.duration,a+Dash.dependencies.DashHandler.EPSILON>=d&&a-Dash.dependencies.DashHandler.EPSILON<=d+e){h=f;break}-1===h&&a-Dash.dependencies.DashHandler.EPSILON>d+e&&(h=f+1)}return h>g&&(h=g),Q.when(h)},u=function(a){if(null===a||void 0===a)return Q.when(null);var h,j=new MediaPlayer.vo.SegmentRequest,k=a.representation,l=k.adaptation.period.mpd.manifest.Period_asArray[k.adaptation.period.index].AdaptationSet_asArray[k.adaptation.index].Representation_asArray[k.index].bandwidth;return h=i(a.media,k),h=d(h,a.replacementNumber),h=e(h,a.replacementTime),h=f(h,l),h=g(h,k.id),j.streamType=b,j.type="Media Segment",j.url=h,j.range=a.mediaRange,j.startTime=a.presentationStartTime,j.duration=a.duration,j.timescale=k.timescale,j.availabilityStartTime=a.availabilityStartTime,j.availabilityEndTime=a.availabilityEndTime,j.wallStartTime=a.wallStartTime,j.quality=k.index,j.index=c,Q.when(j)},v=function(a,b){var d,e,f,g=this;return a?(d=Q.defer(),s.call(g,a).then(function(a){var c;return c=t.call(g,b,a)}).then(function(b){return c=b,l.call(g,a)}).then(function(b){var h=null;return b?(e=new MediaPlayer.vo.SegmentRequest,e.action=e.ACTION_COMPLETE,e.index=c,d.resolve(e)):a.segments?(f=a.segments[c],h=u.call(g,f)):Q.when(null),h}).then(function(a){d.resolve(a)}),d.promise):Q.reject("no represenation")},w=function(a){var b,d,e,f=this;if(!a)return Q.reject("no represenation");if(-1===c)throw"You must call getSegmentRequestForTime first.";return c+=1,b=Q.defer(),l.call(f,a).then(function(g){g?(d=new MediaPlayer.vo.SegmentRequest,d.action=d.ACTION_COMPLETE,d.index=c,b.resolve(d)):s.call(f,a).then(function(b){var d;return e=a.segments[c],d=u.call(f,e)}).then(function(a){b.resolve(a)})}),b.promise},x=function(a,b,c){var d,e=this,f=Math.max(b-c,0),g=Q.defer(),h=0;return a?(s.call(e,a).then(function(a){d=a[0].duration,h=Math.ceil(f/d),g.resolve(h)},function(){g.resolve(0)}),g.promise):Q.reject("no represenation")},y=function(a){var b,d,e=this,f=Q.defer();return a?(d=c,s.call(e,a).then(function(c){0>d?b=e.timelineConverter.calcPresentationStartTime(a.adaptation.period):(d=Math.min(c.length-1,d),b=c[d].presentationStartTime),f.resolve(b)},function(){f.reject()}),f.promise):Q.reject("no represenation")};return{debug:void 0,baseURLExt:void 0,manifestModel:void 0,manifestExt:void 0,errHandler:void 0,timelineConverter:void 0,getType:function(){return b},setType:function(a){b=a},getIsDynamic:function(){return a},setIsDynamic:function(b){a=b},getInitRequest:k,getSegmentRequestForTime:v,getNextSegmentRequest:w,getCurrentTime:y,getSegmentCountForDuration:x}},Dash.dependencies.DashHandler.EPSILON=.003,Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsAudio:function(a){"use strict";var b,c,d,e=a.ContentComponent_asArray,f=!1,g=!1;if(e)for(b=0,c=e.length;c>b;b+=1)"audio"===e[b].contentType&&(f=!0,g=!0);if(a.hasOwnProperty("mimeType")&&(f=-1!==a.mimeType.indexOf("audio"),g=!0),!g)for(b=0,c=a.Representation_asArray.length;!g&&c>b;)d=a.Representation_asArray[b],d.hasOwnProperty("mimeType")&&(f=-1!==d.mimeType.indexOf("audio"),g=!0),b+=1;return f&&(a.type="audio"),Q.when(f)},getIsVideo:function(a){"use strict";var b,c,d,e=a.ContentComponent_asArray,f=!1,g=!1;if(e)for(b=0,c=e.length;c>b;b+=1)"video"===e[b].contentType&&(f=!0,g=!0);if(a.hasOwnProperty("mimeType")&&(f=-1!==a.mimeType.indexOf("video"),g=!0),!g)for(b=0,c=a.Representation_asArray.length;!g&&c>b;)d=a.Representation_asArray[b],d.hasOwnProperty("mimeType")&&(f=-1!==d.mimeType.indexOf("video"),g=!0),b+=1;return f&&(a.type="video"),Q.when(f)},getIsText:function(a){"use strict";var b,c,d,e=a.ContentComponent_asArray,f=!1,g=!1;if(e)for(b=0,c=e.length;c>b;b+=1)"text"===e[b].contentType&&(f=!0,g=!0);if(a.hasOwnProperty("mimeType")&&(f=-1!==a.mimeType.indexOf("text"),g=!0),!g)for(b=0,c=a.Representation_asArray.length;!g&&c>b;)d=a.Representation_asArray[b],d.hasOwnProperty("mimeType")&&(f=-1!==d.mimeType.indexOf("text"),g=!0),b+=1;return Q.when(f)},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a},getIsMain:function(){"use strict";return Q.when(!1)},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getDataForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return Q.when(f[d]);return Q.when(null)},getDataForIndex:function(a,b,c){"use strict";var d=b.Period_asArray[c].AdaptationSet_asArray;return Q.when(d[a])},getDataIndex:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;if(a.id){for(d=0,e=f.length;e>d;d+=1)if(f[d].id&&f[d].id===a.id)return Q.when(d)}else{var g,h=JSON.stringify(a);for(d=0,e=f.length;e>d;d+=1)if(g=JSON.stringify(f[d]),g===h)return Q.when(d)}return Q.when(-1)},getVideoData:function(a,b){"use strict";var c,d,e=this,f=a.Period_asArray[b].AdaptationSet_asArray,g=Q.defer(),h=[];for(c=0,d=f.length;d>c;c+=1)h.push(this.getIsVideo(f[c]));return Q.all(h).then(function(a){var b=!1;for(c=0,d=a.length;d>c;c+=1)a[c]===!0&&(b=!0,g.resolve(e.processAdaptation(f[c])));b||g.resolve(null)}),g.promise},getTextData:function(a,b){"use strict";var c,d,e=this,f=a.Period_asArray[b].AdaptationSet_asArray,g=Q.defer(),h=[];for(c=0,d=f.length;d>c;c+=1)h.push(this.getIsText(f[c]));return Q.all(h).then(function(a){var b=!1;for(c=0,d=a.length;d>c;c+=1)a[c]===!0&&(b=!0,g.resolve(e.processAdaptation(f[c])));b||g.resolve(null)}),g.promise},getAudioDatas:function(a,b){"use strict";var c,d,e=this,f=a.Period_asArray[b].AdaptationSet_asArray,g=Q.defer(),h=[];for(c=0,d=f.length;d>c;c+=1)h.push(this.getIsAudio(f[c]));return Q.all(h).then(function(a){var b=[];for(c=0,d=a.length;d>c;c+=1)a[c]===!0&&b.push(e.processAdaptation(f[c]));g.resolve(b)}),g.promise},getPrimaryAudioData:function(a,b){"use strict";var c,d,e=Q.defer(),f=[],g=this;return this.getAudioDatas(a,b).then(function(a){for(a&&0!==a.length||e.resolve(null),c=0,d=a.length;d>c;c+=1)f.push(g.getIsMain(a[c]));Q.all(f).then(function(b){var f=!1;for(c=0,d=b.length;d>c;c+=1)b[c]===!0&&(f=!0,e.resolve(g.processAdaptation(a[c])));f||e.resolve(a[0])})}),e.promise},getCodec:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return Q.when(c)},getMimeType:function(a){"use strict";return Q.when(a.Representation_asArray[0].mimeType)},getKID:function(a){"use strict";return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return Q.when(a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null)},getIsDynamic:function(a){"use strict";var b=!1,c="dynamic";return a.hasOwnProperty("type")&&(b=a.type===c),b},getIsDVR:function(a){"use strict";var b,c,d=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c=d&&b,Q.when(c)},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),Q.when(b)},getDuration:function(a){var b;return b=a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.POSITIVE_INFINITY,Q.when(b)},getBandwidth:function(a){"use strict";return Q.when(a.bandwidth)},getRefreshDelay:function(a){"use strict";var b=0/0;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=parseFloat(a.minimumUpdatePeriod)),Q.when(b)},getRepresentationCount:function(a){"use strict";return Q.when(a.Representation_asArray.length)},getRepresentationFor:function(a,b){"use strict";return Q.when(b.Representation_asArray[a])},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g=a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index],h=this,i=[],j=Q.defer(),k=0;k<g.Representation_asArray.length;k+=1)f=g.Representation_asArray[k],c=new Dash.vo.Representation,c.index=k,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList"):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,c.segmentInfoType=e.hasOwnProperty("SegmentTimeline")?"SegmentTimeline":"SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&h.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=h.timelineConverter.calcMSETimeOffset(c),i.push(c);return j.resolve(i),j.promise},getAdaptationsForPeriod:function(a,b){for(var c,d=a.Period_asArray[b.index],e=[],f=0;f<d.AdaptationSet_asArray.length;f+=1)c=new Dash.vo.AdaptationSet,c.index=f,c.period=b,e.push(c);return Q.when(e)},getRegularPeriods:function(a,b){var c,d,e=this,f=Q.defer(),g=[],h=e.getIsDynamic(a),i=null,j=null,k=null,l=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)j=a.Period_asArray[c],j.hasOwnProperty("start")?(l=new Dash.vo.Period,l.start=j.start):null!==i&&j.hasOwnProperty("duration")?(l=new Dash.vo.Period,l.start=k.start+k.duration,l.duration=j.duration):0!==c||h||(l=new Dash.vo.Period,l.start=0),null!==k&&isNaN(k.duration)&&(k.duration=l.start-k.start),null!==l&&j.hasOwnProperty("id")&&(l.id=j.id),null!==l&&(l.index=c,l.mpd=b,g.push(l)),i=j,j=null,k=l,l=null;return e.getCheckTime(a,g[0]).then(function(a){b.checkTime=a,null!==k&&isNaN(k.duration)?e.getEndTimeForLastPeriod(b).then(function(a){k.duration=a-k.start,f.resolve(g)}):f.resolve(g)}),Q.when(f.promise)},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,b.availabilityStartTime=new Date(a.hasOwnProperty("availabilityStartTime")?a.availabilityStartTime.getTime():a.mpdLoadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),Q.when(b)},getFetchTime:function(a,b){var c=this.timelineConverter.calcPresentationTimeFromWallTime(a.mpdLoadedTime,b,!0);return Q.when(c)},getCheckTime:function(a,b){var c=this,d=Q.defer(),e=0/0;return a.hasOwnProperty("minimumUpdatePeriod")?c.getFetchTime(a,b).then(function(b){e=b+a.minimumUpdatePeriod,d.resolve(e)}):d.resolve(e),d.promise},getEndTimeForLastPeriod:function(a){var b;return b=a.manifest.mediaPresentationDuration?a.manifest.mediaPresentationDuration:a.checkTime,Q.when(b)}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return j;return-1},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){var c=!1;return"video"===b?(this.manifestExt.getIsVideo(a),"video"===a.type&&(c=!0)):"audio"===b?(this.manifestExt.getIsAudio(a),"audio"===a.type&&(c=!0)):c=!1,c},d=function(a,b){var d,e,f,g,h,i;for(h=0;h<a.length;h+=1)for(d=a[h],f=d.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],g=e.Representation_asArray,c.call(this,e,b))return g.length;return-1},e=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.bandwidth},f=function(b){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=a.call(d,f,b)},g=function(a){var b,c=this,e=c.manifestModel.getValue(),f=e.Period_asArray;return b=d.call(this,f,a)},h=function(a){if(null===a)return null;var b,c,d,e=a.RepSwitchList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},i=function(a){if(null===a)return null;var b,c,d,e=a.BufferLevel;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},j=function(a){if(null===a)return null;var b,c,d,e=a.HttpList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},k=function(a){if(null===a)return null;var b,c,d,e=a.DroppedFrames;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getCurrentRepresentationSwitch:h,getCurrentBufferLevel:i,getCurrentHttpRequest:j,getCurrentDroppedFrames:k}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f);return parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0)}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o());return c=d.xml_str2json(a),null==c?Q.when(null):(c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),Q.when(c))};return{debug:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.FragmentExtensions=function(){"use strict";var a=function(a){for(var b,c,d,e,f,g,h=Q.defer(),i=new DataView(a),j=0;"tfdt"!==e&&j<i.byteLength;){for(d=i.getUint32(j),j+=4,e="",f=0;4>f;f+=1)g=i.getInt8(j),e+=String.fromCharCode(g),j+=1;"moof"!==e&&"traf"!==e&&"tfdt"!==e&&(j+=d-8)}if(j===i.byteLength)throw"Error finding live offset.";return c=i.getUint8(j),0===c?(j+=4,b=i.getUint32(j,!1)):(j+=d-16,b=utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1))),h.resolve({version:c,base_media_decode_time:b}),h.promise},b=function(a){for(var b,c,d,e,f,g,h,i=new DataView(a),j=0;"sidx"!==f&&j<i.byteLength;){for(g=i.getUint32(j),j+=4,f="",e=0;4>e;e+=1)h=i.getInt8(j),f+=String.fromCharCode(h),j+=1;"moof"!==f&&"traf"!==f&&"sidx"!==f?j+=g-8:"sidx"===f&&(j-=8)}return b=i.getUint8(j+8),j+=12,c=i.getUint32(j+4,!1),j+=8,d=0===b?i.getUint32(j,!1):utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1)),Q.when({earliestPresentationTime:d,timescale:c})},c=function(b){var c,d,e,f=Q.defer(),g=new XMLHttpRequest,h=!1;return c=b,g.onloadend=function(){h||(d="Error loading fragment: "+c,f.reject(d))},g.onload=function(){h=!0,e=a(g.response),f.resolve(e)},g.onerror=function(){d="Error loading fragment: "+c,f.reject(d)},g.responseType="arraybuffer",g.open("GET",c),g.send(null),f.promise};return{debug:void 0,loadFragment:c,parseTFDT:a,parseSIDX:b}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.TimelineConverter=function(){"use strict";var a=function(a,b,c,d){var e=0/0;return e=d?c&&b.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(b.availabilityStartTime.getTime()+1e3*(a+b.timeShiftBufferDepth)):b.availabilityEndTime:c?new Date(b.availabilityStartTime.getTime()+1e3*a):b.availabilityStartTime},b=function(b,c,d){return a.call(this,b,c,d)},c=function(b,c,d){return a.call(this,b,c,d,!0)},d=function(a){var b,c;return c="dynamic"===a.mpd.manifest.type,b=c?a.liveEdge:a.start},e=function(a,c,d){var e=b.call(this,c.start,c.mpd,d);return(a.getTime()-e.getTime())/1e3},f=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return c-d+a},g=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return c+d+a},h=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},i=function(a,b){var c,d,f,g,h,i=null;return b&&(c=a.adaptation.period.mpd.checkTime,d=a.segmentDuration,f=e(new Date,a.adaptation.period,b)-a.adaptation.period.mpd.suggestedPresentationDelay,g=Math.max(f-a.adaptation.period.mpd.timeShiftBufferDepth-d,0),h=isNaN(c)?f:Math.min(c,f),i={start:g,end:h}),i},j=function(a){var b=a.adaptation.period.start,c=a.presentationTimeOffset;return b-c};return{system:void 0,debug:void 0,calcAvailabilityStartTimeFromPresentationTime:b,calcAvailabilityEndTimeFromPresentationTime:c,calcPresentationTimeFromWallTime:e,calcPresentationTimeFromMediaTime:f,calcPresentationStartTime:d,calcMediaTimeFromPresentationTime:g,calcSegmentAvailabilityRange:i,calcWallTimeForSegment:h,calcMSETimeOffset:j}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=0/0},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=0/0,this.start=0/0,this.mpd=null,this.liveEdge=0/0},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=0/0,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=0/0,this.segmentAvailabilityRange=null
},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=0/0,this.replacementTime=null,this.replacementNumber=0/0,this.mediaStartTime=0/0,this.presentationStartTime=0/0,this.availabilityStartTime=0/0,this.availabilityEndTime=0/0,this.wallStartTime=0/0,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},Hls=function(){"use strict";return{dependencies:{}}}(),Hls.dependencies.HlsParser=function(){var a="#EXTM3U",b="#EXTINF",c="#EXT-X-VERSION",d="#EXT-X-TARGETDURATION",e="#EXT-X-MEDIA",f="#EXT-X-STREAM-INF",g="#EXT-X-ENDLIST",h="BANDWIDTH",i="PROGRAM-ID",j="AUDIO",k="SUBTITLES",l="RESOLUTION",m="CODECS",n="URI",o="TYPE",p="GROUP-ID",q="NAME",r="DEFAULT",s="AUTOSELECT",t="LANGUAGE",u="YES",v=function(a){a=a.split("\n");for(var b=0;b<a.length;b++)(""===a[b]||" "===a[b])&&(a.splice(b,1),b--);return a},w=function(a,b){var c=a.substring(a.indexOf(b)+b.length+1);return'"'==c.charAt(0)&&(c=c.substring(1,c.length-1)),c},x=function(a){for(var b={},c=a[0].split(","),d=c.length-1;d>=0;d--)c[d].indexOf(i)>-1?b.id=w(c[d],i):c[d].indexOf(h)>-1?b.bandwidth=w(c[d],h):c[d].indexOf(j)>-1?b.audioId=w(c[d],j):c[d].indexOf(k)>-1?b.subtitlesId=w(c[d],k):c[d].indexOf(l)>-1?b.resolution=w(c[d],l):c[d].indexOf(m)>-1&&(b.codecs=w(c[d],m));return b.uri=a[1].trim(),b},y=function(a){for(var b={},c=a.split(","),d=c.length-1;d>=0;d--)c[d].indexOf(o)>-1?b.type=w(c[d],o):c[d].indexOf(p)>-1?b.groupId=w(c[d],p):c[d].indexOf(q)>-1?b.name=w(c[d],q):c[d].indexOf(r)>-1?b.default=w(c[d],r)==u?!0:!1:c[d].indexOf(s)>-1?b.autoSelect=w(c[d],s)==u?!0:!1:c[d].indexOf(t)>-1?b.language=w(c[d],t):c[d].indexOf(n)>-1&&(b.uri=w(c[d],n));return b},z=function(a){for(var b=[],c=[],d=0;d<a.length;d++)a[d].indexOf(f)>-1?(b.push(x([a[d],a[d+1]])),d++):a[d].indexOf(e)>-1&&c.push(y(a[d]));return{streams:b,medias:c}},A=function(e){var f={segments:[]};if(e&&e.length&&e[0].trim()!==a)return f;for(var g=1;g<e.length;g++)e[g].indexOf(b)>-1?(f.segments.push({uri:e[g+1].trim()}),g++):e[g].indexOf(c)>-1?f.version=w(e[g],c):e[g].indexOf(d)>-1&&(f.duration=parseInt(w(e[g],d),10));return f},B=function(a,b,c){for(var d=A(v(b)),e={name:"SegmentList",isRoot:!1,isArray:!1,children:[],duration:d.duration,startNumber:d.startNumber,timescale:1,BaseURL:c.BaseURL},f=0;f<d.segments.length;f++){var g={name:"S",isRoot:!1,isArray:!0,children:[],media:e.BaseURL+d.segments[f].uri};e.children.push(g)}c.children.push(e),a.resolve()},C=function(b,c){var d,e,f,h=Q.defer(),i=[],j=[];if(!b||b.length<=0||b[0].trim()!==a)return h.reject(new Error("Can't parse manifest")),h.promise;d={},d.name="mpd",d.isRoot=!0,d.isArray=!0,d.parent=null,d.children=[],d.BaseURL=c,d.profiles="urn:mpeg:dash:profile:isoff-live:2011",d.types=b[b.length-1]===g?"static":"dynamic",d.mediaPresentationDuration=0,e={},e.name="Period",e.isRoot=!1,e.isArray=!1,e.parent=d,e.duration=0,e.BaseURL=d.BaseURL,d.Period=e,d.Period_asArray=[e],d.children.push(e),f=[],e.children=f,e.AdaptationSet=f,e.AdaptationSet_asArray=f;var k=z(b.slice(1)),l=k.streams,m=k.medias,n={name:"AdaptationSet",isRoot:!1,isArray:!0,children:[],id:"",lang:"",contentType:"video",mimeType:"video/MP2T",maxWidth:"",maxHeight:"",BaseURL:e.BaseURL,Representation:i,Representation_asArray:i};l.sort(function(a,b){return a.bandwidth-b.bandwidth});for(var o,p,q=0,r=0;r<l.length;r++)p=l[r],p.bandwidth>64e3&&(o={name:"Representation",isRoot:!1,isArray:!0,children:[],id:q++,mimeType:"video/MP2T",codecs:"",bandwidth:p.bandwidth,width:p.resolution,height:p.resolution,codecs:p.codecs,BaseURL:n.BaseURL,url:p.uri.indexOf("http")>-1?p.uri:n.BaseURL+p.uri},i.push(o),j.push({url:o.url,parent:o}));if(f.push(n),m)for(var s=m.length-1;s>=0;s--){var t={name:"AdaptationSet",isRoot:!1,isArray:!0,children:[],id:m[s].name,lang:m[s].language,contentType:m[s].type.toLowerCase(),mimeType:"video/MP2T",maxWidth:"",maxHeight:"",groupId:m[s].groupId,"default":m[s].default,autoSelect:m[s].autoSelect,BaseURL:e.BaseURL},u={name:"mediaRepresentation",isRoot:!1,isArray:!0,children:[],id:0,bandwidth:"",width:"",height:"",codecs:"",BaseURL:t.BaseURL,url:m[s].uri.indexOf("http")>-1?m[s].uri:t.BaseURL+m[s].uri};j.push({url:u.url,parent:u}),t.Representation=u,t.Representation_asArray=[u],f.push(t)}for(var v=[],w=0;w<j.length;w++)v.push(function(){Custom.utils.doRequestWithPromise(j[w].url,B,j[w].parent)});return Q.all(v).then(function(){h.resolve(d)}),h.promise},D=function(a,b){return C(v(a),b)};return{debug:void 0,parse:D}},Mss.dependencies.MssParser.prototype={constructor:Mss.dependencies.MssParser},Mss.dependencies.MssFragmentController=function(){"use strict";var a=function(a,b){var c,d,e=b.Period_asArray;for(c=0;c<e.length;c+=1){var f=e[c].AdaptationSet_asArray;for(d=0;d<f.length;d+=1)if(f[d]===a)return d}return-1},b=function(a,b){for(var c=d.manifestModel.getValue(),e=!1,f=b.SegmentTemplate.SegmentTimeline.S,g=a.entry,h=0,i=0,j=null,k=0,l=0,m=0,n=null;m<g.length;)h=g[m].fragment_absolute_time,i=g[m].fragment_duration,j=f[f.length-1],k=void 0===j.r?0:j.r,l=j.t+j.d*k,h>l&&(i===j.d?j.r=k+1:f.push({t:h,d:i}),e=!0),m+=1;if(e)for(j=f[f.length-1],k=void 0===j.r?0:j.r,l=j.t+j.d*k,n=l-1e7*c.timeShiftBufferDepth,j=f[0];j.t<n;)void 0!==j.r&&j.r>0?(j.t+=j.d,j.r-=1):f.splice(0,1),j=f[0];return e},c=function(c,e,f){var g=!1,h=d.manifestModel.getValue(),i=a(f,h)+1,j=new mp4lib.deserialize(c),k=mp4lib.getBoxByType(j,"moof"),l=mp4lib.getBoxByType(j,"mdat"),m=mp4lib.getBoxByType(k,"traf"),n=mp4lib.getBoxByType(m,"trun"),o=mp4lib.getBoxByType(m,"tfhd"),p=mp4lib.getBoxByType(m,"sepiff");if(null!==p){p.boxtype="senc";var q=new mp4lib.boxes.SampleAuxiliaryInformationOffsetsBox;q.version=0,q.flags=0,q.entry_count=1,q.offset=[];var r=new mp4lib.boxes.SampleAuxiliaryInformationSizesBox;r.version=0,r.flags=0,r.sample_count=p.sample_count,r.default_sample_info_size=0,r.sample_info_size=[];for(var s=!1,t=0;t<p.sample_count;t++)r.sample_info_size[t]=8+6*p.entry[t].NumberOfEntries+2,t>1&&r.sample_info_size[t]!=r.sample_info_size[t-1]&&(s=!0);s===!1&&(r.default_sample_info_size=r.sample_info_size[0],r.sample_info_size=[]),m.boxes.push(r),m.boxes.push(q)}o.track_ID=i,mp4lib.removeBoxByType(m,"tfxd");var u=mp4lib.getBoxByType(m,"tfdt");null===u&&(u=new mp4lib.boxes.TrackFragmentBaseMediaDecodeTimeBox,u.version=1,u.baseMediaDecodeTime=Math.floor(e.startTime*e.timescale),m.boxes.push(u));var v=mp4lib.getBoxByType(m,"tfrf");if(null!==v&&(g=b(v,f),mp4lib.removeBoxByType(m,"tfrf")),o.flags&=16777214,o.flags|=131072,n.flags|=1,n.data_offset=0,null!==p){var w=mp4lib.getBoxPositionByType(j,"moof")+8,x=mp4lib.getBoxPositionByType(k,"traf")+8,y=mp4lib.getBoxPositionByType(m,"senc")+8;q.offset[0]=w+x+y+8}var z=new mp4lib.fieldProcessors.LengthCounterBoxFieldsProcessor(j);j._processFields(z);var A=new Uint8Array(z.res);if(n.data_offset=z.res-l.size+8,navigator.userAgent.indexOf("Chrome")>=0&&"dynamic"===h.type){u.baseMediaDecodeTime/=1e3;for(var t=0;t<n.samples_table.length;t++)n.samples_table[t].sample_composition_time_offset>0&&(n.samples_table[t].sample_composition_time_offset/=1e3),n.samples_table[t].sample_duration>0&&(n.samples_table[t].sample_duration/=1e3)}var B=new mp4lib.fieldProcessors.SerializationBoxFieldsProcessor(j,A,0);return j._processFields(B),{bytes:A,segmentsUpdated:g}},d=Custom.utils.copyMethods(MediaPlayer.dependencies.FragmentController);return d.manifestModel=void 0,d.mp4Processor=void 0,d.process=function(a,b,d){var e=null,f=this.manifestModel.getValue();if(null!==a&&void 0!==a&&a.byteLength>0&&(e=new Uint8Array(a)),b&&"Media Segment"===b.type&&d&&d.length>0){var g=f.Period_asArray[d[0].adaptation.period.index].AdaptationSet_asArray[d[0].adaptation.index],h=c(e,b,g);if(e=h.bytes,h.segmentsUpdated===!0)for(var i=0;i<d.length;i++)d[i].segments=null}if(void 0===b&&navigator.userAgent.indexOf("Chrome")>=0&&"dynamic"===f.type){var j=mp4lib.deserialize(e),k=mp4lib.getBoxByType(j,"moov"),l=mp4lib.getBoxByType(k,"mvhd"),m=mp4lib.getBoxByType(k,"trak"),n=mp4lib.getBoxByType(m,"mdia"),o=mp4lib.getBoxByType(n,"mdhd");l.timescale/=1e3,o.timescale/=1e3,e=mp4lib.serialize(j)}return Q.when(e)},d},Mss.dependencies.MssFragmentController.prototype={constructor:Mss.dependencies.MssFragmentController},Mss.dependencies.MssHandler=function(){var a=!1,b=function(a,b){var c=1;return a.AudioChannelConfiguration?c=a.AudioChannelConfiguration.value:b.AudioChannelConfiguration&&(c=b.AudioChannelConfiguration.value),c},c=function(a,b){var c=1;return c=a.audioSamplingRate?a.audioSamplingRate:b.audioSamplingRate},d=function(a){if(a){if(!a.initData){var d=e.manifestModel.getValue(),f=a.adaptation,g=d.Period_asArray[f.period.index].AdaptationSet_asArray[f.index],h=g.Representation_asArray[a.index],i={};i.type=e.getType()||"und",i.trackId=f.index+1,i.timescale=a.timescale,i.duration=a.adaptation.period.duration,i.codecs=h.codecs,i.codecPrivateData=h.codecPrivateData,i.bandwidth=h.bandwidth,void 0!=g.ContentProtection&&(i.contentProtection=g.ContentProtection),i.width=h.width||g.maxWidth,i.height=h.height||g.maxHeight,i.language=g.lang?g.lang:"und",i.channels=b(g,h),i.samplingRate=c(g,h),a.initData=e.mp4Processor.generateInitSegment(i)}return a.initData}return null},e=Custom.utils.copyMethods(Dash.dependencies.DashHandler);return e.mp4Processor=void 0,e.getInitRequest=function(b){var c=null,f=this,g=null,h=Q.defer();c=b.adaptation.period,g=c.start;var i=e.manifestModel.getValue();a=e.manifestExt.getIsDynamic(i);var j=new MediaPlayer.vo.SegmentRequest;return j.streamType=e.getType(),j.type="Initialization Segment",j.url=null,j.data=d(b),j.range=b.range,j.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(g,b.adaptation.period.mpd,a),j.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g+c.duration,c.mpd,a),j.quality=b.index,h.resolve(j),h.promise},e},Mss.dependencies.MssHandler.prototype={constructor:Mss.dependencies.MssHandler},Mss.dependencies.MssParser=function(){"use strict";var a=1e7,b=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,c=/^0[xX][A-Fa-f0-9]+$/,d=[{type:"numeric",test:function(a){return b.test(a)},converter:function(a){return parseFloat(a)}},{type:"hexadecimal",test:function(a){return c.test(a)},converter:function(a){return a.substr(2)}}],e={video:"video/mp4",audio:"audio/mp4",text:"text/mp4"},f=function(){var a,b,c;return c=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=c,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=c,a.children.push(b),a},g=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!1,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},h=function(){var b,c,d,f,g,h,i,j,k,l;return l=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],b={},b.name="mpd",b.isRoot=!0,b.isArray=!0,b.parent=null,b.children=[],b.properties=l,b.transformFunc=function(b){var c=0===b.Duration?1/0:b.Duration;if(this.isTransformed)return b;this.isTransformed=!0;var d={profiles:"urn:mpeg:dash:profile:isoff-live:2011",type:b.IsLive?"dynamic":"static",timeShiftBufferDepth:parseFloat(b.DVRWindowLength)/a,mediaPresentationDuration:parseFloat(c)/a,BaseURL:b.BaseURL,Period:b,Period_asArray:[b],minBufferTime:10};return void 0!==b.Protection&&(d.ContentProtection=b.Protection.ProtectionHeader,d.ContentProtection_asArray=b.Protection_asArray),d},b.isTransformed=!1,f={},f.name="ContentProtection",f.parent=b,f.isRoot=!1,f.isArray=!1,f.children=[],f.transformFunc=function(a){return a.pro={__text:a.__text,__prefix:"mspr"},"{"==a.SystemID[0]&&(a.SystemID=a.SystemID.substring(1,a.SystemID.length-1)),{schemeIdUri:"urn:uuid:"+a.SystemID,value:2,pro:a.pro,pro_asArray:a.pro}},b.children.push(f),c={},c.name="Period",c.isRoot=!1,c.isArray=!1,c.parent=null,c.children=[],c.properties=l,c.transformFunc=function(b){var c=0===b.Duration?1/0:b.Duration;return{duration:parseFloat(c)/a,BaseURL:b.BaseURL,AdaptationSet:b.StreamIndex,AdaptationSet_asArray:b.StreamIndex_asArray}},b.children.push(c),d={},d.name="AdaptationSet",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=l,d.transformFunc=function(a){var b={id:a.Name,lang:a.Language,contentType:a.Type,mimeType:e[a.Type],maxWidth:a.MaxWidth,maxHeight:a.MaxHeight,BaseURL:a.BaseURL,Representation:a.QualityLevel,Representation_asArray:a.QualityLevel_asArray,SegmentTemplate:a,SegmentTemplate_asArray:[a]};"audio"===a.Type&&(b.AudioChannelConfiguration=b,b.Channels=a.QualityLevel&&a.QualityLevel.Channels);for(var c=0;c<b.Representation_asArray.length;c++){var d=b.Representation_asArray[c];d.Id=b.id+"_"+d.Index}return b},c.children.push(d),g={},g.name="Representation",g.isRoot=!1,g.isArray=!0,g.parent=d,g.children=[],g.properties=l,g.transformFunc=function(a){var b="",c="";if("H264"===a.FourCC||"AVC1"===a.FourCC){b="avc1";var d=/00000001[0-9]7/.exec(a.CodecPrivateData);c=d&&d[0]?a.CodecPrivateData.substr(a.CodecPrivateData.indexOf(d[0])+10,6):void 0}else if(a.FourCC.indexOf("AAC")>=0){b="mp4a",c="40";var e=(248&parseInt(a.CodecPrivateData.toString().substr(0,2),16))>>3;c+="."+e}var f=b+"."+c;return{id:a.Id,bandwidth:a.Bitrate,width:a.MaxWidth,height:a.MaxHeight,codecs:f,audioSamplingRate:a.SamplingRate,codecPrivateData:""+a.CodecPrivateData,BaseURL:a.BaseURL}},d.children.push(g),j={},j.name="AudioChannelConfiguration",j.isRoot=!1,j.isArray=!1,j.parent=d,j.children=[],j.properties=l,j.transformFunc=function(a){return{schemeIdUri:"urn:mpeg:dash:23003:3:audio_channel_configuration:2011",value:a.Channels}},d.children.push(j),h={},h.name="SegmentTemplate",h.isRoot=!1,h.isArray=!1,h.parent=d,h.children=[],h.properties=l,h.transformFunc=function(b){var c=b.Url.replace("{bitrate}","$Bandwidth$");return c=c.replace("{start time}","$Time$"),{media:c,timescale:a,SegmentTimeline:b}},d.children.push(h),i={},i.name="SegmentTimeline",i.isRoot=!1,i.isArray=!1,i.parent=h,i.children=[],i.properties=l,i.transformFunc=function(a){if(a.c_asArray.length>1){var b=[],c=a.c_asArray;c[0].t=c[0].t||0,b.push({d:c[0].d,r:0,t:c[0].t});for(var d=1;d<c.length;d++)c[d].t=c[d].t||c[d-1].t+c[d-1].d,c[d].d===c[d-1].d?++b[b.length-1].r:b.push({d:c[d].d,r:0,t:c[d].t});a.c_asArray=b,a.c=b}return{S:a.c,S_asArray:a.c_asArray}},h.children.push(i),k={},k.name="S",k.isRoot=!1,k.isArray=!0,k.parent=i,k.children=[],k.properties=l,k.transformFunc=function(a){return{d:a.d,r:a.r?a.r:0,t:a.t?a.t:0}},i.children.push(k),b},i=function(){var a=[];return a.push(f()),a.push(g()),a.push(h()),a},j=function(b){var c,d,e=b.Period_asArray[0],f=e.AdaptationSet_asArray;if("dynamic"===b.type){var g=new Date;b.availabilityStartTime=new Date(g.getTime()-1e3*b.timeShiftBufferDepth)}for(e.start=0,c=0,d=f.length;d>c;c+=1){if("static"===b.type){var h=f[c].Representation_asArray[0].SegmentTemplate.SegmentTimeline.S_asArray[0],i=parseFloat(h.t)/a;e.start=0===e.start?i:Math.max(e.start,i)}void 0!==b.ContentProtection&&(b.Period.AdaptationSet[c].ContentProtection=b.ContentProtection,b.Period.AdaptationSet[c].ContentProtection_asArray=b.ContentProtection_asArray)}delete b.ContentProtection,delete b.ContentProtection_asArray},k=function(a,b){var c=null,e=new X2JS(d,"",!0),f=new Custom.utils.ObjectIron(i());return a=a.replace(/CodecPrivateData="/g,'CodecPrivateData="0x'),c=e.xml_str2json(a),null===c?(this.debug.error("[MssParser]","Failed to parse manifest!!"),Q.when(null)):(c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray&&c.BaseURL_asArray[0]||c.BaseURL,0!==c.BaseURL.indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,c=f.run(c),j.call(this,c),Q.when(c))};return{debug:void 0,parse:k}},Mss.dependencies.MssParser.prototype={constructor:Mss.dependencies.MssParser},MediaPlayer.dependencies.AbrController=function(){"use strict";var a=!0,b={},c={},d=function(a){var c;return b.hasOwnProperty(a)||(b[a]=0),c=b[a]},e=function(a,c){b[a]=c},f=function(a){var b;return c.hasOwnProperty(a)||(c[a]=0),b=c[a]},g=function(a,b){c[a]=b};return{debug:void 0,abrRulesCollection:void 0,manifestExt:void 0,metricsModel:void 0,getAutoSwitchBitrate:function(){return a},setAutoSwitchBitrate:function(b){a=b},getMetricsFor:function(a){var b=Q.defer(),c=this;return c.manifestExt.getIsVideo(a).then(function(d){d?b.resolve(c.metricsModel.getMetricsFor("video")):c.manifestExt.getIsAudio(a).then(function(a){b.resolve(a?c.metricsModel.getMetricsFor("audio"):c.metricsModel.getMetricsFor("stream"))})}),b.promise},getPlaybackQuality:function(b,c){var h,i,j,k,l,m,n=this,o=Q.defer(),p=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,q=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,r=[];return l=d(b),m=f(b),a?n.getMetricsFor(c).then(function(a){n.abrRulesCollection.getRules().then(function(d){for(h=0,i=d.length;i>h;h+=1)r.push(d[h].checkIndex(l,a,c));Q.all(r).then(function(a){for(k={},k[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,k[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,k[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,h=0,i=a.length;i>h;h+=1)j=a[h],j.quality!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(k[j.priority]=Math.min(k[j.priority],j.quality));k[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(q=MediaPlayer.rules.SwitchRequest.prototype.WEAK,p=k[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),k[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,p=k[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),k[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(q=MediaPlayer.rules.SwitchRequest.prototype.STRONG,p=k[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),p!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==p&&(l=p),q!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==q&&(m=q),n.manifestExt.getRepresentationCount(c).then(function(a){0>l&&(l=0),l>=a&&(l=a-1),m!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&m!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(m=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),e(b,l),g(b,m),o.resolve({quality:l,confidence:m})})})})}):o.resolve({quality:l,confidence:m}),o.promise},setPlaybackQuality:function(a,b){var c=d(a);b!==c&&e(a,b)},getQualityFor:function(a){return d(a)}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d,e,f,g,h=.5,i=22,j="WAITING",k="READY",l="VALIDATING",m="LOADING",n=j,o=!1,p=!1,q=!1,r=!0,s=[],t=!1,u=-1,v=!0,w=!1,x=-1,y=!1,z=!1,A=!1,B=null,C=null,D=Q.defer(),E=null,F=null,G=null,H=0,I=null,J=0,K=!1,L=null,M=0,N=null,O=null,P=null,R=null,S=!1,T=null,U=null,V=null,W=null,X=!0,Y=function(a){n=a,null!==I&&this.fragmentController.onBufferControllerStateChange()},Z=function(a,b){},$=function(){o&&p&&(Y.call(this,k),this.requestScheduler.startScheduling(this,Bb),I=this.fragmentController.attachBufferController(this))},_=function(){var a;this.requestScheduler.isScheduled(this)||(t===!1&&(a=new Date,Z(a,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),V=this.metricsModel.addPlayList(f,a,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),p=!0,q=!0,$.call(this))},ab=function(a){var b;t=!0,u=a,b=new Date,Z(b,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),V=this.metricsModel.addPlayList(f,b,u,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),_.call(this)},bb=function(){n!==j&&(Y.call(this,j),this.requestScheduler.stopScheduling(this),this.fragmentController.cancelPendingRequestsForModel(I),p=!1,q=!1,Z(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},cb=function(a,b){var c=this,d=Q.defer(),e=c.manifestModel.getValue();return c.manifestExt.getDataIndex(a,e,b.index).then(function(a){c.manifestExt.getAdaptationsForPeriod(e,b).then(function(b){c.manifestExt.getRepresentationsForAdaptation(e,b[a]).then(function(a){d.resolve(a)})})}),d.promise},db=function(b){return a[b]},eb=function(){n===m&&(y&&(y=!1,this.videoModel.stallStream(f,y)),Y.call(this,k))},fb=function(a){if(this.fragmentController.isInitializationRequest(a))Y.call(this,k);else{Y.call(this,m);var b=this.fragmentController.getLoadingTime(this),c=function(){(T||U)&&(Y.call(this,k),Ab.call(this))};setTimeout(c.bind(this),b)}},gb=function(a,b){this.fragmentController.isInitializationRequest(a)?mb.call(this,a,b):hb.call(this,a,b)},hb=function(b,c){var d=this;M||isNaN(b.duration)||(M=b.duration),d.fragmentController.process(c.data,b,a).then(function(a){if(null!==a&&null!==C){if(b.quality!==x)return void d.fragmentController.removeExecutedRequest(I,b);C.promise.then(function(){ib.call(d,a,b.quality).then(function(){z||D.promise.then(function(a){a.index-1!==b.index||A||(A=!0,Y.call(d,k),d.system.notify("bufferingCompleted"))})})})}})},ib=function(a,c){var e=this,f=a==L,g=f?E:Q.defer(),h=e.videoModel.getCurrentTime(),k=new Date;return X===!0&&n!==j&&-1!==x&&(X=!1,W=e.metricsModel.appendPlayListTrace(V,b.id,null,k,h,null,1,null)),Q.when(f||!B||B.promise).then(function(){U&&lb.call(e).then(function(){return c!==x?(g.resolve(),void(f&&(E=null,L=null))):void Q.when(F?F.promise:!0).then(function(){e.sourceBufferExt.append(U,a,e.videoModel).then(function(){f&&(E=null,L=null),n===j&&g===B&&_.call(e),K=!1;var a=function(){jb.call(e).then(function(){g.resolve()})};z?(e.fragmentController.removeExecutedRequestsBeforeTime(I,e.videoModel.getCurrentTime()-4),e.sourceBufferExt.remove(U,0,e.videoModel.getCurrentTime()-4,G.duration,d).then(function(){a()})):a(),!U},function(b){b.err.code===i&&(L=a,E=g,K=!0,N=e.videoModel.getCurrentTime(),H=0,bb.call(e))})})})}),B=g,g.promise},jb=function(){if(!T&&!U)return Q.when(!1);var a=this,b=Q.defer(),c=yb.call(a);return a.sourceBufferExt.getBufferLength(U,c).then(function(c){J=c,a.metricsModel.addBufferLevel(f,new Date,J),kb.call(a),xb.call(a),b.resolve()}),b.promise},kb=function(){var a=this.bufferExt.getLeastBufferLevel(),b=2*M,c=J-a;c>b&&!F?(H=0,F=Q.defer()):b>c&&F&&(F.resolve(),F=null)},lb=function(){var a,b,c=this,e=Q.defer(),f=c.videoModel.getCurrentTime(),g=0;return K?(b=c.fragmentController.getExecutedRequestForTime(I,f),a=b&&!isNaN(b.startTime)?b.startTime:Math.floor(f),M=b&&!isNaN(b.duration)?b.duration:1,c.sourceBufferExt.getBufferRange(U,f).then(function(b){null===b&&u===f&&U.buffered.length>0&&(a=U.buffered.end(U.buffered.length-1)),c.sourceBufferExt.remove(U,g,a,G.duration,d).then(function(){c.fragmentController.removeExecutedRequestsBeforeTime(I,a),e.resolve()})}),e.promise):Q.when(!0)},mb=function(a,b){var c=this,d=b.data,e=a.quality;c.fragmentController.process(d).then(function(b){null!==b&&(s[e]=b,e===x&&ib.call(c,b,a.quality).then(function(){C.resolve()}))})},nb=function(){n===m&&Y.call(this,k),this.system.notify("segmentLoadingFailed")},ob=function(){var a=this,c=b.segmentAvailabilityRange,d=43200;return P=c.end,O={start:Math.max(0,P-d),end:P+d},R=Math.floor((c.end-c.start)/2),a.indexHandler.getSegmentRequestForTime(b,P).then(pb.bind(a,P)),e=Q.defer(),e.promise},pb=function(a,c){var d=this;null===c?(b.segments=null,b.segmentAvailabilityRange={start:a-R,end:a+R},d.indexHandler.getSegmentRequestForTime(b,a).then(pb.bind(d,a))):d.fragmentController.isFragmentExists(c).then(function(a){a?rb.call(d,c):qb.call(d,c)})},qb=function(a){var c,d,e=a.startTime;return S?void sb.call(this,!1,e):(d=e-P,c=d>0?P-d:P+Math.abs(d)+R,void(c<O.start&&c>O.end?this.system.notify("segmentLoadingFailed"):(Y.call(this,k),this.indexHandler.getSegmentRequestForTime(b,c).then(pb.bind(this,c)))))},rb=function(a){var b=a.startTime;if(!S){if(0===M)return void e.resolve(b);S=!0,O.end=b+2*R}sb.call(this,!0,b)},sb=function(a,c){var d,f;a?O.start=c:O.end=c,d=Math.floor(O.end-O.start)<=M,d?e.resolve(a?c:c-M):(f=(O.start+O.end)/2,this.indexHandler.getSegmentRequestForTime(b,f).then(pb.bind(this,f)))},tb=function(a){Z(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON),bb.call(this),D.resolve(a)},ub=function(b,c){if(v&&w)return Q.when(null);var d,e=null,g=this.bufferExt.getTopQualityIndex(f),h=[];if(r&&(t||(t=!0,u=0),r=!1),v){for(C=Q.defer(),s=[],w=!0,d=0;g>=d;d+=1)h.push(this.indexHandler.getInitRequest(a[d]));x=c,e=Q.all(h)}else e=Q.when(null),b&&(C=Q.defer(),x=c,s[c]&&ib.call(this,s[c],c).then(function(){C.resolve()}));return e},vb=function(){var a,d=this;if(v&&!t)a=d.indexHandler.getSegmentRequestForTime(b,c);else{var e=Q.defer(),f=d.videoModel.getCurrentTime();a=e.promise,d.sourceBufferExt.getBufferRange(U,f).then(function(a){return Q.when(t?u:d.indexHandler.getCurrentTime(b)).then(function(c){f=c,t=!1,null!==a&&(f=a.end),d.indexHandler.getSegmentRequestForTime(b,f).then(function(a){e.resolve(a)},function(){e.reject()})},function(){e.reject()})},function(){e.reject()})}return a},wb=function(a){var c=this;null!==a?this.fragmentController.isFragmentLoadedOrPending(this,a)?"complete"!==a.action?this.indexHandler.getNextSegmentRequest(b).then(wb.bind(this)):(bb.call(this),Y.call(this,k),a=null):Q.when(F?F.promise:!0).then(function(){c.fragmentController.prepareFragmentForLoading(c,a,fb,gb,nb,tb).then(function(){Y.call(c,k)})}):(Y.call(c,k),a=null)},xb=function(){q&&(J<MediaPlayer.dependencies.BufferExtensions.START_TIME?y||(y=!0,this.videoModel.stallStream(f,y)):(q=!1,y=!1,this.videoModel.stallStream(f,y)))},yb=function(){var a=-1;return a=this.videoModel.getCurrentTime()},zb=function(){var a=this,c=a.videoModel.getPlaybackRate(),d=J/Math.max(c,1),e=Q.defer();return a.bufferExt.getRequiredBufferLength(q,a.requestScheduler.getExecuteInterval(a)/1e3,z,G.duration).then(function(c){a.indexHandler.getSegmentCountForDuration(b,c,d).then(function(a){e.resolve(a)})}),e.promise},Ab=function(){var a=this,b=a.fragmentController.getPendingRequests(a),c=a.fragmentController.getLoadingRequests(a),d=(b?b.length:0)+(c?c.length:0);H-d>0?(H--,vb.call(a).then(wb.bind(a))):(n===l&&Y.call(a,k),eb.call(a))},Bb=function(){{var a,c=this,d=!1,e=new Date,g=c.videoModel.getCurrentTime();yb.call(c)}if(xb.call(c),n===m&&h>J)y||(Z(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON),y=!0,q=!0,c.videoModel.stallStream(f,y));else if(n===k){Y.call(c,l);var i=c.manifestModel.getValue().minBufferTime;c.bufferExt.decideBufferLength(i,G.duration,q).then(function(a){c.setMinBufferTime(a),c.requestScheduler.adjustExecuteInterval()}),c.abrController.getPlaybackQuality(f,T).then(function(h){var i=h.quality;if(void 0!==i&&(a=i),d=i!==x,d===!0){if(c.fragmentController.abortRequestsForModel(I),b=db.call(c,a),null===b||void 0===b)throw"Unexpected error!";U.timestampOffset!==b.MSETimeOffset&&(U.timestampOffset=b.MSETimeOffset),Z(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON),c.metricsModel.addRepresentationSwitch(f,e,g,b.id)}return zb.call(c,i)}).then(function(b){H=b,w||(ub.call(c,d,a).then(function(a){if(null!==a){var b,d,e=a.length;for(w=!1,d=0;e>d;d+=1)b=a[d],c.fragmentController.prepareFragmentForLoading(c,b,fb,gb,nb,tb).then(function(){Y.call(c,k)});v=!1}}),Ab.call(c))})}else n===l&&Y.call(c,k)};return{videoModel:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,bufferExt:void 0,sourceBufferExt:void 0,abrController:void 0,fragmentExt:void 0,indexHandler:void 0,debug:void 0,system:void 0,errHandler:void 0,initialize:function(a,b,c,d,e,f,h,i){var j=this,k=j.manifestModel.getValue();z=j.manifestExt.getIsDynamic(k),j.setMediaSource(i),j.setVideoModel(e),j.setType(a),j.updateData(c,b).then(function(){return z?void("video"===j.getData().contentType?ob.call(j).then(function(a){b.liveEdge=a-g,o=!0,j.system.notify("liveEdgeFound")}):o=!0):(o=!0,void $.call(j))}),j.setBuffer(d),j.setScheduler(f),j.setFragmentController(h),j.indexHandler.setIsDynamic(z),j.bufferExt.decideBufferLength(k.minBufferTime,b,q).then(function(a){j.setMinBufferTime(a)})},getType:function(){return f},setType:function(a){f=a,void 0!==this.indexHandler&&this.indexHandler.setType(a)},getPeriodInfo:function(){return G},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},getScheduler:function(){return this.requestScheduler},setScheduler:function(a){this.requestScheduler=a},getFragmentController:function(){return this.fragmentController},setFragmentController:function(a){this.fragmentController=a},getAutoSwitchBitrate:function(){var a=this;return a.abrController.getAutoSwitchBitrate()},setAutoSwitchBitrate:function(a){this.abrController.setAutoSwitchBitrate(a)},getData:function(){return T},updateData:function(d,e,g){var h=this,i=Q.defer(),j=T;return j||(j=d),bb.call(h),cb.call(h,d,e).then(function(k){a=k,G=e,h.abrController.getPlaybackQuality(f,j).then(function(a){b||(b=db.call(h,a.quality));var e=function(e){v=!0,c=e,b=db.call(h,a.quality),b.segmentDuration&&(M=b.segmentDuration),T=d,h.seek(e),h.bufferExt.updateData(T,f),$.call(h),i.resolve()};g?e(g):h.indexHandler.getCurrentTime(b).then(e)})}),i.promise},getBuffer:function(){return U},setBuffer:function(a){U=a},getMinBufferTime:function(){return g},setMinBufferTime:function(a){g=a},setMediaSource:function(a){d=a},isReady:function(){return n===k},isBufferingCompleted:function(){return A},clearMetrics:function(){null!==f&&""!==f&&this.metricsModel.clearCurrentMetricsForType(f)},updateBufferState:function(){var a=this.videoModel.getCurrentTime();K&&L&&Math.abs(a-(t?u:N))>M?(N=this.videoModel.getCurrentTime(),ib.call(this,L)):jb.call(this)},updateStalledState:function(){y=this.videoModel.isStalled(),xb.call(this)},reset:function(a){bb.call(this),this.clearMetrics(),this.fragmentController.abortRequestsForModel(I),this.fragmentController.detachBufferController(I),I=null,B=null,C=null,s=[],D=Q.defer(),O=null,P=null,S=!1,R=null,e=null,a||(this.sourceBufferExt.abort(d,U),this.sourceBufferExt.removeSourceBuffer(d,U)),T=null,U=null},start:_,seek:ab,stop:bb}},MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.dependencies.BufferExtensions=function(){"use strict";var a,b,c=0,d=0,e=null,f=null,g=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},h=function(){var a,b=this,g=Q.defer();return Q.when(e?b.abrController.getPlaybackQuality("audio",e):c).then(function(e){Q.when(f?b.abrController.getPlaybackQuality("video",f):d).then(function(b){a=e.quality===c&&b.quality===d,a=a||e.confidence===MediaPlayer.rules.SwitchRequest.prototype.STRONG&&b.confidence===MediaPlayer.rules.SwitchRequest.prototype.STRONG,g.resolve(a)})}),g.promise};return{system:void 0,videoModel:void 0,manifestExt:void 0,metricsExt:void 0,metricsModel:void 0,abrController:void 0,bufferMax:void 0,updateData:function(a,b){var g=a.Representation_asArray.length-1;"audio"===b?(c=g,e=a):"video"===b&&(d=g,f=a)},getTopQualityIndex:function(a){var b=null;return"audio"===a?b=c:"video"===a&&(b=d),b
},decideBufferLength:function(b,c){return a=isNaN(c)||MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME<c&&c>b?Math.max(MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME,b):b>=c?Math.min(c,MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME):Math.min(c,b),Q.when(a)},getLeastBufferLevel:function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c),e=null;return e=null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},getRequiredBufferLength:function(c,d,e,f){var i,j=this,k=j.metricsModel.getReadOnlyMetricsFor("video"),l=j.metricsModel.getReadOnlyMetricsFor("audio"),m=f>=MediaPlayer.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD,n=Q.defer(),o=null;return j.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_MIN?(i=a,n.resolve(i)):j.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY?(i=f,n.resolve(i)):j.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED?(b=a,e||c||(o=h.call(j)),Q.when(o).then(function(a){a&&(b=m?MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY),i=b+d+Math.max(g.call(j,k),g.call(j,l)),n.resolve(i)})):n.reject("invalid bufferMax value: "+j.bufferMax),n.promise},getBufferTarget:function(){return void 0===b?a:b}}},MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_STARTUP=1,MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME=8,MediaPlayer.dependencies.BufferExtensions.START_TIME=2,MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferExtensions.prototype.constructor=MediaPlayer.dependencies.BufferExtensions,MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsMediaKeys:function(){"use strict";var a="WebKitMediaKeys"in window,b="MSMediaKeys"in window,c="MediaKeys"in window;return a||b||c},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLVideoElement))throw"element must be of type HTMLVideoElement.";var c=a.canPlayType(b);return"probably"===c}},MediaPlayer.utils.Debug=function(){"use strict";var a=!0,b=function(){if(a){var b="undefined"!=typeof log4javascript?log4javascript.getLogger():null;if(b){if(!b.initialized){var c=new log4javascript.PopUpAppender,d=new log4javascript.PatternLayout("%d{HH:mm:ss.SSS} %-5p - %m%n");c.setLayout(d),b.addAppender(c),b.setLevel(log4javascript.Level.ALL),b.initialized=!0}b.info.apply(b,arguments)}else console.log.apply(console,arguments)}this.eventBus.dispatchEvent({type:"log",message:arguments[0]})};return{eventBus:void 0,setLogToBrowserConsole:function(b){a=b},getLogToBrowserConsole:function(){return a},log:b}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,capabilityError:function(a){this.eventBus.dispatchEvent({type:"error",error:"capability",event:a})},downloadError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"download",event:{id:a,url:b,request:c}})},manifestError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"manifestError",event:{message:a,id:b,manifest:c}})},mediaSourceError:function(a){this.eventBus.dispatchEvent({type:"error",error:"mediasource",event:a})},mediaKeySessionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_session",event:a})},mediaKeyMessageError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_message",event:a})},mediaKeySystemSelectionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_system_selection",event:a})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]},c=function(){a={}};return c(),{addEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1===f&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},c=function(){for(var b=!0,c=a.length,d=0;c>d;d++)if(!a[d].isReady()){b=!1;break}return b},d=function(){for(var b=0;b<a.length;b++)a[b].executeCurrentRequest()};return{system:void 0,debug:void 0,fragmentLoader:void 0,process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),Q.when(b)},attachBufferController:function(c){if(!c)return null;var d=b(c);return d||(d=this.system.getObject("fragmentModel"),d.setContext(c),a.push(d)),d},detachBufferController:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},onBufferControllerStateChange:function(){c()&&d.call(this)},isFragmentLoadedOrPending:function(a,c){var d,e=b(a);return e?d=e.isFragmentLoadedOrPending(c):!1},getPendingRequests:function(a){var c=b(a);return c?c.getPendingRequests():null},getLoadingRequests:function(a){var c=b(a);return c?c.getLoadingRequests():null},isInitializationRequest:function(a){return a&&a.type&&"initialization segment"===a.type.toLowerCase()},getLoadingTime:function(a){var c=b(a);return c?c.getLoadingTime():null},getExecutedRequestForTime:function(a,b){return a?a.getExecutedRequestForTime(b):null},removeExecutedRequest:function(a,b){a&&a.removeExecutedRequest(b)},removeExecutedRequestsBeforeTime:function(a,b){a&&a.removeExecutedRequestsBeforeTime(b)},cancelPendingRequestsForModel:function(a){a&&a.cancelPendingRequests()},abortRequestsForModel:function(a){a&&a.abortRequests()},isFragmentExists:function(a){var b=Q.defer();return this.fragmentLoader.checkForExistence(a).then(function(){b.resolve(!0)},function(){b.resolve(!1)}),b.promise},prepareFragmentForLoading:function(a,c,d,e,f,g){var h=b(a);return h&&c?(h.addRequest(c),h.setCallbacks(d,e,f,g),Q.when(!0)):Q.when(null)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=3,b=500,c=[],d=null,e=function(a,f){var g=new XMLHttpRequest,h=null,i=!0,j=!0,k=this;c.push(g),a.requestStartDate=new Date,a.firstByteDate=a.requestStartDate,g.open("GET",a.url,!0),g.responseType="arraybuffer",d!=a.quality&&(d=a.quality,this.metricsModel.addDownloadSwitch(a.streamType,a.startTime,a.requestStartDate,a.quality)),a.range&&g.setRequestHeader("Range","bytes="+a.range),g.onprogress=function(b){i&&(i=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=new Date))},g.onload=function(){if(!(g.status<200||g.status>299)){j=!1,a.requestEndDate=new Date;{var b=a.requestEndDate,c=g.response;a.firstByteDate.getTime()-a.requestStartDate.getTime(),a.requestEndDate.getTime()-a.firstByteDate.getTime(),a.requestEndDate.getTime()-a.requestStartDate.getTime()}h=k.metricsModel.addHttpRequest(a.streamType,null,a.type,a.url,null,a.range,a.requestStartDate,a.firstByteDate,a.requestEndDate,g.status,null,a.duration),k.metricsModel.appendHttpTrace(h,b,(new Date).getTime()-b.getTime(),[c.byteLength]),a.deferred.resolve({data:c,request:a})}},g.onloadend=g.onerror=function(){if(-1!==c.indexOf(g)&&(c.splice(c.indexOf(g),1),j)){j=!1,a.requestEndDate=new Date;{a.firstByteDate.getTime()-a.requestStartDate.getTime(),a.requestEndDate.getTime()-a.firstByteDate.getTime(),a.requestEndDate.getTime()-a.requestStartDate.getTime()}h=k.metricsModel.addHttpRequest(a.streamType,null,a.type,a.url,null,a.range,a.requestStartDate,a.firstByteDate,a.requestEndDate,g.status,null,a.duration),f>0?(f--,setTimeout(function(){e.call(k,a,f)},b)):(k.errHandler.downloadError("content",a.url,g),a.deferred.reject(g))}},g.send()},f=function(a,c){var d=new XMLHttpRequest,e=!1,g=this;d.open("HEAD",a.url,!0),d.onload=function(){d.status<200||d.status>299||(e=!0,a.deferred.resolve(a))},d.onloadend=d.onerror=function(){e||(c>0?(c--,setTimeout(function(){f.call(g,a,c)},b)):a.deferred.reject(d))},d.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,load:function(b){return b?(b.deferred=Q.defer(),e.call(this,b,a),b.deferred.promise):Q.when(null)},checkForExistence:function(b){return b?(b.deferred=Q.defer(),f.call(this,b,a),b.deferred.promise):Q.when(null)},abort:function(){var a,b,d=c.length;for(a=0;d>a;a+=1)b=c[a],c[a]=null,b.abort(),b=null;c=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a,b,c,d,e,f=[],g=[],h=[],i=5,j=function(e){var g,i,j=this;b.call(a,e),g=function(b,d){h.splice(h.indexOf(b),1),f.push(b),c.call(a,b,d),b.deferred=null},i=function(b){h.splice(h.indexOf(b),1),d.call(a,b),b.deferred=null},j.fragmentLoader.load(e).then(g.bind(a,e),i.bind(a,e))},k=function(a){var b=f.indexOf(a);-1!==b&&f.splice(b,1)};return{system:void 0,debug:void 0,fragmentLoader:void 0,setContext:function(b){a=b},getContext:function(){return a},addRequest:function(a){a&&g.push(a)},setCallbacks:function(a,f,g,h){b=a,e=h,d=g,c=f},isFragmentLoadedOrPending:function(a){for(var b,c=!1,d=f.length,e=0;d>e;e++)if(b=f[e],a.startTime===b.startTime||"complete"===b.action&&a.action===b.action){if(a.url===b.url){c=!0;break}k(a)}if(!c)for(e=0,d=g.length;d>e;e+=1)b=g[e],a.url===b.url&&a.startTime===b.startTime&&(c=!0);if(!c)for(e=0,d=h.length;d>e;e+=1)b=h[e],a.url===b.url&&a.startTime===b.startTime&&(c=!0);return c},isReady:function(){return a.isReady()},getPendingRequests:function(){return g},getLoadingRequests:function(){return h},getLoadingTime:function(){var a,b,c=0;for(b=f.length-1;b>=0;b-=1)if(a=f[b],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){c=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return c},getExecutedRequestForTime:function(a){var b,c=f.length-1,d=0/0,e=0/0,g=null;for(b=c;b>=0;b-=1)if(g=f[b],d=g.startTime,e=d+g.duration,!isNaN(d)&&!isNaN(e)&&a>d&&e>a)return g;return null},removeExecutedRequest:function(a){k.call(this,a)},removeExecutedRequestsBeforeTime:function(a){var b,c=f.length-1,d=0/0,e=null;for(b=c;b>=0;b-=1)e=f[b],d=e.startTime,!isNaN(d)&&a>d&&k.call(this,e)},cancelPendingRequests:function(){g=[]},abortRequests:function(){this.fragmentLoader.abort(),h=[]},executeCurrentRequest:function(){var b,c=this;if(0!==g.length&&!(h.length>=i))switch(b=g.shift(),b.action){case"complete":f.push(b),e.call(a,b);break;case"download":h.push(b),j.call(c,b)}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.utils.Logger=function(){"use strict";var a="undefined"!=typeof log4javascript?log4javascript.getLogger():null,b=null,c=!0,d=function(){a?a.debug.apply(a,arguments):console.debug.apply(console,arguments)},e=function(){a?a.error.apply(a,arguments):console.error.apply(console,arguments)},f=function(){if("undefined"!=typeof log4javascript){b=new log4javascript.PopUpAppender;var c=new log4javascript.PatternLayout("%d{HH:mm:ss.SSS} %-5p - %m%n");b.setLayout(c),a.addAppender(b),a.setLevel(log4javascript.Level.ALL)}},g=function(){a?a.info.apply(a,arguments):console.info.apply(console,arguments)},h=function(){a?a.trace.apply(a,arguments):console.trace.apply(console,arguments)};return{debug:d,error:e,addAppender:f,info:g,trace:h,eventBus:void 0,setLogToBrowserConsole:function(a){c=a},getLogToBrowserConsole:function(){return c},log:function(a){this.eventBus.dispatchEvent({type:"log",message:a})}}},MediaPlayer.utils.Logger.prototype={constructor:MediaPlayer.utils.Logger},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=3,b=500,c=null,d=function(a){var b=null;return-1!==a.indexOf("/")&&(b=a.substring(0,a.lastIndexOf("/")+1)),b},e=function(a,f){var g=d(a),h=new XMLHttpRequest,i=new Date,j=null,k=!0,l=this;h.open("GET",a,!0),h.onload=function(){h.status<200||h.status>299||(k=!1,j=new Date,l.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,j,h.status,null,null),l.parser.parse(h.responseText,g).then(function(b){b.mpdUrl=a,b.mpdLoadedTime=j,c.resolve(b)},function(){c.reject(h)}))},h.onloadend=h.onerror=function(){k&&(k=!1,l.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,new Date,h.status,null,null),f>0?(f--,setTimeout(function(){e.call(l,a,f)},b)):(l.errHandler.downloadError("manifest",a,h),c.reject(h)))},h.send()};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,load:function(b){return c=Q.defer(),e.call(this,b,a),c.promise}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,getValue:function(){return a},setValue:function(b){a=b,this.system.notify("manifestUpdated")}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a,b=0/0,c=null,d=function(){null!==c&&(clearInterval(c),c=null)},e=function(){d.call(this),isNaN(b)||(c=setInterval(g.bind(this),1e3*b,this))},f=function(){var a=this,c=a.manifestModel.getValue();void 0!==c&&null!==c&&a.manifestExt.getRefreshDelay(c).then(function(c){b=c,e.call(a)})},g=function(){var b,c,d=this;Q.when(a?a.promise:!0).then(function(){a=Q.defer(),b=d.manifestModel.getValue(),c=b.mpdUrl,b.hasOwnProperty("Location")&&(c=b.Location),d.manifestLoader.load(c).then(function(a){d.manifestModel.setValue(a),f.call(d)})})},h=function(){a&&a.resolve()};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){f.call(this),this.system.mapHandler("streamsComposed",void 0,h.bind(this))},init:function(){f.call(this)},stop:function(){d.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return b?Q.when(new MediaSource):a?Q.when(new WebKitMediaSource):null},attachMediaSource:function(a,b){"use strict";return b.setSource(window.URL.createObjectURL(a)),Q.when(!0)},detachMediaSource:function(a){"use strict";return a.setSource(""),Q.when(!0)},setDuration:function(a,b){"use strict";return a.duration=b,Q.when(a.duration)},signalEndOfStream:function(a){"use strict";return a.endOfStream(),Q.when(!0)}},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,streamMetrics:{},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a]},clearAllCurrentMetrics:function(){this.streamMetrics={}},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new MediaPlayer.vo.metrics.HTTPRequest;return m.tcpid=b,m.type=c,m.url=d,m.actualurl=e,m.range=f,m.trequest=g,m.tresponse=h,m.tfinish=i,m.responsecode=j,m.interval=k,m.mediaduration=l,this.getMetricsFor(a).HttpList=[m],m},appendHttpTrace:function(a,b,c,d){},addRepresentationSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.RepresentationSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),f},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel=[d],d},addPlayList:function(a,b,c,d){},appendPlayListTrace:function(a,b,c,d,e,f,g,h){}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.dependencies.Mp4Processor=function(){"use strict";var a=function(a){var b=new mp4lib.boxes.MovieHeaderBox;return b.version=1,b.creation_time=0,b.modification_time=0,b.timescale=a.timescale,b.duration=Math.round(a.duration*a.timescale),b.rate=65536,b.volume=256,b.reserved=0,b.reserved_2=[0,0],b.matrix=[65536,0,0,0,65536,0,0,0,1073741824],b.pre_defined=[0,0,0,0,0,0],b.next_track_ID=a.trackId+1,b.flags=0,b},b=function(a){var b=new mp4lib.boxes.TrackBox;b.boxes=[];var c=new mp4lib.boxes.TrackHeaderBox;c.version=1,c.flags=7,c.creation_time=0,c.modification_time=0,c.track_id=a.trackId,c.reserved=0,c.duration=Math.round(a.duration*a.timescale),c.reserved_2=[0,0],c.layer=0,c.alternate_group=0,c.volume=256,c.reserved_3=0,c.matrix=[65536,0,0,0,65536,0,0,0,1073741824],c.width=a.width<<16,c.height=a.height<<16,b.boxes.push(c);var e=new mp4lib.boxes.MediaBox;return e.boxes=[],e.boxes.push(d(a)),e.boxes.push(f(a)),e.boxes.push(g(a)),b.boxes.push(e),b},c=function(a){var b=0,c=a.charCodeAt(0)-96<<10,d=a.charCodeAt(1)-96<<5,e=a.charCodeAt(2)-96;return b=c|d|e},d=function(a){var b=new mp4lib.boxes.MediaHeaderBox;return b.version=1,b.creation_time=0,b.modification_time=0,b.timescale=a.timescale,b.duration=Math.round(a.duration*a.timescale),b.pad=0,b.language=c(a.language),b.pre_defined=0,b},e=function(a){for(var b=0,c=0;c<a.length;c++)b|=a.charCodeAt(c)<<8*(a.length-c-1);return b},f=function(a){var b=new mp4lib.boxes.HandlerBox;switch(b.version=0,b.pre_defined=0,a.type){case"video":b.handler_type=e(b.HANDLERTYPEVIDEO),b.name=b.HANDLERVIDEONAME;break;case"audio":b.handler_type=e(b.HANDLERTYPEAUDIO),b.name=b.HANDLERAUDIONAME;break;default:b.handler_type=e(b.HANDLERTYPETEXT),b.name=b.HANDLERTEXTNAME}return b.name+="\x00",b.reserved=[0,0],b.flags=0,b},g=function(a){var b=new mp4lib.boxes.MediaInformationBox;switch(b.boxes=[],a.type){case"video":b.boxes.push(C(a));break;case"audio":b.boxes.push(D(a))}return b.boxes.push(h(a)),b.boxes.push(B(a)),b},h=function(){var a=new mp4lib.boxes.DataInformationBox;a.boxes=[];var b=new mp4lib.boxes.DataReferenceBox;b.version=0,b.entry_count=1,b.flags=0,b.boxes=[];var c=new mp4lib.boxes.DataEntryUrlBox;return c.location="",b.boxes.push(c),a.boxes.push(b),a},i=function(){var a=new mp4lib.boxes.TimeToSampleBox;return a.version=0,a.entry_count=0,a.flags=0,a.entry=[],a},j=function(){var a=new mp4lib.boxes.SampleToChunkBox;return a.version=0,a.entry_count=0,a.entry=[],a},k=function(){var a=new mp4lib.boxes.ChunkOffsetBox;return a.version=0,a.entry_count=0,a.flags=0,a.chunk_offset=[],a},l=function(){var a=new mp4lib.boxes.SampleSizeBox;return a.version=0,a.flags=0,a.sample_count=0,a.sample_size=0,a},m=function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length/2;c++)b[c]=parseInt(""+a[2*c]+a[2*c+1],16);return b},n=function(a,b){var c=new Uint8Array(a.length+b.length);return c.set(a,0),c.set(b,a.length),c},o=function(a){var b=new mp4lib.boxes.AVCConfigurationBox;b.configurationVersion=1,b.lengthSizeMinusOne=3,b.reserved=63,b.SPS_NAL=[],b.PPS_NAL=[];var c=new Uint8Array(0),d=a.codecPrivateData,e=d.split("00000001");e.splice(0,1);for(var f=0,g=0,h=0;h<e.length;h++){var i=new RegExp("^[A-Z0-9]7","gi"),j=new RegExp("^[A-Z0-9]8","gi"),k=m(e[h]);e[h].match(i)&&(b.SPS_NAL[f++]={NAL_length:k.length,NAL:k},b.AVCProfileIndication=parseInt(e[h].substr(2,2),16),b.profile_compatibility=parseInt(e[h].substr(4,2),16),b.AVCLevelIndication=parseInt(e[h].substr(6,2),16)),e[h].match(j)&&(b.PPS_NAL[g++]={NAL_length:k.length,NAL:k});var l=new Uint8Array(k.length+4);l[3]=k.length,l.set(k,4),c=n(c,l)}return b.numOfSequenceParameterSets=f,b.numOfPictureParameterSets=g,b},p=function(a){var b=null;return b=void 0!==a.contentProtection?new mp4lib.boxes.EncryptedVideoBox:new mp4lib.boxes.AVC1VisualSampleEntryBox,b.boxes=[],b.data_reference_index=1,b.compressorname="AVC Coding",b.depth=24,b.reserved=[0,0,0,0,0,0],b.reserved_2=0,b.reserved_3=0,b.pre_defined=0,b.pre_defined_2=[0,0,0],b.pre_defined_3=65535,b.frame_count=1,b.horizresolution=4718592,b.vertresolution=4718592,b.height=a.height,b.width=a.width,b.boxes.push(o(a)),void 0!=a.contentProtection&&b.boxes.push(u(a)),b},q=function(a){var b=new mp4lib.boxes.OriginalFormatBox;return b.data_format=e(a.codecs.substring(0,a.codecs.indexOf("."))),b},r=function(){var a=new mp4lib.boxes.SchemeTypeBox;return a.flags=0,a.version=0,a.scheme_type=1667591779,a.scheme_version=65536,a},s=function(a){var b=new mp4lib.boxes.SchemeInformationBox;return b.boxes=[],b.boxes.push(t(a)),b},t=function(){var a=new mp4lib.boxes.TrackEncryptionBox;return a.default_IsEncrypted=1,a.default_IV_size=8,a.default_KID=[],a},u=function(a){var b=new mp4lib.boxes.ProtectionSchemeInformationBox;return b.boxes=[],b.boxes.push(q(a)),b.boxes.push(r()),b.boxes.push(s(a)),b},v=function(a){var b=a.codecs.substring(0,a.codecs.indexOf("."));switch(b){case"avc1":return p(a)}},w=function(a){for(var b=[];a.length>=2;)b.push(parseInt(a.substring(0,2),16)),a=a.substring(2,a.length);return b},x=function(a){var b=w(a.codecPrivateData),c=b.length,d=new Uint8Array(2+c);d[0]=5,d[1]=c,d.set(b,2);var e=13+d.length,f=new Uint8Array(2+e);f[0]=4,f[1]=e,f[2]=64,f[3]=20,f[3]|=0,f[3]|=1,f[4]=255,f[5]=255,f[6]=255,f[7]=255,f[8]=255,f[9]=255,f[10]=255,f[11]=(4278190080&a.bandwidth)>>24,f[12]|=(16711680&a.bandwidth)>>16,f[13]|=(65280&a.bandwidth)>>8,f[14]|=255&a.bandwidth,f.set(d,15);var g=3+f.length,h=new Uint8Array(2+g);return h[0]=3,h[1]=g,h[2]=(65280&a.trackId)>>8,h[3]=255&a.trackId,h[4]=0,h.set(f,5),h},y=function(a){var b=null;b=void 0!==a.contentProtection?new mp4lib.boxes.EncryptedAudioBox:new mp4lib.boxes.MP4AudioSampleEntryBox,b.boxes=[],b.reserved=[0,0,0,0,0,0],b.data_reference_index=1,b.reserved_2=[0,0],b.channelcount=a.channels,b.samplesize=16,b.pre_defined=0,b.reserved_3=0,b.samplerate=a.samplingRate<<16;var c=new mp4lib.boxes.ESDBox,d=x(a);return c.ES_tag=d[0],c.ES_length=d[1],c.ES_data=d.subarray(2,d.length),b.boxes.push(c),void 0!=a.contentProtection&&b.boxes.push(u(a)),b},z=function(a){var b=a.codecs.substring(0,a.codecs.indexOf("."));switch(b){case"mp4a":return y(a)}return null},A=function(a){var b=new mp4lib.boxes.SampleDescriptionBox;switch(b.boxes=[],a.type){case"video":b.boxes.push(v(a));break;case"audio":b.boxes.push(z(a))}return b},B=function(a){var b=new mp4lib.boxes.SampleTableBox;return b.boxes=[],b.boxes.push(i(a)),b.boxes.push(j(a)),b.boxes.push(k(a)),b.boxes.push(l(a)),b.boxes.push(A(a)),b},C=function(){var a=new mp4lib.boxes.VideoMediaHeaderBox;return a.version=0,a.flags=1,a.graphicsmode=0,a.opcolor=[0,0,0],a},D=function(){var a=new mp4lib.boxes.SoundMediaHeaderBox;return a.version=0,a.balance=0,a.reserved=0,a},E=function(){var a=new mp4lib.boxes.FileTypeBox;return a.major_brand=1769172790,a.minor_brand=1,a.compatible_brands=[],a.compatible_brands[0]=1769172845,a.compatible_brands[1]=1769172790,a.compatible_brands[2]=1836278888,a},F=function(a){var b=new mp4lib.boxes.MovieExtendsBox;if(b.boxes=[],a.duration!==Number.POSITIVE_INFINITY){var c=new mp4lib.boxes.MovieExtendsHeaderBox;c.version=1,c.flags=0,c.fragment_duration=Math.round(a.duration*a.timescale),b.boxes.push(c)}var d=new mp4lib.boxes.TrackExtendsBox;return d.track_ID=a.trackId,d.default_sample_description_index=1,d.default_sample_duration=0,d.default_sample_flags=0,d.default_sample_size=0,b.boxes.push(d),b},G=function(a){var b=new mp4lib.boxes.ProtectionSystemSpecificHeaderBox;b.version=0,b.flags=0;var c=a.contentProtection.schemeIdUri.substring(8).replace(/[^A-Fa-f0-9]/g,"");b.SystemID=m(c);var d=BASE64.decodeArray(a.contentProtection.pro.__text);return b.DataSize=d.length,b.Data=d,b},H=function(c){var d=new mp4lib.boxes.File;d.boxes=[];var e=new mp4lib.boxes.MovieBox;return e.boxes=[],e.boxes.push(a(c)),e.boxes.push(b(c)),e.boxes.push(F(c)),void 0!=c.contentProtection&&e.boxes.push(G(c)),d.boxes.push(E()),d.boxes.push(e),mp4lib.serialize(d)};return{generateInitSegment:H}},MediaPlayer.dependencies.Mp4Processor.prototype={constructor:MediaPlayer.dependencies.Mp4Processor},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a=null,b=null,c=function(a){var b=this;b.protectionModel.removeKeySystem(a)},d=function(a,c){for(var d=this,e=0;e<b.length;++e)for(var f=0;f<c.length;++f)if(b[e].isSupported(c[f])&&d.protectionExt.supportsCodec(b[e].keysTypeString,a)){var g=d.manifestExt.getKID(c[f]);return g||(g="unknown"),d.protectionModel.addKeySystem(g,c[f],b[e]),g}throw new Error("DRM: The protection system for this content is not supported.")},e=function(a,b,c){var d=this,e=null,f=null;d.protectionModel.needToAddKeySession(a)&&(f=d.protectionModel.getInitData(a),!f&&c&&(f=c),f&&(e=d.protectionModel.addKeySession(a,b,f)))},f=function(a,b,c,d){var e,f=this;return e=f.protectionModel.updateFromMessage(a,c,d),e.then(function(a){b.update(a)}),e};return{system:void 0,debug:void 0,manifestExt:void 0,capabilities:void 0,videoModel:void 0,protectionModel:void 0,protectionExt:void 0,setup:function(){b=this.protectionExt.getKeySystems()},init:function(b,c){this.videoModel=b,this.protectionModel=c,a=this.videoModel.getElement()},selectKeySystem:d,ensureKeySession:e,updateFromMessage:f,teardownKeySystem:c}},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict"},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,supportsCodec:function(a,b){"use strict";var c="WebKitMediaKeys"in window,d="MSMediaKeys"in window,e="MediaKeys"in window;return e?MediaKeys.isTypeSupported(a,b):c?WebKitMediaKeys.isTypeSupported(a,b):d?MSMediaKeys.isTypeSupported(a,b):!1},createMediaKeys:function(a){"use strict";var b="WebKitMediaKeys"in window,c="MSMediaKeys"in window,d="MediaKeys"in window;return d?new MediaKeys(a):b?new WebKitMediaKeys(a):c?new MSMediaKeys(a):null},setMediaKey:function(a,b){var c="WebKitSetMediaKeys"in a,d="msSetMediaKeys"in a,e="SetMediaKeys"in a;return e?a.SetMediaKeys(b):c?a.WebKitSetMediaKeys(b):d?a.msSetMediaKeys(b):void 0},createSession:function(a,b,c){return a.createSession(b,c)},getKeySystems:function(){var a=function(a,b){var c=Q.defer(),d=null,e=[],f=new DOMParser,g=f.parseFromString(a,"application/xml");if(!g.getElementsByTagName("Challenge")[0])return c.reject("DRM: playready update, can not find Challenge in keyMessage"),c.promise;var h=g.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;h&&(d=BASE64.decode(h));var i=g.getElementsByTagName("name"),j=g.getElementsByTagName("value");if(i.length!=j.length)return c.reject("DRM: playready update, invalid header name/value pair in keyMessage"),c.promise;for(var k=0;k<i.length;k++)e[k]={name:i[k].childNodes[0].nodeValue,value:j[k].childNodes[0].nodeValue};var l=new XMLHttpRequest;return l.onload=function(){200==l.status?c.resolve(new Uint8Array(l.response)):c.reject('DRM: playready update, XHR status is "'+l.statusText+'" ('+l.status+"), expected to be 200. readyState is "+l.readyState)},l.onabort=function(){c.reject('DRM: playready update, XHR aborted. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState)},l.onerror=function(){c.reject('DRM: playready update, XHR error. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState)},l.open("POST",b),l.responseType="arraybuffer",e&&e.forEach(function(a){l.setRequestHeader(a.name,a.value)}),l.send(d),c.promise},b=function(a,b){return null===a&&0===b.length},c=function(a){var b=0,c=0,d=0,e=new Uint8Array([112,115,115,104,0,0,0,0]),f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),g=null,h=null,i=null,j=null;if("pro"in a)g=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;g=BASE64.decodeArray(a.prheader.__text)}return c=g.length,d=4+e.length+f.length+4+c,h=new ArrayBuffer(d),i=new Uint8Array(h),j=new DataView(h),j.setUint32(b,d),b+=4,i.set(e,b),b+=e.length,i.set(f,b),b+=f.length,j.setUint32(b,c),b+=4,i.set(g,b),b+=c,i};return[{schemeIdUri:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:b,getInitData:c,getUpdate:a},{schemeIdUri:"urn:mpeg:dash:mp4protection:2011",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()&&"cenc"===a.value.toLowerCase()},needToAddKeySession:b,getInitData:function(){return null},getUpdate:a},{schemeIdUri:"urn:uuid:00000000-0000-0000-0000-000000000000",keysTypeString:"webkit-org.w3.clearkey",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:function(){return!0},getInitData:function(){return null},getUpdate:function(a){return Q.when(a)}}]},addKey:function(a,b,c,d,e){a.webkitAddKey(b,c,d,e)},generateKeyRequest:function(a,b,c){a.webkitGenerateKeyRequest(b,c)},listenToNeedKey:function(a,b){a.listen("webkitneedkey",b),a.listen("msneedkey",b),a.listen("needKey",b)},listenToKeyError:function(a,b){a.addEventListener("webkitkeyerror",b,!1),a.addEventListener("mskeyerror",b,!1),a.addEventListener("keyerror",b,!1)},listenToKeyMessage:function(a,b){a.addEventListener("webkitkeymessage",b,!1),a.addEventListener("mskeymessage",b,!1),a.addEventListener("keymessage",b,!1)},listenToKeyAdded:function(a,b){a.addEventListener("webkitkeyadded",b,!1),a.addEventListener("mskeyadded",b,!1),a.addEventListener("keyadded",b,!1)},unlistenToKeyError:function(a,b){a.removeEventListener("webkitkeyerror",b),a.removeEventListener("mskeyerror",b),a.removeEventListener("keyerror",b)},unlistenToKeyMessage:function(a,b){a.removeEventListener("webkitkeymessage",b),a.removeEventListener("mskeymessage",b),a.removeEventListener("keymessage",b)},unlistenToKeyAdded:function(a,b){a.removeEventListener("webkitkeyadded",b),a.removeEventListener("mskeyadded",b),a.removeEventListener("keyadded",b)}},MediaPlayer.models.ProtectionModel=function(){"use strict";var a=null,b=null,c=null,d=null,e=[];return{system:void 0,videoModel:void 0,protectionExt:void 0,setup:function(){a=this.videoModel.getElement()},init:function(b){this.videoModel=b,a=this.videoModel.getElement()},addKeySession:function(a,f,g){var h=null;return h=this.protectionExt.createSession(e[a].keys,f,g),this.protectionExt.listenToKeyAdded(h,b),this.protectionExt.listenToKeyError(h,c),this.protectionExt.listenToKeyMessage(h,d),e[a].initData=g,e[a].keySessions.push(h),h},addKeySystem:function(b,c,d){var f=null;f=this.protectionExt.createMediaKeys(d.keysTypeString),this.protectionExt.setMediaKey(a,f),e[b]={kID:b,contentProtection:c,keySystem:d,keys:f,initData:null,keySessions:[]}},removeKeySystem:function(a){if(null!==a&&void 0!==e[a]&&0!==e[a].keySessions.length){for(var f=e[a].keySessions,g=0;g<f.length;++g)this.protectionExt.unlistenToKeyError(f[g],c),this.protectionExt.unlistenToKeyAdded(f[g],b),this.protectionExt.unlistenToKeyMessage(f[g],d),f[g].close();e[a]=void 0}},needToAddKeySession:function(a){var b=null;return b=e[a],b.keySystem.needToAddKeySession(b.initData,b.keySessions)
},getInitData:function(a){var b=null;return b=e[a],b.keySystem.getInitData(b.contentProtection)},updateFromMessage:function(a,b,c){return e[a].keySystem.getUpdate(b,c)},listenToNeedKey:function(a){this.protectionExt.listenToNeedKey(this.videoModel,a)},listenToKeyError:function(a){c=a;for(var b=0;b<e.length;++b)for(var d=e[b].keySessions,f=0;f<d.length;++f)this.protectionExt.listenToKeyError(d[f],a)},listenToKeyMessage:function(a){d=a;for(var b=0;b<e.length;++b)for(var c=e[b].keySessions,f=0;f<c.length;++f)this.protectionExt.listenToKeyMessage(c[f],a)},listenToKeyAdded:function(a){b=a;for(var c=0;c<e.length;++c)for(var d=e[c].keySessions,f=0;f<d.length;++f)this.protectionExt.listenToKeyAdded(d[f],a)}}},MediaPlayer.models.ProtectionModel.prototype={constructor:MediaPlayer.models.ProtectionModel},MediaPlayer.dependencies.RequestScheduler=function(){"use strict";var a=[],b=null,c=null,d=!1,e=0,f=1,g=2,h=function(a,b,c){if(a&&b){var e;e=w.call(this,a,g),e.setScheduledTask(b),e.setIsScheduled(!0),e.setExecuteTime(c),d||i.call(this)}},i=function(){var a=this.videoModel.getElement();this.schedulerExt.attachScheduleListener(a,j.bind(this)),this.schedulerExt.attachUpdateScheduleListener(a,m.bind(this)),d=!0},j=function(){var a,b,c,d=x.call(this,g),e=d.length,f=this.videoModel.getCurrentTime();for(c=0;e>c;c+=1)a=d[c],b=a.getExecuteTime(),a.getIsScheduled()&&f>b&&(a.executeScheduledTask(),a.setIsScheduled(!1))},k=function(a){var b,c=z(a,g);c&&(y(c),b=x.call(this,g),0===b.length&&l.call(this))},l=function(){var a=this.videoModel.getElement();this.schedulerExt.detachScheduleListener(a,j.bind(this)),this.schedulerExt.detachUpdateScheduleListener(a,m.bind(this)),d=!1},m=function(){n.call(this),j.call(this)},n=function(){var a,b=x.call(this,g),c=b.length;for(a=0;c>a;a+=1)b[a].setIsScheduled(!0)},o=function(a,b,c){if(a&&b){var d,e,g=c.getTime()-(new Date).getTime();e=w.call(this,a,f),e.setScheduledTask(b),d=setTimeout(function(){e.executeScheduledTask(),y(e)},g),e.setExecuteId(d)}},p=function(a){var b=z(a,f);b&&(clearTimeout(b.getExecuteId()),y(b))},q=function(a,b){if(a&&b){var c=z(a,e);c||(c=w.call(this,a,e)),c.setIsScheduled(!0),c.setScheduledTask(b),t.call(this),b.call(a)}},r=function(){s.call(this)},s=function(){var a,b,c=this,d=x.call(c,e),f=d.length;for(b=0;f>b;b+=1)a=d[b],a.getIsScheduled()&&a.executeScheduledTask()},t=function(){null===c&&(this.adjustExecuteInterval(),c=setInterval(r.bind(this),b))},u=function(a){var b=z(a,e),c=x.call(this,e);b&&(y(b),0===c.length&&v.call(this))},v=function(){clearInterval(c),c=null},w=function(b,c){if(!b)return null;var d=this.system.getObject("schedulerModel");return d.setContext(b),d.setType(c),a.push(d),d},x=function(b){var c,d,e=[];for(d=0;d<a.length;d+=1)c=a[d],c.getType()===b&&e.push(c);return e},y=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},z=function(b,c){for(var d=0;d<a.length;d++)if(a[d].getContext()===b&&a[d].getType()===c)return a[d];return null};return{system:void 0,videoModel:void 0,debug:void 0,schedulerExt:void 0,isScheduled:function(a){var b=z(a,e);return!!b&&b.getIsScheduled()},getExecuteInterval:function(){return b},adjustExecuteInterval:function(){if(!(a.length<1)){var d=this.schedulerExt.getExecuteInterval(a[0].getContext());b!==d&&(b=d,null!==c&&(clearInterval(c),c=setInterval(r.bind(this),b)))}},startScheduling:q,stopScheduling:u,setTriggerForVideoTime:h,setTriggerForWallTime:o,removeTriggerForVideoTime:k,removeTriggerForWallTime:p}},MediaPlayer.dependencies.RequestScheduler.prototype={constructor:MediaPlayer.dependencies.RequestScheduler},MediaPlayer.dependencies.SchedulerExtensions=function(){"use strict"},MediaPlayer.dependencies.SchedulerExtensions.prototype={constructor:MediaPlayer.dependencies.SchedulerExtensions,getExecuteInterval:function(a){var b=1e3;return"undefined"!=typeof a.getMinBufferTime&&(b=1e3*a.getMinBufferTime()/4,b=Math.max(b,1e3)),b},attachScheduleListener:function(a,b){a.addEventListener("timeupdate",b)},detachScheduleListener:function(a,b){a.removeEventListener("timeupdate",b)},attachUpdateScheduleListener:function(a,b){a.addEventListener("seeking",b)},detachUpdateScheduleListener:function(a,b){a.removeEventListener("seeking",b)}},MediaPlayer.dependencies.SchedulerModel=function(){"use strict";var a,b,c,d,e,f=!1;return{system:void 0,debug:void 0,schedulerExt:void 0,setContext:function(b){a=b},getContext:function(){return a},setScheduledTask:function(a){b=a},executeScheduledTask:function(){b.call(a)},setExecuteTime:function(a){d=a},getExecuteTime:function(){return d},setExecuteId:function(a){e=a},getExecuteId:function(){return e},setType:function(a){c=a},getType:function(){return c},setIsScheduled:function(a){f=a},getIsScheduled:function(){return f}}},MediaPlayer.dependencies.SchedulerModel.prototype={constructor:MediaPlayer.dependencies.SchedulerModel},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.manifestExt=void 0},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=Q.defer(),d=this;try{c.resolve(a.addSourceBuffer(b))}catch(e){d.manifestExt.getIsTextTrack(b)?c.resolve(d.system.getObject("textVTTSourceBuffer")):c.reject(e.description)}return c.promise},removeSourceBuffer:function(a,b){"use strict";var c=Q.defer();try{c.resolve(a.removeSourceBuffer(b))}catch(d){c.reject(d.description)}return c.promise},getBufferRange:function(a,b,c){"use strict";var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(m){return Q.when(null)}if(null!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i){if(k=Math.abs(g-b),b>=g&&h>b){i=g,j=h;continue}if(l>=k){i=g,j=h;continue}}else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return Q.when({start:i,end:j})}return Q.when(null)},getAllRanges:function(a){var b=null;try{return b=a.buffered,Q.when(b)}catch(c){return Q.when(null)}},getBufferLength:function(a,b,c){"use strict";var d=this,e=Q.defer();return d.getBufferRange(a,b,c).then(function(a){e.resolve(null===a?0:a.end-b)}),e.promise},waitForUpdateEnd:function(a){"use strict";var b,c=Q.defer(),d=50,e=function(){a.updating||(clearInterval(b),c.resolve(!0))},f=function(){a.removeEventListener("updateend",f,!1),c.resolve(!0)};if(a.hasOwnProperty("addEventListener"))try{a.addEventListener("updateend",f,!1)}catch(g){b=setInterval(e,d)}else b=setInterval(e,d);return c.promise},append:function(a,b){var c=Q.defer();try{"append"in a?a.append(b):"appendBuffer"in a&&a.appendBuffer(b),this.waitForUpdateEnd(a).then(function(){c.resolve()})}catch(d){c.reject({err:d,data:b})}return c.promise},remove:function(a,b,c,d,e){var f=Q.defer();try{b>=0&&d>b&&c>b&&"ended"!==e.readyState&&a.remove(b,c),this.waitForUpdateEnd(a).then(function(){f.resolve()})}catch(g){f.reject(g)}return f.promise},abort:function(a,b){"use strict";var c=Q.defer();try{"open"===a.readyState&&b.abort(),c.resolve()}catch(d){c.reject(d.description)}return c.promise}},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=null,r=null,s=null,t=null,u=-1,v=null,w=-1,x=null,y=-1,z=!0,A=!1,B=!1,C=null,D=[],E=null,F=function(){A&&this.videoModel.play()},G=function(){this.videoModel.pause()},H=function(a){A&&(this.system.notify("setCurrentTime"),this.videoModel.setCurrentTime(a),t&&t.seek(a),v&&v.seek(a))},I=function(a){var b,c=this;if(b="msneedkey"!==a.type?a.type:q,D.push({type:b,initData:a.initData}),s&&q&&!C)try{C=c.protectionController.selectKeySystem(q,s)}catch(d){G.call(c),c.errHandler.mediaKeySystemSelectionError(d)}C&&c.protectionController.ensureKeySession(C,b,a.initData)},J=function(a){var b=this,c=null,d=null,e=null,f=null;c=a.target,d=new Uint16Array(a.message.buffer),e=String.fromCharCode.apply(null,d),f=a.destinationURL;var g=b.manifestModel.getValue();g.backUrl&&(f=g.backUrl),b.protectionController.updateFromMessage(C,c,e,f).fail(function(a){G.call(b),b.errHandler.mediaKeyMessageError(a)})},K=function(){},L=function(){var a,b=event.target;switch(a="DRM: MediaKeyError - sessionId: "+b.sessionId+" errorCode: "+b.error.code+" systemErrorCode: "+b.error.systemCode+" [",b.error.code){case 1:a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="]",this.errHandler.mediaKeySessionError(a)},M=function(a){var b=Q.defer(),c=this,d=function(c){a.removeEventListener("sourceopen",d),a.removeEventListener("webkitsourceopen",d),b.resolve(a)};return a.addEventListener("sourceopen",d,!1),a.addEventListener("webkitsourceopen",d,!1),c.mediaSourceExt.attachMediaSource(a,c.videoModel),b.promise},N=function(){var c=this;t&&t.reset(B),v&&v.reset(B),b&&c.mediaSourceExt.detachMediaSource(c.videoModel),A=!1,C=null,D=[],s=null,t=null,v=null,x=null,q=null,r=null,b=null,a=null},O=function(b,c,d,e){if(b&&c&&d)if(null===t&&null===v&&null===x){var f="No streams to play.";this.errHandler.manifestError(f,"nostreams",a),e.reject()}else e.resolve(!0)},P=function(){var a=Q.defer(),c=!1,d=!1,e=!1,f=this,g=f.manifestModel.getValue();return f.manifestExt.getDuration(g,E).then(function(){f.manifestExt.getVideoData(g,E.index).then(function(h){return null!==h?(f.manifestExt.getDataIndex(h,g,E.index).then(function(a){u=a}),f.manifestExt.getCodec(h).then(function(a){return q=a,f.manifestExt.getContentProtectionData(h).then(function(c){if(c&&!f.capabilities.supportsMediaKeys())return f.errHandler.capabilityError("mediakeys"),Q.when(null);if(s=c,!f.capabilities.supportsCodec(f.videoModel.getElement(),a)){var d="Video Codec ("+a+") is not supported.";return f.errHandler.manifestError(d,"codec",g),Q.when(null)}return f.sourceBufferExt.createSourceBuffer(b,a)})}).then(function(g){null===g||(t=f.system.getObject("bufferController"),t.initialize("video",E,h,g,f.videoModel,f.requestScheduler,f.fragmentController,b)),c=!0,O.call(f,c,d,e,a)},function(){f.errHandler.mediaSourceError("Error creating video source buffer."),c=!0,O.call(f,c,d,e,a)})):(c=!0,O.call(f,c,d,e,a)),f.manifestExt.getAudioDatas(g,E.index)}).then(function(h){return null!==h&&h.length>0?f.manifestExt.getPrimaryAudioData(g,E.index).then(function(h){f.manifestExt.getDataIndex(h,g,E.index).then(function(a){w=a}),f.manifestExt.getCodec(h).then(function(a){return r=a,f.manifestExt.getContentProtectionData(h).then(function(c){if(c&&!f.capabilities.supportsMediaKeys())return f.errHandler.capabilityError("mediakeys"),Q.when(null);if(s=c,!f.capabilities.supportsCodec(f.videoModel.getElement(),a)){var d="Audio Codec ("+a+") is not supported.";return f.errHandler.manifestError(d,"codec",g),Q.when(null)}return f.sourceBufferExt.createSourceBuffer(b,a)})}).then(function(g){null===g||(v=f.system.getObject("bufferController"),v.initialize("audio",E,h,g,f.videoModel,f.requestScheduler,f.fragmentController,b)),d=!0,O.call(f,c,d,e,a)},function(){f.errHandler.mediaSourceError("Error creating audio source buffer."),d=!0,O.call(f,c,d,e,a)})}):(d=!0,O.call(f,c,d,e,a)),f.manifestExt.getTextData(g,E.index)}).then(function(h){var i;null!==h?(f.manifestExt.getDataIndex(h,g,E.index).then(function(a){y=a}),f.manifestExt.getMimeType(h).then(function(a){return i=a,f.sourceBufferExt.createSourceBuffer(b,i)}).then(function(b){null===b||(x=f.system.getObject("textController"),x.initialize(E.index,h,b,f.videoModel),b.hasOwnProperty("initialize")&&b.initialize(i,x),e=!0,O.call(f,c,d,e,a))},function(b){f.errHandler.mediaSourceError("Error creating text source buffer."),e=!0,O.call(f,c,d,e,a)})):(e=!0,O.call(f,c,d,e,a))})}),a.promise},R=function(){var a=this,c=Q.defer();return a.manifestExt.getDuration(a.manifestModel.getValue(),E).then(function(c){return a.mediaSourceExt.setDuration(b,c)}).then(function(){A=!0,c.resolve(!0)}),c.promise},S=function(){var a=this.timelineConverter.calcPresentationStartTime(E);a!=this.videoModel.getCurrentTime()&&(this.system.notify("setCurrentTime"),this.videoModel.setCurrentTime(a)),c.resolve(null)},T=function(){},U=function(){this.scheduleWhilePaused||ab.call(this)},V=function(a){var b=a.srcElement.error,c=b.code,d="";if(-1!==c){switch(c){case 1:d="MEDIA_ERR_ABORTED";break;case 2:d="MEDIA_ERR_NETWORK";break;case 3:d="MEDIA_ERR_DECODE";break;case 4:d="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:d="MEDIA_ERR_ENCRYPTED"}B=!0,this.errHandler.mediaSourceError(d),this.reset()}},W=function(){var a=this.videoModel.getCurrentTime();t&&t.seek(a),v&&v.seek(a)},X=function(){this.videoModel.listen("seeking",h),this.videoModel.unlisten("seeked",i)},Y=function(){_.call(this)},Z=function(){_.call(this)},$=function(){t&&t.updateStalledState(),v&&v.updateStalledState()},_=function(){t&&t.updateBufferState(),v&&v.updateBufferState()},ab=function(){t&&t.stop(),v&&v.stop()},bb=function(d){var e=this;return a=d,e.mediaSourceExt.createMediaSource().then(function(a){return M.call(e,a)}).then(function(a){return b=a,P.call(e)}).then(function(){return R.call(e)}).then(function(){return c.promise}).then(function(){0===E.index&&z&&F.call(e)})},cb=function(){this.videoModel.unlisten("seeking",h),this.videoModel.listen("seeked",i)},db=function(){t&&!t.isBufferingCompleted()||v&&!v.isBufferingCompleted()||b&&this.mediaSourceExt.signalEndOfStream(b)},eb=function(){ab.call(this)},fb=function(){var a=this.timelineConverter.calcPresentationStartTime(E);t&&t.seek(a),v&&v.seek(a)},gb=function(a){var b,c,d,e=this,f=Q.defer(),g=Q.defer(),h=e.manifestModel.getValue();return E=a,t?(b=t.getData(),c=b&&b.hasOwnProperty("id")?e.manifestExt.getDataForId(b.id,h,E.index):e.manifestExt.getDataForIndex(u,h,E.index),c.then(function(a){t.updateData(a,E).then(function(){f.resolve()})})):f.resolve(),v?(d=e.manifestExt.getDataForIndex(w,h,E.index),d.then(function(a){v.updateData(a,E).then(function(){g.resolve()})})):g.resolve(),Q.when(f.promise,g.promise)};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,bufferExt:void 0,manifestExt:void 0,fragmentController:void 0,abrController:void 0,fragmentExt:void 0,protectionModel:void 0,protectionController:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,metricsExt:void 0,errHandler:void 0,timelineConverter:void 0,requestScheduler:void 0,scheduleWhilePaused:void 0,setup:function(){this.system.mapHandler("setCurrentTime",void 0,cb.bind(this)),this.system.mapHandler("bufferingCompleted",void 0,db.bind(this)),this.system.mapHandler("segmentLoadingFailed",void 0,eb.bind(this)),this.system.mapHandler("liveEdgeFound",void 0,fb.bind(this)),c=Q.defer(),e=T.bind(this),f=U.bind(this),g=V.bind(this),h=W.bind(this),i=X.bind(this),k=Y.bind(this),l=$.bind(this),j=Z.bind(this),d=S.bind(this)},load:function(a,b){E=b,bb.call(this,a)},setVideoModel:function(a){this.videoModel=a,this.videoModel.listen("play",e),this.videoModel.listen("pause",f),this.videoModel.listen("error",g),this.videoModel.listen("seeking",h),this.videoModel.listen("timeupdate",j),this.videoModel.listen("progress",k),this.videoModel.listen("ratechange",l),this.videoModel.listen("loadedmetadata",d),this.requestScheduler.videoModel=a},setAudioTrack:function(a){var b,c=Q.defer(),d=this.videoModel.getCurrentTime(),e=this.manifestModel.getValue(),f=this;return v?f.manifestExt.getDataIndex(a,e,E.index).then(function(a){w=a,v.emptyBuffer(d).then(function(){b=e.mpdUrl,e.hasOwnProperty("Location")&&(b=e.Location),f.manifestLoader.load(b).then(function(a){f.manifestModel.setValue(a),c.resolve()})})}):c.reject(),c.promise},initProtection:function(){m=I.bind(this),n=J.bind(this),o=K.bind(this),p=L.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(this.getVideoModel()),this.protectionController=this.system.getObject("protectionController"),this.protectionController.init(this.videoModel,this.protectionModel),this.protectionModel.listenToNeedKey(m),this.protectionModel.listenToKeyMessage(n),this.protectionModel.listenToKeyError(p),this.protectionModel.listenToKeyAdded(o)},getVideoModel:function(){return this.videoModel},getManifestExt:function(){var a=this;return a.manifestExt},setAutoPlay:function(a){z=a},getAutoPlay:function(){return z},reset:function(){G.call(this),this.videoModel.unlisten("play",e),this.videoModel.unlisten("pause",f),this.videoModel.unlisten("error",g),this.videoModel.unlisten("seeking",h),this.videoModel.unlisten("timeupdate",j),this.videoModel.unlisten("progress",k),this.videoModel.unlisten("loadedmetadata",d),N.call(this),this.protectionController&&this.protectionController.teardownKeySystem(C),this.protectionController=void 0,this.protectionModel=void 0,this.fragmentController=void 0,this.requestScheduler=void 0,c=Q.defer()},getDuration:function(){return E.duration},getStartTime:function(){return E.start},getPeriodIndex:function(){return E.index},getId:function(){return E.id},getPeriodInfo:function(){return E},updateData:gb,play:F,seek:H,pause:G}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b,c,d,e,f=[],g=4,h=3,i=!0,j=null,k=function(){a.play()},l=function(){a.pause()},m=function(b){a.seek(b)},n=function(a,b){var c=a.getElement(),d=b.getElement();return d.parentNode||c.parentNode.insertBefore(d,c),c.style.width="0px",d.style.width="100%",q(c,d),p.call(this,a),o.call(this,b),Q.when(!0)},o=function(a){a.listen("seeking",c),a.listen("progress",d),v()&&a.listen("timeupdate",b)},p=function(a){a.unlisten("seeking",c),a.unlisten("progress",d),a.unlisten("timeupdate",b)},q=function(a,b){["controls","loop","muted","playbackRate","volume"].forEach(function(c){b[c]=a[c]})},r=function(){var b=a.getVideoModel().getElement().buffered;if(b.length){var c=b.length-1,e=b.end(c),f=a.getStartTime()+a.getDuration()-e;g>f&&(a.getVideoModel().unlisten("progress",d),u())}},s=function(){if(!a.getVideoModel().getElement().seeking){var b=a.getStartTime()+a.getDuration(),c=a.getVideoModel().getCurrentTime();h>b-c&&z.call(this,a,v())}},t=function(){var b=a.getVideoModel().getCurrentTime(),c=w(b);c&&c!==a&&z.call(this,a,c,b)},u=function(){var a=v();a&&a.seek(a.getStartTime())},v=function(){var b=a.getPeriodIndex()+1;return b<f.length?f[b]:null},w=function(a){var b=0,c=null,d=f.length;d>0&&(b+=f[0].getStartTime());for(var e=0;d>e;e++)if(c=f[e],b+=c.getDuration(),b>a)return c},x=function(){var a=this.system.getObject("videoModel"),b=document.createElement("video");return a.setElement(b),a},y=function(a){a.parentNode&&a.parentNode.removeChild(a)},z=function(b,c,d){if(b&&c&&b!==c){var e=this;Q.when(j||!0).then(function(){b.pause(),a=c,j=n.call(e,b.getVideoModel(),c.getVideoModel()),m(d?b.getVideoModel().getCurrentTime():c.getStartTime()),k()})}},A=function(){var b,c,d,e,g,h,j=this,k=j.manifestModel.getValue(),l=Q.defer(),m=[];return k?(j.manifestExt.getMpd(k).then(function(n){j.manifestExt.getRegularPeriods(k,n).then(function(n){for(d=0,b=n.length;b>d;d+=1){for(g=n[d],e=0,c=f.length;c>e;e+=1)f[e].getId()===g.id&&(h=f[e],m.push(h.updateData(g)));h||(h=j.system.getObject("stream"),h.setVideoModel(0===d?j.videoModel:x.call(j)),h.initProtection(),h.setAutoPlay(i),h.load(k,g),f.push(h)),h=null}a||(a=f[0],o.call(j,a.getVideoModel())),Q.all(m).then(function(){l.resolve()})})}),l.promise):Q.when(!1)},B=function(){if(a){var b=this;b.manifestExt.getAudioDatas(b.manifestModel.getValue(),a.getPeriodIndex()).then(function(a){e=a,b.system.notify("audioTracksUpdated")})}},C=function(){var a=this;A.call(a).then(function(){B.call(a),a.system.notify("streamsComposed")})};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,bufferExt:void 0,manifestExt:void 0,fragmentController:void 0,abrController:void 0,fragmentExt:void 0,capabilities:void 0,debug:void 0,metricsExt:void 0,errHandler:void 0,backUrl:void 0,setup:function(){this.system.mapHandler("manifestUpdated",void 0,C.bind(this)),b=s.bind(this),d=r.bind(this),c=t.bind(this)},getManifestExt:function(){return a.getManifestExt()},setAutoPlay:function(a){i=a},getAutoPlay:function(){return i},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},getAudioTracks:function(){return e},setAudioTrack:function(b){a&&a.setAudioTrack(b)},load:function(a,b){var c=this;c.backUrl=b,c.manifestLoader.load(a).then(function(a){c.backUrl&&(a.backUrl=c.backUrl),c.manifestModel.setValue(a),c.manifestUpdater.init()},function(){c.reset()})},reset:function(){a&&p.call(this,a.getVideoModel());for(var b=0,c=f.length;c>b;b++){var d=f[b];d.reset(),d!==a&&y(d.getVideoModel().getElement())}f=[],this.manifestUpdater.stop(),this.manifestModel.setValue(null),j=null,a=null},play:k,seek:m,pause:l}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.models.VideoModel=function(){"use strict";var a,b=[],c=function(){return b.length>0},d=function(c){null!==c&&(a.playbackRate=0,b[c]!==!0&&(b.push(c),b[c]=!0))},e=function(d){if(null!==d){b[d]=!1;var e=b.indexOf(d);-1!==e&&b.splice(e,1),c()===!1&&(a.playbackRate=1)}},f=function(a,b){b?d(a):e(a)};return{system:void 0,setup:function(){},play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){a.playbackRate=b},getCurrentTime:function(){return a.currentTime},setCurrentTime:function(b){a.currentTime!=b&&(a.currentTime=b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},setSource:function(b){a.src=b},isStalled:function(){return 0===a.playbackRate},stallStream:f}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getDroppedFrames:function(a){var b=null!==a.webkitDroppedFrameCount,c=-1;return b&&(c=a.webkitDroppedFrameCount),c}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.dependencies.TextController=function(){var a,b,c="LOADING",d="READY",e=!1,f=null,g=d,h=function(a){g=a},i=function(){if(e&&g===d){var b=this;h.call(b,c),b.indexHandler.getInitRequest(0,a).then(function(a){b.fragmentLoader.load(a).then(k.bind(b,a),l.bind(b,a)),h.call(b,c)})}},j=function(){i.call(this)},k=function(a,c){var d=this;d.fragmentController.process(c.data,a).then(function(a){null!==a&&d.sourceBufferExt.append(b,a,d.videoModel)})},l=function(){};return{videoModel:void 0,fragmentLoader:void 0,fragmentController:void 0,indexHandler:void 0,sourceBufferExt:void 0,debug:void 0,initialize:function(a,b,c,d){var f=this;f.setVideoModel(d),f.setPeriodInfo(a),f.setData(b),f.setBuffer(c),e=!0},setPeriodInfo:function(a){f=a},getPeriodIndex:function(){return f.index},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},getData:function(){return a},setData:function(b){a=b},getBuffer:function(){return b},setBuffer:function(a){b=a},reset:function(a,c){a||(this.sourceBufferExt.abort(c,b),this.sourceBufferExt.removeSourceBuffer(c,b))},start:j}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";return{addTextTrack:function(a,b,c,d,e){var f=a.addTextTrack("captions",c,d);f.default=e,f.mode="showing";for(var g in b){var h=b[g];f.addCue(new TextTrackCue(h.start,h.end,h.data))}return Q.when(f)},deleteCues:function(a){for(var b=a.textTracks[0],c=b.cues,d=c.length;d>=0;d--)b.removeCue(c[d]);b.mode="disabled"}}},MediaPlayer.dependencies.TextVTTSourceBuffer=function(){var a,b,c;return{system:void 0,eventBus:void 0,initialize:function(d,e){c=d,a=e.getVideoModel().getElement(),b=e.getData()},append:function(c){var d=this;d.getParser().parse(String.fromCharCode.apply(null,new Uint16Array(c))).then(function(c){var e=b.Representation_asArray[0].id,f=b.lang;d.getTextTrackExtensions().addTextTrack(a,c,e,f,!0).then(function(){d.eventBus.dispatchEvent({type:"updateend"})})})},abort:function(){this.getTextTrackExtensions().deleteCues(a)},getParser:function(){var a;return"text/vtt"===c&&(a=this.system.getObject("vttParser")),a},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextVTTSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextVTTSourceBuffer},MediaPlayer.utils.VTTParser=function(){"use strict";var a=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c],10),2===c&&(a+=3600*parseInt(b[0],10)),a};return{parse:function(b){var c,d=/(?:\r\n|\r|\n)/gm,e=/-->/,f=/(^[\s]+|[\s]+$)/g,g=[];b=b.split(d),c=b.length;for(var h=0;c>h;h++){var i=b[h];if(i.length>0&&"WEBVTT"!==i&&i.match(e)){var j=i.split(e),k=b[h+1];g.push({start:a(j[0].replace(f,"")),end:a(j[1].replace(f,"")),data:k})}}return Q.when(g)}}},MediaPlayer.rules.BaseRulesCollection=function(){"use strict";var a=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,getRules:function(){return Q.when(a)},setup:function(){var a=this;a.getRules().then(function(b){b.push(a.downloadRatioRule),b.push(a.insufficientBufferRule)})}}},MediaPlayer.rules.BaseRulesCollection.prototype={constructor:MediaPlayer.rules.BaseRulesCollection},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var a=function(a,b,c){var d=this,e=Q.defer();return d.manifestExt.getRepresentationFor(a,c).then(function(a){d.manifestExt.getBandwidth(a).then(function(a){e.resolve(a/b)})}),e.promise};return{debug:void 0,manifestExt:void 0,checkIndex:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=this,p=c.HttpList,q=.75;return c?null===p||void 0===p||0===p.length?Q.when(new MediaPlayer.rules.SwitchRequest):(e=p[p.length-1],g=(e.tfinish.getTime()-e.trequest.getTime())/1e3,f=(e.tfinish.getTime()-e.tresponse.getTime())/1e3,0>=g?Q.when(new MediaPlayer.rules.SwitchRequest):null===e.mediaduration||void 0===e.mediaduration||e.mediaduration<=0?Q.when(new MediaPlayer.rules.SwitchRequest):(k=Q.defer(),i=e.mediaduration/g,h=e.mediaduration/f*q,isNaN(h)||isNaN(i)?Q.when(new MediaPlayer.rules.SwitchRequest):(isNaN(h)?k.resolve(new MediaPlayer.rules.SwitchRequest):1>h?b>0?o.manifestExt.getRepresentationFor(b-1,d).then(function(a){o.manifestExt.getBandwidth(a).then(function(a){o.manifestExt.getRepresentationFor(b,d).then(function(c){o.manifestExt.getBandwidth(c).then(function(c){j=a/c,k.resolve(j>h?new MediaPlayer.rules.SwitchRequest(0):new MediaPlayer.rules.SwitchRequest(b-1))})})})}):k.resolve(new MediaPlayer.rules.SwitchRequest(b)):o.manifestExt.getRepresentationCount(d).then(function(c){c-=1,c>b?o.manifestExt.getRepresentationFor(b+1,d).then(function(e){o.manifestExt.getBandwidth(e).then(function(e){o.manifestExt.getRepresentationFor(b,d).then(function(f){o.manifestExt.getBandwidth(f).then(function(f){if(j=e/f,h>=j)if(h>1e3)k.resolve(new MediaPlayer.rules.SwitchRequest(c-1));else if(h>100)k.resolve(new MediaPlayer.rules.SwitchRequest(b+1));else{for(m=-1,l=[];(m+=1)<c;)l.push(a.call(o,m,f,d));Q.all(l).then(function(a){for(m=0,n=a.length;n>m&&!(h<a[m]);m+=1);k.resolve(new MediaPlayer.rules.SwitchRequest(m))})}else k.resolve(new MediaPlayer.rules.SwitchRequest)})})})}):k.resolve(new MediaPlayer.rules.SwitchRequest(c))}),k.promise))):Q.when(new MediaPlayer.rules.SwitchRequest)}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a=0,b=3;return{debug:void 0,checkIndex:function(c,d){var e,f,g=!1,h=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===d.PlayList||void 0===d.PlayList||0===d.PlayList.length?Q.when(new MediaPlayer.rules.SwitchRequest):(e=d.PlayList[d.PlayList.length-1],null===e||void 0===e||0===e.trace.length?Q.when(new MediaPlayer.rules.SwitchRequest):(f=e.trace[e.trace.length-2],null===f||void 0===f||null===f.stopreason||void 0===f.stopreason?Q.when(new MediaPlayer.rules.SwitchRequest):(f.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(g=!0,a+=1),a>b&&(h=MediaPlayer.rules.SwitchRequest.prototype.STRONG),Q.when(g?new MediaPlayer.rules.SwitchRequest(c-1,h):a>b?new MediaPlayer.rules.SwitchRequest(c,h):new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,h)))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var a=10,b=2e4,c=5,d=0;return{debug:void 0,checkIndex:function(e,f){if(d>0)return d-=1,Q.when(new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var g,h,i,j=!1,k=(new Date).getTime(),l=f.RepSwitchList.length;for(i=l-1;i>=0&&(g=f.RepSwitchList[i],h=k-g.t.getTime(),!(h>=b));i-=1)if(i>=a){j=!0;break}return j?(d=c,Q.when(new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG))):Q.when(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG))}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.quality=a,this.priority=b,void 0===this.quality&&(this.quality=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],RepBoundariesList:[],DwnldSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.SegmentRequest=function(){"use strict";this.action="download",this.startTime=0/0,this.streamType=null,this.type=null,this.duration=0/0,this.timescale=0/0,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.deferred=null,this.quality=0/0,this.index=0/0,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.SegmentRequest.prototype={constructor:MediaPlayer.vo.SegmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";
this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.RepresentationBoundaries=function(){"use strict";this.t=null,this.min=null,this.max=null},MediaPlayer.vo.metrics.RepresentationBoundaries.prototype={constructor:MediaPlayer.vo.metrics.RepresentationBoundaries},MediaPlayer.vo.metrics.RepresentationSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.RepresentationSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch},MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection};